<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>springcloud</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; -webkit-font-smoothing: antialiased; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, "Segoe UI Emoji", sans-serif; color: rgb(0, 64, 80); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
@media only screen and (min-width: 1400px) {
  #write { max-width: 1024px; }
}
@media only screen and (min-width: 1800px) {
  #write { max-width: 1200px; }
}
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 5px solid rgb(66, 185, 131); padding: 8px 15px; color: rgb(33, 93, 66); background-color: rgb(243, 245, 247); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; margin: 0px; padding: 6px 13px; }
table td { border: 1px solid rgb(223, 226, 229); margin: 0px; padding: 6px 13px; }
table th:first-child, table td:first-child { margin-top: 0px; }
table th:last-child, table td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 2px; color: rgb(209, 37, 115); }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); opacity: 0.4; }
.ty-preferences .window-content { background-color: rgb(250, 250, 250); }
.ty-preferences .nav-group-item.active { color: white; background: rgb(153, 153, 153); }
.menu-item-container a.menu-style-btn { background-color: rgb(245, 248, 250); background-image: linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0)); }
#write mark { background: transparent; color: rgb(216, 105, 105); font-weight: bold; }
p .md-image:only-child { width: auto; text-align: left; }


.cm-s-inner { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); }
.cm-s-inner .CodeMirror-gutters { background: rgb(38, 50, 56); color: rgb(83, 127, 126); border: none; }
.cm-s-inner .CodeMirror-guttermarker, .cm-s-inner .CodeMirror-guttermarker-subtle, .cm-s-inner .CodeMirror-linenumber { color: rgb(83, 127, 126); }
.cm-s-inner .CodeMirror-cursor { border-left: 1px solid rgb(248, 248, 240); }
.cm-s-inner div.CodeMirror-selected { background: rgba(255, 255, 255, 0.15); }
.cm-s-inner.CodeMirror-focused div.CodeMirror-selected { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line > span::selection, .cm-s-inner .CodeMirror-line > span > span::selection { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-activeline-background { background: rgba(0, 0, 0, 0); }
.cm-s-inner .cm-keyword { color: rgb(199, 146, 234); }
.cm-s-inner .cm-operator { color: rgb(233, 237, 237); }
.cm-s-inner .cm-variable-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-variable-3 { color: rgb(158, 255, 255); }
.cm-s-inner .cm-builtin { color: rgb(222, 203, 107); }
.cm-s-inner .cm-atom { color: rgb(247, 118, 105); }
.cm-s-inner .cm-number { color: rgb(247, 118, 105); }
.cm-s-inner .cm-def { color: rgb(233, 237, 237); }
.cm-s-inner .cm-string { color: rgb(195, 232, 141); }
.cm-s-inner .cm-string-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-comment { color: rgb(84, 110, 122); }
.cm-s-inner .cm-variable { color: rgb(158, 255, 255); }
.cm-s-inner .cm-tag { color: rgb(128, 203, 196); }
.cm-s-inner .cm-meta { color: rgb(128, 203, 196); }
.cm-s-inner .cm-attribute { color: rgb(255, 203, 107); }
.cm-s-inner .cm-property { color: rgb(128, 203, 174); }
.cm-s-inner .cm-qualifier { color: rgb(222, 203, 107); }
.cm-s-inner .cm-variable-3 { color: rgb(222, 203, 107); }
.cm-s-inner .cm-tag { color: rgb(255, 83, 112); }
.cm-s-inner .cm-error { color: rgb(255, 255, 255); background-color: rgb(236, 95, 103); }
.cm-s-inner .CodeMirror-matchingbracket { text-decoration: underline; color: white !important; }
.md-fences { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); border: none; }
.md-fences .code-tooltip { background-color: rgb(38, 50, 56); }




</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node first-line-indent'><h1><a name='header-n0' class='md-header-anchor '></a>SpringCloud</h1><div class='md-toc' mdtype='toc'><p class="md-toc-content"><span class="md-toc-item md-toc-h1" data-ref="n0"><a class="md-toc-inner" href="#header-n0">SpringCloud</a></span><span class="md-toc-item md-toc-h2" data-ref="n7"><a class="md-toc-inner" href="#header-n7">SpringCloud升级,部分组件停用</a></span><span class="md-toc-item md-toc-h1" data-ref="n17"><a class="md-toc-inner" href="#header-n17">一、环境搭建</a></span><span class="md-toc-item md-toc-h2" data-ref="n18"><a class="md-toc-inner" href="#header-n18">1. 创建父工程,pom依赖</a></span><span class="md-toc-item md-toc-h2" data-ref="n20"><a class="md-toc-inner" href="#header-n20">2. payment模块</a></span><span class="md-toc-item md-toc-h3" data-ref="n33"><a class="md-toc-inner" href="#header-n33">2.1 子模块名字</a></span><span class="md-toc-item md-toc-h3" data-ref="n36"><a class="md-toc-inner" href="#header-n36">2.2 pom依赖</a></span><span class="md-toc-item md-toc-h3" data-ref="n39"><a class="md-toc-inner" href="#header-n39">2.3 创建application.yml</a></span><span class="md-toc-item md-toc-h3" data-ref="n41"><a class="md-toc-inner" href="#header-n41">2.4 主启动类</a></span><span class="md-toc-item md-toc-h3" data-ref="n43"><a class="md-toc-inner" href="#header-n43">2.5 业务类</a></span><span class="md-toc-item md-toc-h4" data-ref="n44"><a class="md-toc-inner" href="#header-n44">2.5.1 sql</a></span><span class="md-toc-item md-toc-h4" data-ref="n49"><a class="md-toc-inner" href="#header-n49">2.5.2 实体类</a></span><span class="md-toc-item md-toc-h4" data-ref="n52"><a class="md-toc-inner" href="#header-n52">2.5.3 entity类</a></span><span class="md-toc-item md-toc-h4" data-ref="n54"><a class="md-toc-inner" href="#header-n54">2.5.4 dao层</a></span><span class="md-toc-item md-toc-h4" data-ref="n56"><a class="md-toc-inner" href="#header-n56">2.5.5 mapper配置文件类</a></span><span class="md-toc-item md-toc-h4" data-ref="n59"><a class="md-toc-inner" href="#header-n59">2.5.6 service和serviceImpl</a></span><span class="md-toc-item md-toc-h4" data-ref="n62"><a class="md-toc-inner" href="#header-n62">2.5.7 controller</a></span><span class="md-toc-item md-toc-h2" data-ref="n64"><a class="md-toc-inner" href="#header-n64">3. 热部署</a></span><span class="md-toc-item md-toc-h2" data-ref="n67"><a class="md-toc-inner" href="#header-n67">4. order模块</a></span><span class="md-toc-item md-toc-h3" data-ref="n80"><a class="md-toc-inner" href="#header-n80">4.1 子模块名字</a></span><span class="md-toc-item md-toc-h3" data-ref="n83"><a class="md-toc-inner" href="#header-n83">4.2 pom依赖</a></span><span class="md-toc-item md-toc-h3" data-ref="n85"><a class="md-toc-inner" href="#header-n85">4.3 yml配置文件</a></span><span class="md-toc-item md-toc-h3" data-ref="n87"><a class="md-toc-inner" href="#header-n87">4.4 主启动类</a></span><span class="md-toc-item md-toc-h3" data-ref="n89"><a class="md-toc-inner" href="#header-n89">4.5 复制payment模块的实体类entities</a></span><span class="md-toc-item md-toc-h3" data-ref="n90"><a class="md-toc-inner" href="#header-n90">4.6 controller类</a></span><span class="md-toc-item md-toc-h2" data-ref="n102"><a class="md-toc-inner" href="#header-n102">5. 重构</a></span><span class="md-toc-item md-toc-h3" data-ref="n104"><a class="md-toc-inner" href="#header-n104">5.1 创建commons模块</a></span><span class="md-toc-item md-toc-h3" data-ref="n107"><a class="md-toc-inner" href="#header-n107">5.2 抽取公共pom.xml</a></span><span class="md-toc-item md-toc-h3" data-ref="n109"><a class="md-toc-inner" href="#header-n109">5.3 entity和实体类放入commons中</a></span><span class="md-toc-item md-toc-h3" data-ref="n110"><a class="md-toc-inner" href="#header-n110">5.4 使用mavn将commone模块打包(install)</a></span><span class="md-toc-item md-toc-h1" data-ref="n114"><a class="md-toc-inner" href="#header-n114">二、服务注册与发现</a></span><span class="md-toc-item md-toc-h2" data-ref="n115"><a class="md-toc-inner" href="#header-n115">1. Eureka</a></span><span class="md-toc-item md-toc-h3" data-ref="n125"><a class="md-toc-inner" href="#header-n125">1.1 单机Eureka构建</a></span><span class="md-toc-item md-toc-h4" data-ref="n126"><a class="md-toc-inner" href="#header-n126">1.1.1 创建项目cloud_eureka_server_7001</a></span><span class="md-toc-item md-toc-h4" data-ref="n141"><a class="md-toc-inner" href="#header-n141">1.1.2 引入pom依赖<span>	</span></a></span><span class="md-toc-item md-toc-h4" data-ref="n144"><a class="md-toc-inner" href="#header-n144">1.1.3 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n146"><a class="md-toc-inner" href="#header-n146">1.1.4 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n148"><a class="md-toc-inner" href="#header-n148">1.1.5 启动项目</a></span><span class="md-toc-item md-toc-h4" data-ref="n149"><a class="md-toc-inner" href="#header-n149">1.1.6 其他服务注册到Eureka</a></span><span class="md-toc-item md-toc-h5" data-ref="n151"><a class="md-toc-inner" href="#header-n151">1.1.6.1 主启动类上加注解表示当前是eureka客户端</a></span><span class="md-toc-item md-toc-h5" data-ref="n153"><a class="md-toc-inner" href="#header-n153">1.1.6.2 修改pom.xml</a></span><span class="md-toc-item md-toc-h5" data-ref="n155"><a class="md-toc-inner" href="#header-n155">1.1.6.3 修改配置文件</a></span><span class="md-toc-item md-toc-h5" data-ref="n157"><a class="md-toc-inner" href="#header-n157">1.1.6.4 payment模块重启</a></span><span class="md-toc-item md-toc-h5" data-ref="n158"><a class="md-toc-inner" href="#header-n158">1.1.6.5 order模块注册</a></span><span class="md-toc-item md-toc-h3" data-ref="n162"><a class="md-toc-inner" href="#header-n162">1.2 集群Eureka构建</a></span><span class="md-toc-item md-toc-h4" data-ref="n163"><a class="md-toc-inner" href="#header-n163">1.2.1 集群原理</a></span><span class="md-toc-item md-toc-h4" data-ref="n174"><a class="md-toc-inner" href="#header-n174">1.2.2 构建新erueka项目</a></span><span class="md-toc-item md-toc-h5" data-ref="n177"><a class="md-toc-inner" href="#header-n177">1.2.2.1 pom.xml</a></span><span class="md-toc-item md-toc-h5" data-ref="n179"><a class="md-toc-inner" href="#header-n179">1.2.2.2 配置文件</a></span><span class="md-toc-item md-toc-h5" data-ref="n188"><a class="md-toc-inner" href="#header-n188">1.2.2.3 主启动类</a></span><span class="md-toc-item md-toc-h5" data-ref="n191"><a class="md-toc-inner" href="#header-n191">1.2.2.4 启动7001,7002</a></span><span class="md-toc-item md-toc-h4" data-ref="n192"><a class="md-toc-inner" href="#header-n192">1.2.3 payment,order模块注册到eureka集群</a></span><span class="md-toc-item md-toc-h5" data-ref="n193"><a class="md-toc-inner" href="#header-n193">1.2.3.1 修改配置文件即可</a></span><span class="md-toc-item md-toc-h5" data-ref="n195"><a class="md-toc-inner" href="#header-n195">1.2.3.2 两个模块相同</a></span><span class="md-toc-item md-toc-h3" data-ref="n199"><a class="md-toc-inner" href="#header-n199">1.3 payment模块配置集群</a></span><span class="md-toc-item md-toc-h4" data-ref="n200"><a class="md-toc-inner" href="#header-n200">1.3.1 创建新模块,8002</a></span><span class="md-toc-item md-toc-h4" data-ref="n203"><a class="md-toc-inner" href="#header-n203">1.3.1.1 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n206"><a class="md-toc-inner" href="#header-n206">1.3.1.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n211"><a class="md-toc-inner" href="#header-n211">1.3.1.3 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n214"><a class="md-toc-inner" href="#header-n214">1.1.1.4 mapper,service,controller复制</a></span><span class="md-toc-item md-toc-h3" data-ref="n229"><a class="md-toc-inner" href="#header-n229">1.4 修改服务主机名和ip在eureka的web上显示</a></span><span class="md-toc-item md-toc-h4" data-ref="n230"><a class="md-toc-inner" href="#header-n230">1.4.1 修改配置文件</a></span><span class="md-toc-item md-toc-h3" data-ref="n232"><a class="md-toc-inner" href="#header-n232">1.5 eureka服务发现</a></span><span class="md-toc-item md-toc-h4" data-ref="n236"><a class="md-toc-inner" href="#header-n236">1.5.1在controller中添加注解</a></span><span class="md-toc-item md-toc-h4" data-ref="n240"><a class="md-toc-inner" href="#header-n240">1.5.2 在主启动类上添加注解</a></span><span class="md-toc-item md-toc-h3" data-ref="n244"><a class="md-toc-inner" href="#header-n244">1.6 Eureka自我保护</a></span><span class="md-toc-item md-toc-h2" data-ref="n256"><a class="md-toc-inner" href="#header-n256">2. Zookeeper服务注册与发现</a></span><span class="md-toc-item md-toc-h3" data-ref="n257"><a class="md-toc-inner" href="#header-n257">2.1 启动zk到linux</a></span><span class="md-toc-item md-toc-h3" data-ref="n258"><a class="md-toc-inner" href="#header-n258">2.2 创建新的payment模块</a></span><span class="md-toc-item md-toc-h4" data-ref="n262"><a class="md-toc-inner" href="#header-n262">2.1.1 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n263"><a class="md-toc-inner" href="#header-n263">2.1.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n265"><a class="md-toc-inner" href="#header-n265">2.1.3 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n267"><a class="md-toc-inner" href="#header-n267">2.1.4 controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n269"><a class="md-toc-inner" href="#header-n269">2.1.5 启动</a></span><span class="md-toc-item md-toc-h3" data-ref="n278"><a class="md-toc-inner" href="#header-n278">2.3 创建order消费模块注册到zk</a></span><span class="md-toc-item md-toc-h4" data-ref="n279"><a class="md-toc-inner" href="#header-n279">2.3.1 创建项目</a></span><span class="md-toc-item md-toc-h4" data-ref="n282"><a class="md-toc-inner" href="#header-n282">2.3.2 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n283"><a class="md-toc-inner" href="#header-n283">2.3.3 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n285"><a class="md-toc-inner" href="#header-n285">2.3.4 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n287"><a class="md-toc-inner" href="#header-n287">2.3.5 RestTemolate</a></span><span class="md-toc-item md-toc-h4" data-ref="n289"><a class="md-toc-inner" href="#header-n289">2.3.6 controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n291"><a class="md-toc-inner" href="#header-n291">2.3.7 集群版zk注册</a></span><span class="md-toc-item md-toc-h2" data-ref="n297"><a class="md-toc-inner" href="#header-n297">3. Consul</a></span><span class="md-toc-item md-toc-h3" data-ref="n299"><a class="md-toc-inner" href="#header-n299">3.1 安装consul</a></span><span class="md-toc-item md-toc-h3" data-ref="n301"><a class="md-toc-inner" href="#header-n301">3.2 创建新的payment模块8006</a></span><span class="md-toc-item md-toc-h4" data-ref="n302"><a class="md-toc-inner" href="#header-n302">3.2.1 项目名字</a></span><span class="md-toc-item md-toc-h4" data-ref="n305"><a class="md-toc-inner" href="#header-n305">3.2.2 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n307"><a class="md-toc-inner" href="#header-n307">3.2.3 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n309"><a class="md-toc-inner" href="#header-n309">3.2.4 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n311"><a class="md-toc-inner" href="#header-n311">3.2.5 controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n313"><a class="md-toc-inner" href="#header-n313">3.2.6 启动服务</a></span><span class="md-toc-item md-toc-h3" data-ref="n316"><a class="md-toc-inner" href="#header-n316">3.3 创建新order模块</a></span><span class="md-toc-item md-toc-h4" data-ref="n319"><a class="md-toc-inner" href="#header-n319">3.3.1 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n321"><a class="md-toc-inner" href="#header-n321">3.3.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n323"><a class="md-toc-inner" href="#header-n323">3.3.3 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n325"><a class="md-toc-inner" href="#header-n325">3.3.4 RestTemplate注册</a></span><span class="md-toc-item md-toc-h4" data-ref="n329"><a class="md-toc-inner" href="#header-n329">3.3.5 controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n331"><a class="md-toc-inner" href="#header-n331">3.3.6 启动测试</a></span><span class="md-toc-item md-toc-h2" data-ref="n332"><a class="md-toc-inner" href="#header-n332">4. 三个注册中心的异同</a></span><span class="md-toc-item md-toc-h1" data-ref="n337"><a class="md-toc-inner" href="#header-n337">三、服务调用</a></span><span class="md-toc-item md-toc-h2" data-ref="n338"><a class="md-toc-inner" href="#header-n338">1. Ribbon负载均衡</a></span><span class="md-toc-item md-toc-h3" data-ref="n351"><a class="md-toc-inner" href="#header-n351">1.1 使用Ribbon（80端口）</a></span><span class="md-toc-item md-toc-h4" data-ref="n352"><a class="md-toc-inner" href="#header-n352">1.1.1 使用eureka新版本默认集成ribbon</a></span><span class="md-toc-item md-toc-h4" data-ref="n355"><a class="md-toc-inner" href="#header-n355">1.1.2 手动引入ribbon</a></span><span class="md-toc-item md-toc-h4" data-ref="n358"><a class="md-toc-inner" href="#header-n358">1.1.3 RestTemplate类</a></span><span class="md-toc-item md-toc-h4" data-ref="n367"><a class="md-toc-inner" href="#header-n367">1.1.4 Ribbon常用负载均衡算法</a></span><span class="md-toc-item md-toc-h4" data-ref="n372"><a class="md-toc-inner" href="#header-n372">1.1.5 使用Ribbon（负载规则替换）</a></span><span class="md-toc-item md-toc-h5" data-ref="n377"><a class="md-toc-inner" href="#header-n377">1.1.5.1 修改order模块</a></span><span class="md-toc-item md-toc-h5" data-ref="n378"><a class="md-toc-inner" href="#header-n378">1.1.5.2 额外建包</a></span><span class="md-toc-item md-toc-h5" data-ref="n379"><a class="md-toc-inner" href="#header-n379">1.1.5.3 创建配置类,指定负载均衡算法</a></span><span class="md-toc-item md-toc-h5" data-ref="n381"><a class="md-toc-inner" href="#header-n381">1.1.5.4 在主启动类上加一个注解</a></span><span class="md-toc-item md-toc-h3" data-ref="n385"><a class="md-toc-inner" href="#header-n385">1.2 自定义负载均衡算法</a></span><span class="md-toc-item md-toc-h4" data-ref="n386"><a class="md-toc-inner" href="#header-n386">1.2.1 ribbon的轮询算法原理</a></span><span class="md-toc-item md-toc-h4" data-ref="n388"><a class="md-toc-inner" href="#header-n388">1.2.2 自定义负载均衡算法</a></span><span class="md-toc-item md-toc-h4" data-ref="n396"><a class="md-toc-inner" href="#header-n396">1.2.3 自定义接口</a></span><span class="md-toc-item md-toc-h4" data-ref="n399"><a class="md-toc-inner" href="#header-n399">1.2.4 接口实现类</a></span><span class="md-toc-item md-toc-h4" data-ref="n402"><a class="md-toc-inner" href="#header-n402">1.2.5 修改controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n405"><a class="md-toc-inner" href="#header-n405">1.2.6 启动测试</a></span><span class="md-toc-item md-toc-h2" data-ref="n407"><a class="md-toc-inner" href="#header-n407">2. OpenFeign</a></span><span class="md-toc-item md-toc-h3" data-ref="n410"><a class="md-toc-inner" href="#header-n410">2.1 Feign与OpenFeign区别</a></span><span class="md-toc-item md-toc-h3" data-ref="n413"><a class="md-toc-inner" href="#header-n413">2.2 使用OpenFeign</a></span><span class="md-toc-item md-toc-h4" data-ref="n417"><a class="md-toc-inner" href="#header-n417">2.2.1 新建order模块</a></span><span class="md-toc-item md-toc-h4" data-ref="n420"><a class="md-toc-inner" href="#header-n420">2.2.2 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n422"><a class="md-toc-inner" href="#header-n422">2.2.3 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n424"><a class="md-toc-inner" href="#header-n424">2.2.4 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n426"><a class="md-toc-inner" href="#header-n426">2.2.5 fegin需要调用的其他的服务的接口</a></span><span class="md-toc-item md-toc-h4" data-ref="n430"><a class="md-toc-inner" href="#header-n430">2.2.6 controller类</a></span><span class="md-toc-item md-toc-h4" data-ref="n432"><a class="md-toc-inner" href="#header-n432">2.2.7 启动测试</a></span><span class="md-toc-item md-toc-h3" data-ref="n439"><a class="md-toc-inner" href="#header-n439">2.3 OpenFeign超时机制</a></span><span class="md-toc-item md-toc-h4" data-ref="n441"><a class="md-toc-inner" href="#header-n441">2.3.1 配置文件设置超时时间</a></span><span class="md-toc-item md-toc-h3" data-ref="n444"><a class="md-toc-inner" href="#header-n444">2.4 OpenFeign日志</a></span><span class="md-toc-item md-toc-h4" data-ref="n449"><a class="md-toc-inner" href="#header-n449">2.4.1 使用OpenFeign日志</a></span><span class="md-toc-item md-toc-h4" data-ref="n452"><a class="md-toc-inner" href="#header-n452">2.4.2 为指定类设置日志级别</a></span><span class="md-toc-item md-toc-h4" data-ref="n455"><a class="md-toc-inner" href="#header-n455">2.4.3 启动服务</a></span><span class="md-toc-item md-toc-h1" data-ref="n458"><a class="md-toc-inner" href="#header-n458">四、服务降级</a></span><span class="md-toc-item md-toc-h2" data-ref="n459"><a class="md-toc-inner" href="#header-n459">1. Hystrix服务降级</a></span><span class="md-toc-item md-toc-h2" data-ref="n468"><a class="md-toc-inner" href="#header-n468">2. Hystrix中的重要概念</a></span><span class="md-toc-item md-toc-h3" data-ref="n469"><a class="md-toc-inner" href="#header-n469">2.1 服务降级</a></span><span class="md-toc-item md-toc-h3" data-ref="n472"><a class="md-toc-inner" href="#header-n472">2.2 服务熔断</a></span><span class="md-toc-item md-toc-h3" data-ref="n476"><a class="md-toc-inner" href="#header-n476">2.3 服务限流</a></span><span class="md-toc-item md-toc-h3" data-ref="n479"><a class="md-toc-inner" href="#header-n479">2.4 总结</a></span><span class="md-toc-item md-toc-h2" data-ref="n482"><a class="md-toc-inner" href="#header-n482">3. 使用服务降级</a></span><span class="md-toc-item md-toc-h3" data-ref="n483"><a class="md-toc-inner" href="#header-n483">3.1 创建带降级机制的pay模块 </a></span><span class="md-toc-item md-toc-h4" data-ref="n486"><a class="md-toc-inner" href="#header-n486">3.1.1 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n488"><a class="md-toc-inner" href="#header-n488">3.1.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n490"><a class="md-toc-inner" href="#header-n490">3.1.3 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n492"><a class="md-toc-inner" href="#header-n492">3.1.4 service</a></span><span class="md-toc-item md-toc-h4" data-ref="n494"><a class="md-toc-inner" href="#header-n494">3.1.5 controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n496"><a class="md-toc-inner" href="#header-n496">3.1.6 测试</a></span><span class="md-toc-item md-toc-h4" data-ref="n501"><a class="md-toc-inner" href="#header-n501">3.1.7 不加入hystrix测试</a></span><span class="md-toc-item md-toc-h3" data-ref="n504"><a class="md-toc-inner" href="#header-n504">3.2 创建带降级的order模块</a></span><span class="md-toc-item md-toc-h4" data-ref="n505"><a class="md-toc-inner" href="#header-n505">3.2.1 创建</a></span><span class="md-toc-item md-toc-h4" data-ref="n508"><a class="md-toc-inner" href="#header-n508">3.2.2 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n510"><a class="md-toc-inner" href="#header-n510">3.2.3 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n512"><a class="md-toc-inner" href="#header-n512">3.2.4 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n514"><a class="md-toc-inner" href="#header-n514">3.2.5 远程调用payment模块的接口</a></span><span class="md-toc-item md-toc-h4" data-ref="n516"><a class="md-toc-inner" href="#header-n516">3.2.6 controller类</a></span><span class="md-toc-item md-toc-h4" data-ref="n518"><a class="md-toc-inner" href="#header-n518">3.2.7 启动测试</a></span><span class="md-toc-item md-toc-h3" data-ref="n523"><a class="md-toc-inner" href="#header-n523">3.3 配置服务降级</a></span><span class="md-toc-item md-toc-h4" data-ref="n524"><a class="md-toc-inner" href="#header-n524">3.3.1 修改payment模块</a></span><span class="md-toc-item md-toc-h4" data-ref="n534"><a class="md-toc-inner" href="#header-n534">3.3.2 修改order模块进行服务降级</a></span><span class="md-toc-item md-toc-h5" data-ref="n536"><a class="md-toc-inner" href="#header-n536">3.3.2.1 修改配置文件</a></span><span class="md-toc-item md-toc-h5" data-ref="n538"><a class="md-toc-inner" href="#header-n538">3.3.2.2 主启动类添加</a></span><span class="md-toc-item md-toc-h5" data-ref="n540"><a class="md-toc-inner" href="#header-n540">3.3.2.3 修改controller添加降级方法等</a></span><span class="md-toc-item md-toc-h5" data-ref="n542"><a class="md-toc-inner" href="#header-n542">3.3.2.4 启动测试</a></span><span class="md-toc-item md-toc-h4" data-ref="n547"><a class="md-toc-inner" href="#header-n547">3.3.3 重构</a></span><span class="md-toc-item md-toc-h5" data-ref="n552"><a class="md-toc-inner" href="#header-n552">3.3.3.1 解决重复代码的问题</a></span><span class="md-toc-item md-toc-h6" data-ref="n554"><a class="md-toc-inner" href="#header-n554">3.3.3.1.1 创建一个全局方法</a></span><span class="md-toc-item md-toc-h6" data-ref="n555"><a class="md-toc-inner" href="#header-n555">3.3.3.1.2 使用注解指定其为全局降级方法(默认降级方法)</a></span><span class="md-toc-item md-toc-h6" data-ref="n557"><a class="md-toc-inner" href="#header-n557">3.3.3.1.3 业务方法使用默认降级方法</a></span><span class="md-toc-item md-toc-h6" data-ref="n558"><a class="md-toc-inner" href="#header-n558">3.3.3.1.4 测试</a></span><span class="md-toc-item md-toc-h5" data-ref="n560"><a class="md-toc-inner" href="#header-n560">3.3.3.2 解决代码耦合度的问题</a></span><span class="md-toc-item md-toc-h6" data-ref="n562"><a class="md-toc-inner" href="#header-n562">3.3.3.2.1 Payservice接口是远程调用pay模块的,我们这里创建一个类实现service接口,在实现类中统一处理异常</a></span><span class="md-toc-item md-toc-h6" data-ref="n564"><a class="md-toc-inner" href="#header-n564">3.3.3.2.2 修改配置文件:添加</a></span><span class="md-toc-item md-toc-h6" data-ref="n566"><a class="md-toc-inner" href="#header-n566">3.3.3.2.3 让PayService的实现类生效</a></span><span class="md-toc-item md-toc-h6" data-ref="n573"><a class="md-toc-inner" href="#header-n573">3.3.3.2.4 启动测试</a></span><span class="md-toc-item md-toc-h2" data-ref="n581"><a class="md-toc-inner" href="#header-n581">4. 使用服务熔断</a></span><span class="md-toc-item md-toc-h3" data-ref="n584"><a class="md-toc-inner" href="#header-n584">4.1 修改前面的payment模块</a></span><span class="md-toc-item md-toc-h4" data-ref="n585"><a class="md-toc-inner" href="#header-n585">4.1.1 修改Payservice接口,添加服务熔断相关的方法</a></span><span class="md-toc-item md-toc-h4" data-ref="n602"><a class="md-toc-inner" href="#header-n602">4.1.2 修改controller类</a></span><span class="md-toc-item md-toc-h4" data-ref="n605"><a class="md-toc-inner" href="#header-n605">4.1.3 测试</a></span><span class="md-toc-item md-toc-h2" data-ref="n612"><a class="md-toc-inner" href="#header-n612">5. Hystrix所有可配置的属性</a></span><span class="md-toc-item md-toc-h2" data-ref="n615"><a class="md-toc-inner" href="#header-n615">6. 总结</a></span><span class="md-toc-item md-toc-h3" data-ref="n630"><a class="md-toc-inner" href="#header-n630">6.1 Hystrix服务监控</a></span><span class="md-toc-item md-toc-h4" data-ref="n631"><a class="md-toc-inner" href="#header-n631">6.1.1 HystrixDashboard</a></span><span class="md-toc-item md-toc-h4" data-ref="n634"><a class="md-toc-inner" href="#header-n634">6.1.2,使用HystrixDashboard</a></span><span class="md-toc-item md-toc-h5" data-ref="n635"><a class="md-toc-inner" href="#header-n635">6.1.2.1 创建项目</a></span><span class="md-toc-item md-toc-h5" data-ref="n638"><a class="md-toc-inner" href="#header-n638">6.1.2.2 pom.xml</a></span><span class="md-toc-item md-toc-h5" data-ref="n640"><a class="md-toc-inner" href="#header-n640">6.1.2.3 配置文件</a></span><span class="md-toc-item md-toc-h5" data-ref="n642"><a class="md-toc-inner" href="#header-n642">6.1.2.4 主启动类</a></span><span class="md-toc-item md-toc-h5" data-ref="n644"><a class="md-toc-inner" href="#header-n644">6.1.2.5 修改所有payment模块(8001,8002,8003...)</a></span><span class="md-toc-item md-toc-h5" data-ref="n648"><a class="md-toc-inner" href="#header-n648">6.1.2.6 启动9001</a></span><span class="md-toc-item md-toc-h5" data-ref="n651"><a class="md-toc-inner" href="#header-n651">6.1.2.7 注意</a></span><span class="md-toc-item md-toc-h5" data-ref="n658"><a class="md-toc-inner" href="#header-n658">6.1.2.8 启动服务</a></span><span class="md-toc-item md-toc-h1" data-ref="n670"><a class="md-toc-inner" href="#header-n670">五、服务网关</a></span><span class="md-toc-item md-toc-h2" data-ref="n673"><a class="md-toc-inner" href="#header-n673">1. GateWay</a></span><span class="md-toc-item md-toc-h3" data-ref="n678"><a class="md-toc-inner" href="#header-n678">1.1 GateWay的特性</a></span><span class="md-toc-item md-toc-h3" data-ref="n681"><a class="md-toc-inner" href="#header-n681">1.2 GateWay与zuul的区别</a></span><span class="md-toc-item md-toc-h3" data-ref="n684"><a class="md-toc-inner" href="#header-n684">1.3 zuul1.x的模型</a></span><span class="md-toc-item md-toc-h3" data-ref="n688"><a class="md-toc-inner" href="#header-n688">1.4 什么是webflux</a></span><span class="md-toc-item md-toc-h3" data-ref="n692"><a class="md-toc-inner" href="#header-n692">1.5 GateWay的一些概念</a></span><span class="md-toc-item md-toc-h4" data-ref="n693"><a class="md-toc-inner" href="#header-n693">1.5.1 路由</a></span><span class="md-toc-item md-toc-h4" data-ref="n696"><a class="md-toc-inner" href="#header-n696">1.5.2 断言</a></span><span class="md-toc-item md-toc-h4" data-ref="n699"><a class="md-toc-inner" href="#header-n699">1.5.3 过滤</a></span><span class="md-toc-item md-toc-h3" data-ref="n702"><a class="md-toc-inner" href="#header-n702">1.6 GateWay的工作原理</a></span><span class="md-toc-item md-toc-h3" data-ref="n706"><a class="md-toc-inner" href="#header-n706">1.7 使用GateWay</a></span><span class="md-toc-item md-toc-h4" data-ref="n709"><a class="md-toc-inner" href="#header-n709">1.7.1 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n711"><a class="md-toc-inner" href="#header-n711">1.7.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n713"><a class="md-toc-inner" href="#header-n713">1.7.3 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n715"><a class="md-toc-inner" href="#header-n715">1.7.4 针对payment模块设置路由</a></span><span class="md-toc-item md-toc-h4" data-ref="n725"><a class="md-toc-inner" href="#header-n725">1.7.5 启动测试</a></span><span class="md-toc-item md-toc-h4" data-ref="n732"><a class="md-toc-inner" href="#header-n732">1.7.6 GateWay的网关配置</a></span><span class="md-toc-item md-toc-h4" data-ref="n735"><a class="md-toc-inner" href="#header-n735">1.7.7 使用硬编码配置GateWay</a></span><span class="md-toc-item md-toc-h5" data-ref="n736"><a class="md-toc-inner" href="#header-n736">1.7.7.1 创建配置类</a></span><span class="md-toc-item md-toc-h5" data-ref="n739"><a class="md-toc-inner" href="#header-n739">1.7.7.2 重启服务</a></span><span class="md-toc-item md-toc-h3" data-ref="n740"><a class="md-toc-inner" href="#header-n740">1.8 重构</a></span><span class="md-toc-item md-toc-h4" data-ref="n746"><a class="md-toc-inner" href="#header-n746">1.8.1 修改GateWay模块的配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n748"><a class="md-toc-inner" href="#header-n748">1.8.2 启动测试</a></span><span class="md-toc-item md-toc-h3" data-ref="n749"><a class="md-toc-inner" href="#header-n749">1.9 Pridicate断言</a></span><span class="md-toc-item md-toc-h3" data-ref="n782"><a class="md-toc-inner" href="#header-n782">1.10 Filter过滤器</a></span><span class="md-toc-item md-toc-h4" data-ref="n785"><a class="md-toc-inner" href="#header-n785">1.10.1 生命周期</a></span><span class="md-toc-item md-toc-h4" data-ref="n788"><a class="md-toc-inner" href="#header-n788">1.10.2 种类</a></span><span class="md-toc-item md-toc-h4" data-ref="n795"><a class="md-toc-inner" href="#header-n795">1.10.3 自定义过滤器</a></span><span class="md-toc-item md-toc-h1" data-ref="n803"><a class="md-toc-inner" href="#header-n803">六、服务配置</a></span><span class="md-toc-item md-toc-h2" data-ref="n804"><a class="md-toc-inner" href="#header-n804">1. Spring Config分布式配置中心</a></span><span class="md-toc-item md-toc-h3" data-ref="n811"><a class="md-toc-inner" href="#header-n811">1.1 使用配置中心</a></span><span class="md-toc-item md-toc-h4" data-ref="n812"><a class="md-toc-inner" href="#header-n812">1.1.1 使用github作为配置中心的仓库</a></span><span class="md-toc-item md-toc-h4" data-ref="n815"><a class="md-toc-inner" href="#header-n815">1.1.2 新建config模块</a></span><span class="md-toc-item md-toc-h4" data-ref="n818"><a class="md-toc-inner" href="#header-n818">1.1.3 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n819"><a class="md-toc-inner" href="#header-n819">1.1.4 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n822"><a class="md-toc-inner" href="#header-n822">1.1.5 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n825"><a class="md-toc-inner" href="#header-n825">1.1.6 修改hosts</a></span><span class="md-toc-item md-toc-h4" data-ref="n828"><a class="md-toc-inner" href="#header-n828">1.1.7 配置完成</a></span><span class="md-toc-item md-toc-h4" data-ref="n835"><a class="md-toc-inner" href="#header-n835">1.1.8 读取配置文件的规则</a></span><span class="md-toc-item md-toc-h3" data-ref="n839"><a class="md-toc-inner" href="#header-n839">1.2 创建配置中心客户端</a></span><span class="md-toc-item md-toc-h4" data-ref="n840"><a class="md-toc-inner" href="#header-n840">1.2.1 创建config客户端项目</a></span><span class="md-toc-item md-toc-h4" data-ref="n843"><a class="md-toc-inner" href="#header-n843">1.2.2 pom.xml</a></span><span class="md-toc-item md-toc-h4" data-ref="n844"><a class="md-toc-inner" href="#header-n844">1.2.3 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n850"><a class="md-toc-inner" href="#header-n850">1.2.4 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n853"><a class="md-toc-inner" href="#header-n853">1.2.5 controller类</a></span><span class="md-toc-item md-toc-h4" data-ref="n857"><a class="md-toc-inner" href="#header-n857">1.2.6 测试</a></span><span class="md-toc-item md-toc-h4" data-ref="n862"><a class="md-toc-inner" href="#header-n862">1.2.7 问题</a></span><span class="md-toc-item md-toc-h4" data-ref="n864"><a class="md-toc-inner" href="#header-n864">1.2.8 实现动态刷新</a></span><span class="md-toc-item md-toc-h5" data-ref="n865"><a class="md-toc-inner" href="#header-n865">1.2.8.1 修改3355,添加pom依赖</a></span><span class="md-toc-item md-toc-h5" data-ref="n868"><a class="md-toc-inner" href="#header-n868">1.2.8.2 修改配置文件,添加配置</a></span><span class="md-toc-item md-toc-h5" data-ref="n871"><a class="md-toc-inner" href="#header-n871">1.2.8.3 修改controller</a></span><span class="md-toc-item md-toc-h5" data-ref="n874"><a class="md-toc-inner" href="#header-n874">1.2.8.4 重启服务</a></span><span class="md-toc-item md-toc-h1" data-ref="n889"><a class="md-toc-inner" href="#header-n889">七、消息总线</a></span><span class="md-toc-item md-toc-h2" data-ref="n890"><a class="md-toc-inner" href="#header-n890">1. SpringCloud Bus</a></span><span class="md-toc-item md-toc-h3" data-ref="n900"><a class="md-toc-inner" href="#header-n900">1.1 使用Bus</a></span><span class="md-toc-item md-toc-h4" data-ref="n901"><a class="md-toc-inner" href="#header-n901">1.1.1 配置rabbitmq环境</a></span><span class="md-toc-item md-toc-h4" data-ref="n904"><a class="md-toc-inner" href="#header-n904">1.1.2 之前只有一个配置中心客户端,这里在创建一个</a></span><span class="md-toc-item md-toc-h4" data-ref="n909"><a class="md-toc-inner" href="#header-n909">1.1.3 使用Bus实现全局广播</a></span><span class="md-toc-item md-toc-h4" data-ref="n917"><a class="md-toc-inner" href="#header-n917">1.1.4 配置第二种方式</a></span><span class="md-toc-item md-toc-h5" data-ref="n918"><a class="md-toc-inner" href="#header-n918">1.1.4.1 配置3344(配置中心服务端)</a></span><span class="md-toc-item md-toc-h6" data-ref="n919"><a class="md-toc-inner" href="#header-n919">1.1.4.1.1 修改配置文件</a></span><span class="md-toc-item md-toc-h6" data-ref="n922"><a class="md-toc-inner" href="#header-n922">1.1.4.1.2 添加pom</a></span><span class="md-toc-item md-toc-h5" data-ref="n926"><a class="md-toc-inner" href="#header-n926">1.1.4.2 修改3355(配置中心的客户端)</a></span><span class="md-toc-item md-toc-h6" data-ref="n927"><a class="md-toc-inner" href="#header-n927">1.1.4.2.1 pom</a></span><span class="md-toc-item md-toc-h6" data-ref="n930"><a class="md-toc-inner" href="#header-n930">1.1.4.2.2 配置文件</a></span><span class="md-toc-item md-toc-h5" data-ref="n934"><a class="md-toc-inner" href="#header-n934">1.1.4.3 修改3366(也是配置中心的客户端)</a></span><span class="md-toc-item md-toc-h5" data-ref="n937"><a class="md-toc-inner" href="#header-n937">1.1.4.4 测试</a></span><span class="md-toc-item md-toc-h4" data-ref="n944"><a class="md-toc-inner" href="#header-n944">1.1.5 配置定点通知</a></span><span class="md-toc-item md-toc-h1" data-ref="n952"><a class="md-toc-inner" href="#header-n952">八、消息驱动</a></span><span class="md-toc-item md-toc-h2" data-ref="n958"><a class="md-toc-inner" href="#header-n958">1. Spring Cloud Stream</a></span><span class="md-toc-item md-toc-h2" data-ref="n962"><a class="md-toc-inner" href="#header-n962">2. Spring Cloud Stream是怎么屏蔽底层差异的?</a></span><span class="md-toc-item md-toc-h2" data-ref="n966"><a class="md-toc-inner" href="#header-n966">3. Spring Cloud Stream的通信模式</a></span><span class="md-toc-item md-toc-h2" data-ref="n969"><a class="md-toc-inner" href="#header-n969">4. Spring Cloud Stream的业务流程</a></span><span class="md-toc-item md-toc-h2" data-ref="n974"><a class="md-toc-inner" href="#header-n974">5. 常用注解和api</a></span><span class="md-toc-item md-toc-h2" data-ref="n977"><a class="md-toc-inner" href="#header-n977">6. 使用SpringCloudStream</a></span><span class="md-toc-item md-toc-h3" data-ref="n981"><a class="md-toc-inner" href="#header-n981">6.1 创建生产者</a></span><span class="md-toc-item md-toc-h4" data-ref="n982"><a class="md-toc-inner" href="#header-n982">6.1.1 pom</a></span><span class="md-toc-item md-toc-h4" data-ref="n983"><a class="md-toc-inner" href="#header-n983">6.1.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n987"><a class="md-toc-inner" href="#header-n987">6.1.3 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n990"><a class="md-toc-inner" href="#header-n990">6.1.4 service和实现类</a></span><span class="md-toc-item md-toc-h4" data-ref="n996"><a class="md-toc-inner" href="#header-n996">6.1.5 controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n999"><a class="md-toc-inner" href="#header-n999">6.1.6 启动测试</a></span><span class="md-toc-item md-toc-h3" data-ref="n1005"><a class="md-toc-inner" href="#header-n1005">6.2 创建消费者</a></span><span class="md-toc-item md-toc-h4" data-ref="n1006"><a class="md-toc-inner" href="#header-n1006">6.2.1 pom</a></span><span class="md-toc-item md-toc-h4" data-ref="n1007"><a class="md-toc-inner" href="#header-n1007">6.2.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n1013"><a class="md-toc-inner" href="#header-n1013">6.2.3 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n1016"><a class="md-toc-inner" href="#header-n1016">6.2.4 业务类(消费数据)</a></span><span class="md-toc-item md-toc-h4" data-ref="n1020"><a class="md-toc-inner" href="#header-n1020">6.2.5 测试</a></span><span class="md-toc-item md-toc-h3" data-ref="n1026"><a class="md-toc-inner" href="#header-n1026">6.3 创建消费者2</a></span><span class="md-toc-item md-toc-h3" data-ref="n1034"><a class="md-toc-inner" href="#header-n1034">6.4 重复消费问题</a></span><span class="md-toc-item md-toc-h4" data-ref="n1040"><a class="md-toc-inner" href="#header-n1040">6.4.1 自定义分组</a></span><span class="md-toc-item md-toc-h3" data-ref="n1051"><a class="md-toc-inner" href="#header-n1051">6.5 持久化问题</a></span><span class="md-toc-item md-toc-h1" data-ref="n1062"><a class="md-toc-inner" href="#header-n1062">九、链路追踪</a></span><span class="md-toc-item md-toc-h2" data-ref="n1063"><a class="md-toc-inner" href="#header-n1063">1. Spring Cloud Sleuth</a></span><span class="md-toc-item md-toc-h2" data-ref="n1066"><a class="md-toc-inner" href="#header-n1066">2. 使用sleuth</a></span><span class="md-toc-item md-toc-h3" data-ref="n1067"><a class="md-toc-inner" href="#header-n1067">2.1 安装zipkin</a></span><span class="md-toc-item md-toc-h3" data-ref="n1079"><a class="md-toc-inner" href="#header-n1079">2.2 使用sleuth</a></span><span class="md-toc-item md-toc-h4" data-ref="n1082"><a class="md-toc-inner" href="#header-n1082">2.2.1 修改8001</a></span><span class="md-toc-item md-toc-h4" data-ref="n1089"><a class="md-toc-inner" href="#header-n1089">2.2.2 修改80</a></span><span class="md-toc-item md-toc-h4" data-ref="n1096"><a class="md-toc-inner" href="#header-n1096">2.2.3 测试</a></span><span class="md-toc-item md-toc-h1" data-ref="n1100"><a class="md-toc-inner" href="#header-n1100">十、Spring CloudAlibaba</a></span><span class="md-toc-item md-toc-h2" data-ref="n1110"><a class="md-toc-inner" href="#header-n1110">1. Nacos</a></span><span class="md-toc-item md-toc-h3" data-ref="n1115"><a class="md-toc-inner" href="#header-n1115">1.1 安装Nacos</a></span><span class="md-toc-item md-toc-h3" data-ref="n1128"><a class="md-toc-inner" href="#header-n1128">1.2 使用Nacos</a></span><span class="md-toc-item md-toc-h4" data-ref="n1133"><a class="md-toc-inner" href="#header-n1133">1.2.1 pom</a></span><span class="md-toc-item md-toc-h4" data-ref="n1138"><a class="md-toc-inner" href="#header-n1138">1.2.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n1140"><a class="md-toc-inner" href="#header-n1140">1.2.3 启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n1144"><a class="md-toc-inner" href="#header-n1144">1.2.4 controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n1146"><a class="md-toc-inner" href="#header-n1146">1.2.5 测试</a></span><span class="md-toc-item md-toc-h3" data-ref="n1150"><a class="md-toc-inner" href="#header-n1150">1.3 创建其他payment模块</a></span><span class="md-toc-item md-toc-h3" data-ref="n1153"><a class="md-toc-inner" href="#header-n1153">1.4 创建order模块</a></span><span class="md-toc-item md-toc-h4" data-ref="n1156"><a class="md-toc-inner" href="#header-n1156">1.4.1 pom</a></span><span class="md-toc-item md-toc-h4" data-ref="n1160"><a class="md-toc-inner" href="#header-n1160">1.4.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n1164"><a class="md-toc-inner" href="#header-n1164">1.4.3 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n1166"><a class="md-toc-inner" href="#header-n1166">1.4.4 编写配置类</a></span><span class="md-toc-item md-toc-h4" data-ref="n1169"><a class="md-toc-inner" href="#header-n1169">1.4.5 controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n1171"><a class="md-toc-inner" href="#header-n1171">1.4.6 启动测试</a></span><span class="md-toc-item md-toc-h3" data-ref="n1174"><a class="md-toc-inner" href="#header-n1174">1.5 Nacos与其他服务注册的对比</a></span><span class="md-toc-item md-toc-h3" data-ref="n1179"><a class="md-toc-inner" href="#header-n1179">1.6 使用Nacos作为配置中心</a></span><span class="md-toc-item md-toc-h4" data-ref="n1186"><a class="md-toc-inner" href="#header-n1186">1.6.1 pom</a></span><span class="md-toc-item md-toc-h4" data-ref="n1188"><a class="md-toc-inner" href="#header-n1188">1.6.2 配置文件</a></span><span class="md-toc-item md-toc-h4" data-ref="n1195"><a class="md-toc-inner" href="#header-n1195">1.6.3 主启动类</a></span><span class="md-toc-item md-toc-h4" data-ref="n1197"><a class="md-toc-inner" href="#header-n1197">1.6.4 controller</a></span><span class="md-toc-item md-toc-h4" data-ref="n1201"><a class="md-toc-inner" href="#header-n1201">1.6.5 在Nacos添加配置信息</a></span><span class="md-toc-item md-toc-h4" data-ref="n1214"><a class="md-toc-inner" href="#header-n1214">1.6.6 测试</a></span><span class="md-toc-item md-toc-h4" data-ref="n1221"><a class="md-toc-inner" href="#header-n1221">1.6.7 默认开启自动刷新</a></span><span class="md-toc-item md-toc-h3" data-ref="n1226"><a class="md-toc-inner" href="#header-n1226">1.7 Nacos配置中心之分类配置</a></span><span class="md-toc-item md-toc-h4" data-ref="n1232"><a class="md-toc-inner" href="#header-n1232">1.7.1 配置不同DataId</a></span><span class="md-toc-item md-toc-h4" data-ref="n1237"><a class="md-toc-inner" href="#header-n1237">1.7.2 配置不同的GroupID</a></span><span class="md-toc-item md-toc-h4" data-ref="n1245"><a class="md-toc-inner" href="#header-n1245">1.7.3 配置不同的namespace</a></span><span class="md-toc-item md-toc-h3" data-ref="n1252"><a class="md-toc-inner" href="#header-n1252">1.8 Nacos集群和持久化配置</a></span><span class="md-toc-item md-toc-h4" data-ref="n1257"><a class="md-toc-inner" href="#header-n1257">1.8.1 单机版,切换mysql数据库</a></span><span class="md-toc-item md-toc-h4" data-ref="n1268"><a class="md-toc-inner" href="#header-n1268">1.8.2 Linux上配置Nacos集群+Mysql数据库</a></span><span class="md-toc-item md-toc-h2" data-ref="n1305"><a class="md-toc-inner" href="#header-n1305">2. Sentinel</a></span><span class="md-toc-item md-toc-h3" data-ref="n1310"><a class="md-toc-inner" href="#header-n1310">2.1 使用sentinel</a></span><span class="md-toc-item md-toc-h3" data-ref="n1319"><a class="md-toc-inner" href="#header-n1319">2.2 微服务整合sentinel</a></span><span class="md-toc-item md-toc-h4" data-ref="n1320"><a class="md-toc-inner" href="#header-n1320">2.2.3 启动Nacos</a></span><span class="md-toc-item md-toc-h5" data-ref="n1321"><a class="md-toc-inner" href="#header-n1321">2.2.3.1 新建一个项目,8401,主要用于配置sentinel</a></span><span class="md-toc-item md-toc-h3" data-ref="n1341"><a class="md-toc-inner" href="#header-n1341">2.3 sentinel的流控规则</a></span><span class="md-toc-item md-toc-h4" data-ref="n1342"><a class="md-toc-inner" href="#header-n1342">2.3.1 流量限制控制规则</a></span><span class="md-toc-item md-toc-h4" data-ref="n1383"><a class="md-toc-inner" href="#header-n1383">2.3.2 降级规则</a></span><span class="md-toc-item md-toc-h5" data-ref="n1389"><a class="md-toc-inner" href="#header-n1389">2.3.2.1 RT配置</a></span><span class="md-toc-item md-toc-h5" data-ref="n1399"><a class="md-toc-inner" href="#header-n1399">2.3.2.2 异常比例</a></span><span class="md-toc-item md-toc-h5" data-ref="n1410"><a class="md-toc-inner" href="#header-n1410">2.3.2.3 异常数</a></span><span class="md-toc-item md-toc-h3" data-ref="n1415"><a class="md-toc-inner" href="#header-n1415">2.4 热点规则</a></span><span class="md-toc-item md-toc-h3" data-ref="n1446"><a class="md-toc-inner" href="#header-n1446">2.5 系统规则</a></span><span class="md-toc-item md-toc-h3" data-ref="n1454"><a class="md-toc-inner" href="#header-n1454">2.6 @SentinelResource注解</a></span><span class="md-toc-item md-toc-h4" data-ref="n1455"><a class="md-toc-inner" href="#header-n1455">2.6.1 用于配置降级等功能</a></span><span class="md-toc-item md-toc-h4" data-ref="n1480"><a class="md-toc-inner" href="#header-n1480">2.6.2 自定义限流处理逻辑</a></span><span class="md-toc-item md-toc-h4" data-ref="n1492"><a class="md-toc-inner" href="#header-n1492">2.6.3 @SentinelResource注解的其他属性</a></span><span class="md-toc-item md-toc-h3" data-ref="n1496"><a class="md-toc-inner" href="#header-n1496">2.7 服务熔断</a></span><span class="md-toc-item md-toc-h3" data-ref="n1553"><a class="md-toc-inner" href="#header-n1553">2.8 sentinel整合ribbon+openFeign+fallback</a></span><span class="md-toc-item md-toc-h3" data-ref="n1577"><a class="md-toc-inner" href="#header-n1577">2.9 sentinel持久化规则</a></span><span class="md-toc-item md-toc-h2" data-ref="n1602"><a class="md-toc-inner" href="#header-n1602">3. Seata</a></span><span class="md-toc-item md-toc-h3" data-ref="n1611"><a class="md-toc-inner" href="#header-n1611">3.1 seata安装</a></span></p></div><blockquote><p>Author：Zhry</p><p>Date：2022-8-22 12:15:40</p><p>Version：0.0.1</p></blockquote><h2><a name='header-n7' class='md-header-anchor '></a>SpringCloud升级,部分组件停用</h2><blockquote><p>1,Eureka停用,可以使用zk作为服务注册中心</p><p>2,服务调用,Ribbon准备停更,代替为LoadBalance</p><p>3,Feign改为OpenFeign</p><p>4,Hystrix停更,改为resilence4j</p><p> 或者阿里巴巴的sentienl</p><p>5.Zuul改为gateway</p><p>6,服务配置Config改为 Nacos</p><p>7,服务总线Bus改为Nacos</p></blockquote><h1><a name='header-n17' class='md-header-anchor '></a>一、环境搭建</h1><h2><a name='header-n18' class='md-header-anchor '></a>1. 创建父工程,pom依赖</h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?xml</span> <span class="cm-meta">version="1.0" encoding="UTF-8"?&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">project</span> <span class="cm-attribute">xmlns</span>=<span class="cm-string">"http://maven.apache.org/POM/4.0.0"</span> <span class="cm-attribute">xmlns:xsi</span>=<span class="cm-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-attribute">xsi:schemaLocation</span>=<span class="cm-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">modelVersion</span><span class="cm-tag cm-bracket">&gt;</span>4.0.0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">modelVersion</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springcloud<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>com.springcloud<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>1.0-SNAPSHOT<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">packaging</span><span class="cm-tag cm-bracket">&gt;</span>pom<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">packaging</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-comment">&lt;!--代表pom总父工程--&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">name</span><span class="cm-tag cm-bracket">&gt;</span>Maven<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">&lt;!-- FIXME change it to the project's website --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url</span><span class="cm-tag cm-bracket">&gt;</span>http://maven.apache.org/<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">inceptionYear</span><span class="cm-tag cm-bracket">&gt;</span>2001<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">inceptionYear</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">distributionManagement</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">site</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">id</span><span class="cm-tag cm-bracket">&gt;</span>website<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">id</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url</span><span class="cm-tag cm-bracket">&gt;</span>scp://webhost.company.com/www/website<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">site</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">distributionManagement</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">&lt;!-- 统一管理jar包版本 --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">properties</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">project.build.sourceEncoding</span><span class="cm-tag cm-bracket">&gt;</span>UTF-8<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">project.build.sourceEncoding</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">maven.compiler.source</span><span class="cm-tag cm-bracket">&gt;</span>1.8<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">maven.compiler.source</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">maven.compiler.target</span><span class="cm-tag cm-bracket">&gt;</span>1.8<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">maven.compiler.target</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">junit.version</span><span class="cm-tag cm-bracket">&gt;</span>4.12<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">junit.version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">log4j.version</span><span class="cm-tag cm-bracket">&gt;</span>1.2.17<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">log4j.version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">lombok.version</span><span class="cm-tag cm-bracket">&gt;</span>1.18.20<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">lombok.version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">mysql.version</span><span class="cm-tag cm-bracket">&gt;</span>8.0.28<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">mysql.version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">druid.version</span><span class="cm-tag cm-bracket">&gt;</span>1.1.9<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">druid.version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">mybatis.spring.boot.version</span><span class="cm-tag cm-bracket">&gt;</span>2.1.4<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">mybatis.spring.boot.version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">properties</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">&lt;!-- 子模块继承之后，提供作用：锁定版本+子modlue不用写groupId和version  --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependencyManagement</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependencies</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!--spring boot 2.2.2--&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-dependencies<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>2.2.2.RELEASE<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">type</span><span class="cm-tag cm-bracket">&gt;</span>pom<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">type</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span>import<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!--spring cloud Hoxton.SR1--&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.cloud<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-cloud-dependencies<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>Hoxton.SR1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">type</span><span class="cm-tag cm-bracket">&gt;</span>pom<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">type</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span>import<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>com.alibaba.cloud<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-cloud-alibaba-dependencies<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>2.1.0.RELEASE<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">type</span><span class="cm-tag cm-bracket">&gt;</span>pom<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">type</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span>import<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>mysql<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>mysql-connector-java<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>${mysql.version}<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>com.alibaba<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>druid<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>${druid.version}<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.mybatis.spring.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>mybatis-spring-boot-starter<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>${mybatis.spring.boot.version}<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>junit<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>junit<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>${junit.version}<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>log4j<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>log4j<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>${log4j.version}<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.projectlombok<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>lombok<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>${lombok.version}<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">optional</span><span class="cm-tag cm-bracket">&gt;</span>true<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">optional</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependencies</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependencyManagement</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">build</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">plugins</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-maven-plugin<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">configuration</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">fork</span><span class="cm-tag cm-bracket">&gt;</span>true<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">fork</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">addResources</span><span class="cm-tag cm-bracket">&gt;</span>true<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">addResources</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">configuration</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">plugin</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">plugins</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">build</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">project</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 3735px;"></div><div class="CodeMirror-gutters" style="display: none; height: 3735px;"></div></div></div></pre><h2><a name='header-n20' class='md-header-anchor '></a>2. payment模块</h2><blockquote><ol start='' ><li>建Module</li><li>改POM</li><li>写YML</li><li>主启动</li><li>业务类</li></ol></blockquote><h3><a name='header-n33' class='md-header-anchor '></a>2.1 子模块名字</h3><blockquote><p>cloud-provider-payment8001（微服务提供者支付Module模块）</p></blockquote><h3><a name='header-n36' class='md-header-anchor '></a>2.2 pom依赖</h3><blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?xml</span> <span class="cm-meta">version="1.0" encoding="UTF-8"?&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">project</span> <span class="cm-attribute">xmlns</span>=<span class="cm-string">"http://maven.apache.org/POM/4.0.0"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">xmlns:xsi</span>=<span class="cm-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">xsi:schemaLocation</span>=<span class="cm-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">parent</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>com.springcloud<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springcloud<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>1.0-SNAPSHOT<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">parent</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">modelVersion</span><span class="cm-tag cm-bracket">&gt;</span>4.0.0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">modelVersion</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>cloud-provider-payment8001<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependencies</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-starter-web<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-starter-actuator<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.mybatis.spring.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>mybatis-spring-boot-starter<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>com.alibaba<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>druid-spring-boot-starter<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span>1.1.10<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">version</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>mysql<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>mysql-connector-java<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jdbc --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-starter-jdbc<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-devtools<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span>runtime<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">optional</span><span class="cm-tag cm-bracket">&gt;</span>true<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">optional</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.projectlombok<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>lombok<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">optional</span><span class="cm-tag cm-bracket">&gt;</span>true<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">optional</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-starter-test<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span>test<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependencies</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">project</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 3240px;"></div><div class="CodeMirror-gutters" style="display: none; height: 3240px;"></div></div></div></pre></blockquote><h3><a name='header-n39' class='md-header-anchor '></a>2.3 创建application.yml</h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="yml" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="yml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">server</span><span class="cm-meta">:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  port</span><span class="cm-meta">: </span><span class="cm-number">8001</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">spring</span><span class="cm-meta">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  application</span><span class="cm-meta">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp;  name</span><span class="cm-meta">: </span>cloud-payment-service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  datasource</span><span class="cm-meta">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># 当前数据源操作类型</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp;  type</span><span class="cm-meta">: </span>com.alibaba.druid.pool.DruidDataSource</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># mysql驱动类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp;  driver-class-name</span><span class="cm-meta">: </span>com.mysql.cj.jdbc.Driver</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp;  url</span><span class="cm-meta">: </span>jdbc<span class="cm-meta">:</span>mysql<span class="cm-meta">:</span>//localhost<span class="cm-meta">:</span>3306/test?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp;  username</span><span class="cm-meta">: </span>root</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp;  password</span><span class="cm-meta">: </span>root</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">mybatis</span><span class="cm-meta">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  mapper-locations</span><span class="cm-meta">: </span>classpath*<span class="cm-meta">:</span>mapper/*.xml</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  type-aliases-package</span><span class="cm-meta">: </span>com.eiletxie.springcloud.entities</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  它一般对应我们的实体类所在的包，这个时候会自动取对应包中不包括包名的简单类名作为包括包名的别名。多个package之间可以用逗号或者分号等来进行分隔（value的值一定要是包的全）</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 608px;"></div><div class="CodeMirror-gutters" style="display: none; height: 608px;"></div></div></div></pre><h3><a name='header-n41' class='md-header-anchor '></a>2.4 主启动类</h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">springcloud</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">springframework</span>.<span class="cm-variable">boot</span>.<span class="cm-variable">SpringApplication</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">springframework</span>.<span class="cm-variable">boot</span>.<span class="cm-variable">autoconfigure</span>.<span class="cm-variable">SpringBootApplication</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@SpringBootApplication</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">PaymentMain8001</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">SpringApplication</span>.<span class="cm-variable">run</span>(<span class="cm-variable">PaymentMain8001</span>.<span class="cm-keyword">class</span>,<span class="cm-variable">args</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 405px;"></div><div class="CodeMirror-gutters" style="display: none; height: 405px;"></div></div></div></pre><h3><a name='header-n43' class='md-header-anchor '></a>2.5 业务类</h3><h4><a name='header-n44' class='md-header-anchor '></a>2.5.1 sql</h4><blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="sql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> payment (</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> id <span class="cm-builtin">BIGINT</span>(<span class="cm-number">20</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span> AUTO_INCREMENT COMMENT <span class="cm-string">'ID'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> serial <span class="cm-builtin">VARCHAR</span>(<span class="cm-number">200</span>) DEFAULT <span class="cm-string">''</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> PRIMARY KEY(id)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) ENGINE=INNODB AUTO_INCREMENT=<span class="cm-number">1</span> DEFAULT CHARSET=utf8</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre></blockquote><blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> payment;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----+--------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| id | serial |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----+--------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| &nbsp;<span class="cm-number">1</span> | avxd01 |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| &nbsp;<span class="cm-number">2</span> | avxd02 |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----+--------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span> rows <span class="cm-keyword">in</span> <span class="cm-keyword">set</span> (<span class="cm-number">0.00</span> sec)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">desc</span> payment;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+--------+--------------+------+-----+---------+----------------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Field  | Type &nbsp; &nbsp; &nbsp; &nbsp; | <span class="cm-atom">Null</span> | Key | Default | Extra &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+--------+--------------+------+-----+---------+----------------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| id &nbsp; &nbsp; | <span class="cm-builtin">bigint</span> &nbsp; &nbsp; &nbsp; | NO &nbsp; | PRI | <span class="cm-atom">NULL</span> &nbsp;  | auto_increment |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| serial | <span class="cm-builtin">varchar</span>(<span class="cm-number">200</span>) | YES  | &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+--------+--------------+------+-----+---------+----------------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span> rows <span class="cm-keyword">in</span> <span class="cm-keyword">set</span> (<span class="cm-number">0.00</span> sec)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 518px;"></div><div class="CodeMirror-gutters" style="display: none; height: 518px;"></div></div></div></pre></blockquote><h4><a name='header-n49' class='md-header-anchor '></a>2.5.2 实体类</h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">springcloud</span>.<span class="cm-variable">entities</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">lombok</span>.<span class="cm-variable">AllArgsConstructor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">lombok</span>.<span class="cm-variable">Data</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">lombok</span>.<span class="cm-variable">NoArgsConstructor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">Serializable</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@AllArgsConstructor</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@NoArgsConstructor</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">Payment</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Serializable</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">Long</span> <span class="cm-variable">id</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">serial</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="display: none; height: 338px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">springcloud</span>.<span class="cm-variable">entities</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">lombok</span>.<span class="cm-variable">AllArgsConstructor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">lombok</span>.<span class="cm-variable">Data</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">lombok</span>.<span class="cm-variable">NoArgsConstructor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@AllArgsConstructor</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@NoArgsConstructor</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">CommonResult</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Integer</span> <span class="cm-variable">code</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">message</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">T</span> <span class="cm-variable">data</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">CommonResult</span>(<span class="cm-variable-3">Integer</span> <span class="cm-variable">code</span>,<span class="cm-variable-3">String</span> <span class="cm-variable">message</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>(<span class="cm-variable">code</span>,<span class="cm-variable">message</span>,<span class="cm-atom">null</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 405px;"></div><div class="CodeMirror-gutters" style="display: none; height: 405px;"></div></div></div></pre><h4><a name='header-n52' class='md-header-anchor '></a>2.5.3 entity类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n53" mdtype="fences" style="break-inside: unset;">package springcloud.entities;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class CommonResult&lt;T&gt; {
    public Integer code;
    private String message;
    private T data;
    public CommonResult(Integer code,String message){
        this(code,message,null);
    }
}
</pre><h4><a name='header-n54' class='md-header-anchor '></a>2.5.4 dao层</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n55" mdtype="fences">package springcloud.dao;

import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import springcloud.entities.Payment;

@Mapper
public interface PaymentDao {
    public int create(Payment payment);
    public Payment getPaymentById(@Param("id") Long id);
}
</pre><h4><a name='header-n56' class='md-header-anchor '></a>2.5.5 mapper配置文件类</h4><p><strong>在resource下,创建mapper/PayMapper.xml</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n58" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="springcloud.dao.PaymentDao"&gt;

    &lt;insert id="create" parameterType="springcloud.entities.Payment" useGeneratedKeys="true" keyProperty="id"&gt;
        insert into payment(serial) values(#{serial})
    &lt;/insert&gt;

    &lt;resultMap id="BaseResultMap" type="springcloud.entities.Payment"&gt;
        &lt;id column="id" property="id" jdbcType="BIGINT"&gt;&lt;/id&gt;
        &lt;id column="serial" property="serial" jdbcType="VARCHAR"&gt;&lt;/id&gt;
    &lt;/resultMap&gt;
    &lt;select id="getPaymentById" parameterType="Long" resultMap="BaseResultMap"&gt;
        select *
        from payment where id=#{id};
    &lt;/select&gt;

&lt;/mapper&gt;
</pre><h4><a name='header-n59' class='md-header-anchor '></a>2.5.6 service和serviceImpl</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n60" mdtype="fences">package springcloud.service;

import org.apache.ibatis.annotations.Param;
import springcloud.entities.Payment;

public interface PaymentService {
    public int create(Payment payment);
    public Payment getPaymentById(@Param("id") Long id);
}

</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n61" mdtype="fences" style="break-inside: unset;">package springcloud.service;

import org.springframework.stereotype.Service;
import springcloud.dao.PaymentDao;
import springcloud.entities.Payment;

import javax.annotation.Resource;

@Service
public class PaymentServiceImpl implements PaymentService {
    @Resource
    private PaymentDao paymentDao;
    @Override
    public int create(Payment payment) {
        return paymentDao.create(payment);
    }

    @Override
    public Payment getPaymentById(Long id) {
        return paymentDao.getPaymentById(id);
    }
}
</pre><h4><a name='header-n62' class='md-header-anchor '></a>2.5.7 controller</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n63" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RestController;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;
import springcloud.service.PaymentService;

import javax.annotation.Resource;

@Slf4j
@RestController
public class PaymentController {

    @Resource
    private PaymentService paymentService;

    @PostMapping("/payment/create")
    public CommonResult create(Payment payment){
        int result = paymentService.create(payment);
        log.info("插入返回结果：" + result + "^_^");
        if(result &gt; 0){
            return new CommonResult(200,"插入数据成功",result);
        } else {
            return new CommonResult(444,"插入数据失败",null);
        }
    }

    @GetMapping("/payment/get/{id}")
    public CommonResult getPaymentById(@PathVariable("id") Long id){
        Payment payment = paymentService.getPaymentById(id);
        log.info("插入返回结果：" + payment);
        if(payment!=null){
            return new CommonResult(200,"查询数据成功",payment);
        } else {
            return new CommonResult(444,"查询数据失败",null);
        }
    }

}
</pre><h2><a name='header-n64' class='md-header-anchor '></a>3. 热部署</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n65" mdtype="fences">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n66" mdtype="fences">&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
                &lt;fork&gt;true&lt;/fork&gt;
                &lt;addResources&gt;true&lt;/addResources&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</pre><h2><a name='header-n67' class='md-header-anchor '></a>4. order模块</h2><blockquote><ol start='' ><li>建Module</li><li>改POM</li><li>写YML</li><li>主启动</li><li>业务类</li></ol></blockquote><h3><a name='header-n80' class='md-header-anchor '></a>4.1 子模块名字</h3><blockquote><p>cloud-consumer-order80（微服务消费者订单Module模块）</p></blockquote><h3><a name='header-n83' class='md-header-anchor '></a>4.2 pom依赖</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n84" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-consumer-order80&lt;/artifactId&gt;

    &lt;dependencies&gt;


        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web  --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-commons&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
            &lt;!-- 排除Jersey，用SpringMVC Rest方式--&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
                    &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
                    &lt;artifactId&gt;jersey-core&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
                    &lt;artifactId&gt;jersey-apache-client4&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><h3><a name='header-n85' class='md-header-anchor '></a>4.3 yml配置文件</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n86" mdtype="fences">server:
  port: 80
</pre><h3><a name='header-n87' class='md-header-anchor '></a>4.4 主启动类</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n88" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class OrderMain80 {
    public static void main(String[] args) {
        SpringApplication.run(OrderMain80.class,args);
    }
}
</pre><h3><a name='header-n89' class='md-header-anchor '></a>4.5 复制payment模块的实体类entities</h3><h3><a name='header-n90' class='md-header-anchor '></a>4.6 controller类</h3><blockquote><p>因为这里是消费者类,主要是消费,那么就没有service和dao,需要调用pay模块的方法</p><p>并且这里还没有微服务的远程调用,那么如果要调用另外一个模块,则需要使用基本的api调用</p><p>使用RestTemplate调用payment模块</p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/531517917a294f3a8876bf1d75634ecd.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/25008fd5877e46de87dd373a7fcbacb7.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p> 将restTemplate注入到容器</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n99" mdtype="fences" style="break-inside: unset;">package springcloud.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.client.RestTemplate;

@Configuration
public class ApplicationContextConfig {

    @Bean
    public RestTemplate getRestTemplate(){
        return new RestTemplate();
    }
}
</pre><p>编写controller</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n101" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;

import javax.annotation.Resource;

@RestController
@Slf4j
public class OrderController {

    public static final String PAYMENT_URL = "http://localhost:8001";

    @Resource
    private RestTemplate restTemplate;

    @GetMapping("/consumer/payment/create")
    public CommonResult&lt;Payment&gt; create(Payment payment){
        return restTemplate.postForObject(PAYMENT_URL + "/payment/create",payment,CommonResult.class);
    }

    @GetMapping("/consumer/payment/get/{id}")
    public CommonResult&lt;Payment&gt; getPayment(@PathVariable("id") Long id){
        return restTemplate.getForObject(PAYMENT_URL + "/payment/get/" + id,CommonResult.class);
    }

}
</pre><h2><a name='header-n102' class='md-header-anchor '></a>5. 重构</h2><p>新建一个模块,将重复代码抽取到一个公共模块中</p><h3><a name='header-n104' class='md-header-anchor '></a>5.1 创建commons模块</h3><blockquote><p>cloud-api-commons</p></blockquote><h3><a name='header-n107' class='md-header-anchor '></a>5.2 抽取公共pom.xml</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n108" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
            &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
            &lt;version&gt;5.1.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;

</pre><h3><a name='header-n109' class='md-header-anchor '></a>5.3 entity和实体类放入commons中</h3><h3><a name='header-n110' class='md-header-anchor '></a>5.4 使用mavn将commone模块打包(install)</h3><blockquote><p>其他模块引入common使用</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n113" mdtype="fences">&lt;dependency&gt;
   &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
   &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
   &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</pre></blockquote><h1><a name='header-n114' class='md-header-anchor '></a>二、服务注册与发现</h1><h2><a name='header-n115' class='md-header-anchor '></a>1. Eureka</h2><blockquote><p>前面我们没有服务注册中心,也可以服务间调用,为什么还要服务注册?</p><p>当服务很多时,单靠代码手动管理是很麻烦的,需要一个公共组件,统一管理多服务,包括服务是否正常运行,等</p><p>Eureka用于<strong><mark>服务注册</mark></strong>,目前官网<strong>已经停止更新</strong></p><p><img src='https://img-blog.csdnimg.cn/1844c90fc3c648db832358a1c6570928.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/4b1c7bcb916b4c69a3988409bfafaff9.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/24b4a93f287248e5a1a4b11250a69543.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/a84fd4c45138418daab663d05aa6dea2.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n125' class='md-header-anchor '></a>1.1 单机Eureka构建</h3><h4><a name='header-n126' class='md-header-anchor '></a>1.1.1 创建项目cloud_eureka_server_7001</h4><blockquote><ol start='' ><li>建Module</li><li>改POM</li><li>写YML</li><li>主启动</li><li>业务类</li></ol></blockquote><blockquote><p>cloud-eureka-server7001</p></blockquote><h4><a name='header-n141' class='md-header-anchor '></a>1.1.2 引入pom依赖<span>	</span></h4><p> eurka最新的依赖：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n143" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-eureka-server7001&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;!--自定义--&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web  --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;
&lt;/project&gt;
</pre><h4><a name='header-n144' class='md-header-anchor '></a>1.1.3 配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n145" mdtype="fences">server:
  port: 7001

eureka:
  instance:
    hostname: localhost  #eureka服务端的实例名字
  client:
    register-with-eureka: false    #表识不向注册中心注册自己
    fetch-registry: false   #表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务
    service-url:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/    #设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址
</pre><h4><a name='header-n146' class='md-header-anchor '></a>1.1.4 主启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n147" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

@SpringBootApplication
@EnableEurekaServer
public class EurekaMain7001 {
    public static void main(String[] args) {
        SpringApplication.run(EurekaMain7001.class,args);
    }
}
</pre><h4><a name='header-n148' class='md-header-anchor '></a>1.1.5 启动项目</h4><h4><a name='header-n149' class='md-header-anchor '></a>1.1.6 其他服务注册到Eureka</h4><p>比如此时payment模块加入eureka</p><h5><a name='header-n151' class='md-header-anchor '></a>1.1.6.1 主启动类上加注解表示当前是eureka客户端</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n152" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;

@SpringBootApplication
@EnableEurekaClient
public class PaymentMain8001 {
    public static void main(String[] args) {
        SpringApplication.run(PaymentMain8001.class,args);
    }
}
</pre><h5><a name='header-n153' class='md-header-anchor '></a>1.1.6.2 修改pom.xml</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n154" mdtype="fences">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
&lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;

&lt;!--使用下面的依赖--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-netflix-eureka-client&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre><h5><a name='header-n155' class='md-header-anchor '></a>1.1.6.3 修改配置文件</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n156" mdtype="fences">eureka:
  client:
    register-with-eureka: true
    fetchRegistry: true
    service-url:
      defaultZone: http://localhost:7001/eureka
</pre><h5><a name='header-n157' class='md-header-anchor '></a>1.1.6.4 payment模块重启</h5><h5><a name='header-n158' class='md-header-anchor '></a>1.1.6.5 order模块注册</h5><blockquote><p><img src='https://img-blog.csdnimg.cn/e7bb3aea41244d38a65cfcdb1c610343.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n161" mdtype="fences" style="break-inside: unset;">&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
   &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
   &lt;!-- 不要使用：&lt;artifactId&gt;spring-cloud-netflix-eureka-client&lt;/artifactId&gt;--&gt;
   &lt;!-- 排除Jersey，用SpringMVC Rest方式--&gt;
   &lt;exclusions&gt;
       &lt;exclusion&gt;
           &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
           &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;
       &lt;/exclusion&gt;
       &lt;exclusion&gt;
           &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
           &lt;artifactId&gt;jersey-core&lt;/artifactId&gt;
       &lt;/exclusion&gt;
       &lt;exclusion&gt;
           &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
           &lt;artifactId&gt;jersey-apache-client4&lt;/artifactId&gt;
       &lt;/exclusion&gt;
   &lt;/exclusions&gt;
&lt;/dependency&gt;
</pre></blockquote><h3><a name='header-n162' class='md-header-anchor '></a>1.2 集群Eureka构建</h3><h4><a name='header-n163' class='md-header-anchor '></a>1.2.1 集群原理</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/48043002ffda4b9eb002be3709228e82.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><ol start='' ><li>就是pay模块启动时,注册自己,并且自身信息也放入eureka</li><li>order模块,首先也注册自己,放入信息,当要调用pay时,先从eureka拿到pay的调用地址</li><li>通过HttpClient调用，并且还会缓存一份到本地,每30秒更新一次</li></ol><p><img src='https://img-blog.csdnimg.cn/02bc566fe97c4f93b1c6f8c4be126958.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n174' class='md-header-anchor '></a>1.2.2 构建新erueka项目</h4><blockquote><p>cloud-eureka-server7002</p></blockquote><h5><a name='header-n177' class='md-header-anchor '></a>1.2.2.1 pom.xml</h5><p> 粘贴7001的即可</p><h5><a name='header-n179' class='md-header-anchor '></a>1.2.2.2 配置文件</h5><blockquote><p>在写配置文件前,修改一下主机的hosts文件（C:\Windows\System32\drivers\etc）</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n182" mdtype="fences">########SpringCloud############
127.0.0.1       eureka7001.com
127.0.0.1       eureka7002.com
</pre><blockquote><p>首先修改之前的7001的eureka项目,因为多个eureka需要互相注册</p><p>7002也是一样的,只不过端口和地址改一下</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n186" mdtype="fences">server:
  port: 7001

eureka:
  instance:
    hostname: eureka7001.com  #eureka服务端的实例名字
  client:
    register-with-eureka: false    #表识不向注册中心注册自己
    fetch-registry: false   #表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务
    service-url:
      defaultZone: http://eureka7002.com:7002/eureka
      #设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n187" mdtype="fences">server:
  port: 7002

eureka:
  instance:
    hostname: eureka7002.com  #eureka服务端的实例名字
  client:
    register-with-eureka: false    #表识不向注册中心注册自己
    fetch-registry: false   #表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务
    service-url:
      defaultZone: http://eureka7001.com:7001/eureka
      #设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址
</pre><h5><a name='header-n188' class='md-header-anchor '></a>1.2.2.3 主启动类</h5><blockquote><p>复制7001</p></blockquote><h5><a name='header-n191' class='md-header-anchor '></a>1.2.2.4 启动7001,7002</h5><h4><a name='header-n192' class='md-header-anchor '></a>1.2.3 payment,order模块注册到eureka集群</h4><h5><a name='header-n193' class='md-header-anchor '></a>1.2.3.1 修改配置文件即可</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n194" mdtype="fences" style="break-inside: unset;">server:
  port: 80

spring:
  application:
    name: cloud-consumer-order

eureka:
  client:
    # 表示是否将自己注册到EurekaServer中，默认为true
    register-with-eureka: true
    # 是否从EurekaServer抓取已有的注册信息，默认为true （单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡）
    fetchRegistry: true
    service-url:
      defaultZone: http://eureka7001.com:7001/eureka,http://eureka7001.com:7001/eureka
</pre><h5><a name='header-n195' class='md-header-anchor '></a>1.2.3.2 两个模块相同</h5><blockquote><p>然后启动两个模块</p><p>要先启动7001,7002,然后是payment模块8001,然后是order模块80</p></blockquote><h3><a name='header-n199' class='md-header-anchor '></a>1.3 payment模块配置集群</h3><h4><a name='header-n200' class='md-header-anchor '></a>1.3.1 创建新模块,8002</h4><blockquote><p>cloud-provider-payment8002</p></blockquote><h4><a name='header-n203' class='md-header-anchor '></a>1.3.1.1 pom.xml</h4><blockquote><p>复制8001</p></blockquote><h4><a name='header-n206' class='md-header-anchor '></a>1.3.1.2 配置文件</h4><blockquote><p>复制8001</p><p>端口修改一下,改为8002</p><p>服务名称不用改,用一样的</p></blockquote><h4><a name='header-n211' class='md-header-anchor '></a>1.3.1.3 主启动类</h4><blockquote><p>复制8001</p></blockquote><h4><a name='header-n214' class='md-header-anchor '></a>1.1.1.4 mapper,service,controller复制</h4><blockquote><p>然后就启动服务即可</p><p>此时访问order模块,发现并没有负载均衡到两个pay,模块中,而是只访问8001</p><p>虽然我们是使用RestTemplate访问的微服务,但是也可以负载均衡的</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n219" mdtype="fences">@Value("${server.port}")
private String serverPort;
</pre><p>Controller做端口区分</p></blockquote><blockquote><p>80端口只能对8001进行访问，下面对80端口Controller做修改：（微服务名称）</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n223" mdtype="fences">public static final String PAYMENT_URL = "http://CLOUD-PAYMENT-SERVICE";
</pre><p>&nbsp;</p></blockquote><p><strong>需要让RestTemplate开启负载均衡注解,还可以指定负载均衡算法,默认轮询</strong></p><blockquote><p>80端口下的ApplicationContextConfig</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n228" mdtype="fences" style="break-inside: unset;">package springcloud.config;

import org.springframework.cloud.client.loadbalancer.LoadBalanced;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.client.RestTemplate;

@Configuration
public class ApplicationContextConfig {

    @LoadBalanced
    @Bean
    public RestTemplate getRestTemplate(){
        return new RestTemplate();
    }
}
</pre></blockquote><h3><a name='header-n229' class='md-header-anchor '></a>1.4 修改服务主机名和ip在eureka的web上显示</h3><h4><a name='header-n230' class='md-header-anchor '></a>1.4.1 修改配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n231" mdtype="fences">eureka:
  client:
    # 表示是否将自己注册到EurekaServer中，默认为true
    register-with-eureka: true
    # 是否从EurekaServer抓取已有的注册信息，默认为true （单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡）
    fetchRegistry: true
    service-url:
      defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka
  instance:
    instance-id: payment8002
    prefer-ip-address: true # 访问路径可以显示IP地址
</pre><h3><a name='header-n232' class='md-header-anchor '></a>1.5 eureka服务发现</h3><blockquote><p>对于注册金eureka里面的微服务，可以通过服务发现来获得该服务的信息</p><p>下面以payment8001模块为例</p></blockquote><h4><a name='header-n236' class='md-header-anchor '></a>1.5.1在controller中添加注解</h4><blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n238" mdtype="fences">@Resource
private EurekaDiscoveryClient eurekaDiscoveryClient;
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n239" mdtype="fences">@GetMapping(value = "/payment/discovery")
public Object discovery(){
    List&lt;String&gt; services = eurekaDiscoveryClient.getServices();
    for(String s : services){
        log.info("element：" + s);
    }
    List&lt;ServiceInstance&gt; instances = eurekaDiscoveryClient.getInstances("CLOUD-PAYMENT-SERVICE");
    for (ServiceInstance instance : instances){
        log.info(instance.getInstanceId()+"\t"+instance.getHost()+"\t"+instance.getPort()+"\t"+instance.getUri());
    }
    return this.eurekaDiscoveryClient;
}
</pre></blockquote><h4><a name='header-n240' class='md-header-anchor '></a>1.5.2 在主启动类上添加注解</h4><blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n242" mdtype="fences">@EnableDiscoveryClient
</pre></blockquote><p><strong>重启8001.访问/payment/discovery</strong></p><h3><a name='header-n244' class='md-header-anchor '></a>1.6 Eureka自我保护</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/da9bd135a43847f296e2136b6f63e439.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/7308c170ac1a44d38a3fa603829d41b4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/743881dfe0774b4291b06eac42871533.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p><strong>eureka服务端配置</strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/e1ca2a9270574f4cbdfa87c0bb097d4f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p><strong>客户端(payment模块)</strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/bac050a0be3e4483873cfdbfb6309885.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>此时启动erueka和payment.此时如果直接关闭了payment,那么erueka会直接删除其注册信息</strong></p></blockquote><h2><a name='header-n256' class='md-header-anchor '></a>2. Zookeeper服务注册与发现</h2><h3><a name='header-n257' class='md-header-anchor '></a>2.1 启动zk到linux</h3><h3><a name='header-n258' class='md-header-anchor '></a>2.2 创建新的payment模块</h3><blockquote><p>单独用于注册到zk中</p><p>名字 : cloud-provider-payment8003</p></blockquote><h4><a name='header-n262' class='md-header-anchor '></a>2.1.1 pom.xml</h4><h4><a name='header-n263' class='md-header-anchor '></a>2.1.2 配置文件</h4><p><img src='https://img-blog.csdnimg.cn/3fc4ec066f2e492799a7a0a3e792a035.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h4><a name='header-n265' class='md-header-anchor '></a>2.1.3 主启动类</h4><p><img src='https://img-blog.csdnimg.cn/c786a12c6ed74df68b3cebf20510624f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h4><a name='header-n267' class='md-header-anchor '></a>2.1.4 controller</h4><p><img src='https://img-blog.csdnimg.cn/b66b728be7c644ea87c1342c2ffb6bd4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h4><a name='header-n269' class='md-header-anchor '></a>2.1.5 启动</h4><blockquote><p><strong>此时启动,会报错,因为jar包与我们的zk版本不匹配</strong></p><p>解决:
修改pom文件,改为与我们zk版本匹配的jar包</p><p><img src='https://img-blog.csdnimg.cn/0808b46afa854870ae0288a1319f6fd2.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>此时8003就注册到zk中了</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n275" mdtype="fences">我们在zk上注册的node是临时节点,当我们的服务一定时间内没有发送心跳
那么zk就会将这个服务的node删除了
</pre><blockquote><p>这里测试,就不写service与dao什么的了</p></blockquote></blockquote><h3><a name='header-n278' class='md-header-anchor '></a>2.3 创建order消费模块注册到zk</h3><h4><a name='header-n279' class='md-header-anchor '></a>2.3.1 创建项目</h4><blockquote><p>cloud-order-zk80</p></blockquote><h4><a name='header-n282' class='md-header-anchor '></a>2.3.2 pom.xml</h4><h4><a name='header-n283' class='md-header-anchor '></a>2.3.3 配置文件</h4><p><img src='https://img-blog.csdnimg.cn/504ca5f1bb35413193131c320aa548ca.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h4><a name='header-n285' class='md-header-anchor '></a>2.3.4 主启动类</h4><p><img src='https://img-blog.csdnimg.cn/0338bf8be31442eeb33571adb0be88bd.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h4><a name='header-n287' class='md-header-anchor '></a>2.3.5 RestTemolate</h4><p><img src='https://img-blog.csdnimg.cn/d6a54b58f6fa4b16a43cf232327ba067.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h4><a name='header-n289' class='md-header-anchor '></a>2.3.6 controller</h4><p><img src='https://img-blog.csdnimg.cn/8b52b7d855364a75bf317c50bc18d3a5.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h4><a name='header-n291' class='md-header-anchor '></a>2.3.7 集群版zk注册</h4><blockquote><p>只需要修改配置文件</p><p><img src='https://img-blog.csdnimg.cn/b778bcc41311483dabbfcbb69f7c308d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>这个connect-string指定多个zk地址即可</p><p>connect-string: 1.2.3.4,2.3.4.5</p></blockquote><h2><a name='header-n297' class='md-header-anchor '></a>3. Consul</h2><p><img src='https://img-blog.csdnimg.cn/5154afc1a1aa40d7b6624f568b6cdb7f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h3><a name='header-n299' class='md-header-anchor '></a>3.1 安装consul</h3><p><img src='https://img-blog.csdnimg.cn/f051f6a02bc04d85ac6440e44213953a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h3><a name='header-n301' class='md-header-anchor '></a>3.2 创建新的payment模块8006</h3><h4><a name='header-n302' class='md-header-anchor '></a>3.2.1 项目名字</h4><blockquote><p>cloud-providerconsul-payment8006</p></blockquote><h4><a name='header-n305' class='md-header-anchor '></a>3.2.2 pom.xml</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n306" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-providerconsul-payment8006&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-consul-discovery --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
        &lt;/dependency&gt;


        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><h4><a name='header-n307' class='md-header-anchor '></a>3.2.3 配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n308" mdtype="fences" style="break-inside: unset;"># consul服务端口号
server:
  port: 8006


spring:
  application:
    name: consul-provider-payment
  # consul注册中心地址
  cloud:
    consul:
      host: localhost
      port: 8500
      discovery:
        service-name: ${spring.application.name}
</pre><h4><a name='header-n309' class='md-header-anchor '></a>3.2.4 主启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n310" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class PaymentMain8006 {
    public static void main(String[] args) {
        SpringApplication.run(PaymentMain8006.class,args);
    }
}
</pre><h4><a name='header-n311' class='md-header-anchor '></a>3.2.5 controller</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n312" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.UUID;

@RestController
@Slf4j
public class PaymentController {

    @Value("${server.port}")
    private String serverPort;

    @GetMapping("/payment/consul")
    public String paymentInfo(){
        return "spring with consul：" + serverPort + "\t\t" + UUID.randomUUID().toString();
    }
}
</pre><h4><a name='header-n313' class='md-header-anchor '></a>3.2.6 启动服务</h4><blockquote><p>服务提供者注册进consul后，进行启动测试</p></blockquote><h3><a name='header-n316' class='md-header-anchor '></a>3.3 创建新order模块</h3><blockquote><p>cloud-consumerconsul-order80</p></blockquote><h4><a name='header-n319' class='md-header-anchor '></a>3.3.1 pom.xml</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n320" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;dependencies&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-consul-discovery --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;


        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-consumer-order80&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-consul-discovery --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;


        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

&lt;/project&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><h4><a name='header-n321' class='md-header-anchor '></a>3.3.2 配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n322" mdtype="fences">server:
  port: 80


spring:
  application:
    name: consul-consumer-order
  cloud:
    consul:
      host: localhost
      port: 8500
      discovery:
        service-name: ${spring.application.name}
</pre><h4><a name='header-n323' class='md-header-anchor '></a>3.3.3 主启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n324" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class OrderConsulMain80 {
    public static void main(String[] args) {
        SpringApplication.run(OrderConsulMain80.class,args);
    }
}
</pre><h4><a name='header-n325' class='md-header-anchor '></a>3.3.4 RestTemplate注册</h4><blockquote><p>配置类注册</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n328" mdtype="fences" style="break-inside: unset;">package springcloud.config;

import org.springframework.cloud.client.loadbalancer.LoadBalanced;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.client.RestTemplate;

@Configuration
public class ApplicationContextConfig {
    @Bean
    @LoadBalanced
    public RestTemplate getRestTemplate(){
        return new RestTemplate();
    }
}
</pre><h4><a name='header-n329' class='md-header-anchor '></a>3.3.5 controller</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n330" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

import javax.annotation.Resource;

@RestController
@Slf4j
public class OrderConsulController {
    public static final String INVOKE_URL = "http://consul-provider-payment";
    @Resource
    private RestTemplate restTemplate;

    @GetMapping("/consumer/consul")
    public String paymentInfo(){
        String result = restTemplate.getForObject(INVOKE_URL + "/payment/consul",String.class);
        /**String result = restTemplate.getForObject(INVOKE_URL + "payment/consul",String.class);错误*/
        return result;
    }
}
</pre><h4><a name='header-n331' class='md-header-anchor '></a>3.3.6 启动测试</h4><h2><a name='header-n332' class='md-header-anchor '></a>4. 三个注册中心的异同</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/92b3cb0f157a47cab266c006bfb50533.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/56adc38c5c8e45a7b6f7af9f61d09395.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/4e712966fc2c4f2a95812fb4eca9cdf5.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h1><a name='header-n337' class='md-header-anchor '></a>三、服务调用</h1><h2><a name='header-n338' class='md-header-anchor '></a>1. Ribbon负载均衡</h2><p><img src='https://img-blog.csdnimg.cn/a2ff34c257ee4bdf8c3bf1782ec60406.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>Ribbon目前也进入维护,基本上不准备更新了</strong></p><p><img src='https://img-blog.csdnimg.cn/69168c573e1a414783b074d58f9b65b3.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>进程内LB(本地负载均衡)</strong></p><p><img src='https://img-blog.csdnimg.cn/f680943a570f4650b0fdfad4e9970240.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>集中式LB(服务端负载均衡)</strong></p><p><img src='https://img-blog.csdnimg.cn/83147b63a1cf488ab67303f980f919ac.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>区别</strong></p><p><img src='https://img-blog.csdnimg.cn/7d85fdb79bb24fd9bc2ab0168fe2e16f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>Ribbon就是负载均衡+RestTemplate</strong></p><p><img src='https://img-blog.csdnimg.cn/20cd8ba8972d4429ba0069b4d2124a08.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/0652189bdbcf4059b5ad3ccb337229aa.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h3><a name='header-n351' class='md-header-anchor '></a>1.1 使用Ribbon（80端口）</h3><h4><a name='header-n352' class='md-header-anchor '></a>1.1.1 使用eureka新版本默认集成ribbon</h4><p><img src='.\图片\Ribbon的9.png' alt='' referrerPolicy='no-referrer' /></p><p><strong><mark>这个starter中集成了reibbon</mark></strong></p><h4><a name='header-n355' class='md-header-anchor '></a>1.1.2 手动引入ribbon</h4><p><strong>放到order模块中,因为只有order访问payment时需要负载均衡</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n357" mdtype="fences">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre><h4><a name='header-n358' class='md-header-anchor '></a>1.1.3 RestTemplate类</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/fdcbfbeaa7184669ae5246f9e8bb700b.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/4821fbf6ca6d4fc5b540eeba16b57f60.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n362" mdtype="fences">@GetMapping("/consumer/payment/getForEntity/{id}")
public CommonResult&lt;Payment&gt; getPayment2(@PathVariable("id") Long id){
    ResponseEntity&lt;CommonResult&gt; forEntity = restTemplate.getForEntity(PAYMENT_URL + "/payment/get/" + id, CommonResult.class);
    if(forEntity.getStatusCode().is2xxSuccessful()){
        return forEntity.getBody();
    } else {
        return new CommonResult&lt;&gt;(444,"操作失败！");
    }
}
</pre><blockquote><p>RestTemplate:
        </p><p>xxxForObject()方法,返回的是响应体中的数据
    </p><p>xxxForEntity()方法.返回的是entity对象,这个对象不仅仅包含响应体数据,还包含响应体信息(状态码等)</p></blockquote><h4><a name='header-n367' class='md-header-anchor '></a>1.1.4 Ribbon常用负载均衡算法</h4><blockquote><p><strong>IRule接口,Riboon使用该接口,根据特定算法从所有服务中,选择一个服务,</strong></p><p><strong>Rule接口有7个实现类,每个实现类代表一个负载均衡算法</strong></p><p><img src='https://img-blog.csdnimg.cn/6818363cfbfe4cd1bfddcf81d6265127.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n372' class='md-header-anchor '></a>1.1.5 使用Ribbon（负载规则替换）</h4><p><strong><mark>这里使用eureka的那一套服务</mark></strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/b190fea5a8c04bc3a024ff2f1ef8d80c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p><strong><mark>也就是不能放在主启动类所在的包及子包下</mark></strong></p><h5><a name='header-n377' class='md-header-anchor '></a>1.1.5.1 修改order模块</h5><h5><a name='header-n378' class='md-header-anchor '></a>1.1.5.2 额外建包</h5><h5><a name='header-n379' class='md-header-anchor '></a>1.1.5.3 创建配置类,指定负载均衡算法</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n380" mdtype="fences" style="break-inside: unset;">package myrule;

import com.netflix.loadbalancer.IRule;
import com.netflix.loadbalancer.RandomRule;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MySelfRule {
    @Bean
    public IRule myRule(){
        return new RandomRule(); // 定义为随机
    }
}
</pre><h5><a name='header-n381' class='md-header-anchor '></a>1.1.5.4 在主启动类上加一个注解</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n382" mdtype="fences" style="break-inside: unset;">package springcloud;

import myrule.MySelfRule;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
import org.springframework.cloud.netflix.ribbon.RibbonClient;
import org.springframework.cloud.netflix.ribbon.RibbonClients;

@SpringBootApplication
@EnableEurekaClient
@RibbonClient(name="CLOUD-PAYMENT-SERVICE",configuration = MySelfRule.class)
public class OrderMain80 {
    public static void main(String[] args) {
        SpringApplication.run(OrderMain80.class,args);
    }
}
</pre><blockquote><p><strong>表示,访问CLOUD-pAYMENT-SERVICE的服务时,使用我们自定义的负载均衡算法</strong></p></blockquote><h3><a name='header-n385' class='md-header-anchor '></a>1.2 自定义负载均衡算法</h3><h4><a name='header-n386' class='md-header-anchor '></a>1.2.1 ribbon的轮询算法原理</h4><p><img src='https://img-blog.csdnimg.cn/f62215f556564ee0af3316432ab2b001.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h4><a name='header-n388' class='md-header-anchor '></a>1.2.2 自定义负载均衡算法</h4><p><strong>给payment模块(8001,8002)的controller方法添加一个方法,返回当前节点端口</strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/ada43c856bb54b9497be03d3861a30a6.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p><strong>修改order模块</strong></p><blockquote><p>去掉@LoadBalanced</p><p><img src='https://img-blog.csdnimg.cn/9403a7a407b44247a4b4a51bcc5aebce.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n396' class='md-header-anchor '></a>1.2.3 自定义接口</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/2b671451459a45418955231af5878713.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n399' class='md-header-anchor '></a>1.2.4 接口实现类</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/82497d210a3b41b7acdae604889a20c7.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n402' class='md-header-anchor '></a>1.2.5 修改controller</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/c3063906d2544db1bbcab84dd70e6e41.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n405' class='md-header-anchor '></a>1.2.6 启动测试</h4><p>&nbsp;</p><h2><a name='header-n407' class='md-header-anchor '></a>2. OpenFeign</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/bc8352214c324fcdb991441f922ddd62.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n410' class='md-header-anchor '></a>2.1 Feign与OpenFeign区别</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/aee43b96c03a4f38af54550a7f8d502a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n413' class='md-header-anchor '></a>2.2 使用OpenFeign</h3><blockquote><p>之前的服务间调用,我们使用的是ribbon+RestTemplate</p><p>现在改为使用OpenFeign</p></blockquote><h4><a name='header-n417' class='md-header-anchor '></a>2.2.1 新建order模块</h4><blockquote><p>cloud-consumer-feign-order80</p></blockquote><h4><a name='header-n420' class='md-header-anchor '></a>2.2.2 pom.xml</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n421" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-consumer-feign-order80&lt;/artifactId&gt;

    &lt;!--openfeign--&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</pre><h4><a name='header-n422' class='md-header-anchor '></a>2.2.3 配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n423" mdtype="fences">server:
  port: 80
eureka:
  client:
    register-with-eureka: false
    service-url:
      defaultZone: http://eureka7001.com:7001/eureka, http://eureka7002.com:7002/eureka
</pre><h4><a name='header-n424' class='md-header-anchor '></a>2.2.4 主启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n425" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.openfeign.EnableFeignClients;

@SpringBootApplication
@EnableFeignClients
public class OrderFeignMain80 {
    public static void main(String[] args) {
        SpringApplication.run(OrderFeignMain80.class,args);
    }
}
</pre><h4><a name='header-n426' class='md-header-anchor '></a>2.2.5 fegin需要调用的其他的服务的接口</h4><blockquote><p>PaymentFeignService</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n429" mdtype="fences" style="break-inside: unset;">package springcloud.service;

import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;

@Component
@FeignClient("CLOUD-PAYMENT-SERVICE")
public interface PaymentFeignService {

    @GetMapping("/payment/get/{id}")
    public CommonResult&lt;Payment&gt; getPayment(@PathVariable("id") Long id);

}
</pre><h4><a name='header-n430' class='md-header-anchor '></a>2.2.6 controller类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n431" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;
import springcloud.service.PaymentFeignService;

import javax.annotation.Resource;

@RestController
@Slf4j
public class OrderFeignController {

    @Resource
    private PaymentFeignService paymentFeignService;
    @GetMapping("/consumer/payment/get/{id}")
    public CommonResult&lt;Payment&gt; getPayment(@PathVariable("id") Long id){
        return paymentFeignService.getPayment(id);
    }
}
</pre><h4><a name='header-n432' class='md-header-anchor '></a>2.2.7 启动测试</h4><blockquote><p>启动两个erueka(7001,7002)</p><p>启动两个pay(8001,8002)</p><p>启动当前的order模块</p><p><strong>Feign默认使用ribbon实现负载均衡</strong></p><p><img src='https://img-blog.csdnimg.cn/ca3c0b3e05ca48ec83f5d785da561c13.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n439' class='md-header-anchor '></a>2.3 OpenFeign超时机制</h3><p><mark>OpenFeign默认等待时间是1秒,超过1秒,直接报错</mark></p><h4><a name='header-n441' class='md-header-anchor '></a>2.3.1 配置文件设置超时时间</h4><p><strong>因为OpenFeign的底层是ribbon进行负载均衡,所以它的超时时间是由ribbon控制</strong></p><p><img src='https://img-blog.csdnimg.cn/0d25dab1cc3c4c74af4587b7fb4dddab.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><h3><a name='header-n444' class='md-header-anchor '></a>2.4 OpenFeign日志</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/867dd3b1eb7649b7951483c92a4b2c03.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>OpenFeign的日志级别</strong></p><p><img src='https://img-blog.csdnimg.cn/7c71d75bbbab4bfd89762b79dd5de221.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n449' class='md-header-anchor '></a>2.4.1 使用OpenFeign日志</h4><p><strong>实现在配置类中添加OpenFeign的日志类</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n451" mdtype="fences">package springcloud.config;

import feign.Logger;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class FeignConfig {
    @Bean
    Logger.Level feignLoggerLevel(){
        return Logger.Level.FULL;
    }
}
</pre><h4><a name='header-n452' class='md-header-anchor '></a>2.4.2 为指定类设置日志级别</h4><p><strong>配置文件</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n454" mdtype="fences">logging:
  level:
    # feign日志以什么级别监控哪个接口
    springcloud.service.PaymentFeignService: debug
</pre><h4><a name='header-n455' class='md-header-anchor '></a>2.4.3 启动服务</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/f4cb609e4c83421cae844b11aa79918d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h1><a name='header-n458' class='md-header-anchor '></a>四、服务降级</h1><h2><a name='header-n459' class='md-header-anchor '></a>1. Hystrix服务降级</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/17b430db87674f08aa669036365675dc.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>&nbsp;</p></blockquote><blockquote><p>服务降级</p><p>服务熔断</p><p>接近实时的监控</p><p>...</p></blockquote><h2><a name='header-n468' class='md-header-anchor '></a>2. Hystrix中的重要概念</h2><h3><a name='header-n469' class='md-header-anchor '></a>2.1 服务降级</h3><blockquote><p><strong>当某个服务繁忙,不能让客户端的请求一直等待,应该立刻返回给客户端一个备选方案</strong></p></blockquote><h3><a name='header-n472' class='md-header-anchor '></a>2.2 服务熔断</h3><blockquote><p><strong>当某个服务出现问题,卡死了,不能让用户一直等待,需要关闭所有对此服务的访问</strong></p><p><strong>然后调用服务降级</strong></p></blockquote><h3><a name='header-n476' class='md-header-anchor '></a>2.3 服务限流</h3><blockquote><p><strong>限流,比如秒杀场景,不能访问用户瞬间都访问服务器,限制一次只可以有多少请求</strong></p></blockquote><h3><a name='header-n479' class='md-header-anchor '></a>2.4 总结</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/7669e281cdbe4fa8aa44136b4abb54c0.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /> </p></blockquote><h2><a name='header-n482' class='md-header-anchor '></a>3. 使用服务降级</h2><h3><a name='header-n483' class='md-header-anchor '></a>3.1 创建带降级机制的pay模块 </h3><blockquote><p>cloud-provider-hystrix-payment8001</p></blockquote><h4><a name='header-n486' class='md-header-anchor '></a>3.1.1 pom.xml</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n487" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-provider-hystrix-payment8001&lt;/artifactId&gt;


    &lt;dependencies&gt;
        &lt;!--新增hystrix--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;


        &lt;dependency&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;


        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><h4><a name='header-n488' class='md-header-anchor '></a>3.1.2 配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n489" mdtype="fences" style="break-inside: unset;">server:
  port: 8001


eureka:
  client:
    register-with-eureka: true    #表识不向注册中心注册自己
    fetch-registry: true   #表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务
    service-url:
      # defaultZone: http://eureka7002.com:7002/eureka/    #设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址
      defaultZone: http://eureka7001.com:7001/eureka/
#  server:
#    enable-self-preservation: false
spring:
  application:
    name: cloud-provider-hystrix-payment
  #    eviction-interval-timer-in-ms: 2000

</pre><h4><a name='header-n490' class='md-header-anchor '></a>3.1.3 主启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n491" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;

@SpringBootApplication
@EnableEurekaClient
public class PaymentHystrixMain8001 {
    public static void main(String[] args) {
        SpringApplication.run(PaymentHystrixMain8001.class,args);
    }
}
</pre><h4><a name='header-n492' class='md-header-anchor '></a>3.1.4 service</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n493" mdtype="fences" style="break-inside: unset;">package springcloud.service;

import org.springframework.stereotype.Service;

import java.util.concurrent.TimeUnit;

@Service
public class PaymentHystrixService {

    /**
     * 正常访问OK
     * @param id
     * @return
     */
    public String paymentInfo_OK(Integer id){
        return "线程池：" + Thread.currentThread().getName() + "：paymentInfo_OK()，id：" + id + "\t" + "^_^";
    }


    /**
     * 不正常访问TIMEOUT
     * @param id
     * @return
     */
    public String paymentInfo_TIMEOUT(Integer id){
        int time = 3;
        try {
            TimeUnit.SECONDS.sleep(time);
        } catch (InterruptedException e){
            e.printStackTrace();
        }
        return "线程池：" + Thread.currentThread().getName() + "：paymentInfo_TIMEOUT()，id：" + id + "\t" + "┮﹏┭" + "耗时：" + time + "秒";
    }

}  
</pre><h4><a name='header-n494' class='md-header-anchor '></a>3.1.5 controller</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n495" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import springcloud.service.PaymentHystrixService;

import javax.annotation.Resource;

@RestController
@Slf4j
public class PaymentHystrixController {
    @Resource
    private PaymentHystrixService paymentHystrixService;
    @Value("${server.port}")
    private String serverPort;

    @GetMapping("/payment/hystrix/ok/{id}")
    public String paymentInfo_OK(@PathVariable("id") Integer id){
        String result = paymentHystrixService.paymentInfo_OK(id);
        log.info("result：" + result);
        return result;
    }

    @GetMapping("/payment/hystrix/timeout/{id}")
    public String paymentInfo_TIMEOUT(@PathVariable("id") Integer id){
        String result = paymentHystrixService.paymentInfo_TIMEOUT(id);
        log.info("result：" + result);
        return result;
    }

}
</pre><h4><a name='header-n496' class='md-header-anchor '></a>3.1.6 测试</h4><blockquote><p>此时使用压测工具,并发20000个请求,请求会延迟的那个方法,</p><p>压测中,发现,另外一个方法并没有被压测,但是我们访问它时,却需要等待</p><p>这就是因为被压测的方法它占用了服务器大部分资源,导致其他请求也变慢了</p></blockquote><h4><a name='header-n501' class='md-header-anchor '></a>3.1.7 不加入hystrix测试</h4><blockquote><p>JMeter高并发压测后卡顿（连坐效应）</p></blockquote><h3><a name='header-n504' class='md-header-anchor '></a>3.2 创建带降级的order模块</h3><h4><a name='header-n505' class='md-header-anchor '></a>3.2.1 创建</h4><blockquote><p>cloud-consumer-feign-hystrix-order80</p></blockquote><h4><a name='header-n508' class='md-header-anchor '></a>3.2.2 pom.xml</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n509" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-consumer-feign-hystrix-order80&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!--新增hystrix--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><h4><a name='header-n510' class='md-header-anchor '></a>3.2.3 配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n511" mdtype="fences" style="break-inside: unset;">server:
  port: 80


eureka:
  client:
    register-with-eureka: true    #表识不向注册中心注册自己
    fetch-registry: true   #表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务
    service-url:
             defaultZone: http://eureka7001.com:7001/eureka/

spring:
  application:
    name: cloud-consumer-feign-hystrix-order
</pre><h4><a name='header-n512' class='md-header-anchor '></a>3.2.4 主启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n513" mdtype="fences" style="break-inside: unset;">package springcloud;

import org.aspectj.weaver.ast.Or;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.openfeign.EnableFeignClients;

@SpringBootApplication
@EnableFeignClients
public class OrderHystrixMain80 {
    public static void main(String[] args) {
        SpringApplication.run(OrderHystrixMain80.class,args);
    }
}
</pre><h4><a name='header-n514' class='md-header-anchor '></a>3.2.5 远程调用payment模块的接口</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n515" mdtype="fences" style="break-inside: unset;">package springcloud.service;

import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

@Component
@FeignClient(value = "CLOUD-PROVIDER-HYSTRIX-PAYMENT")
public interface PaymentHystrixService {

    @GetMapping("/payment/hystrix/ok/{id}")
    public String paymentInfo_OK(@PathVariable("id") Integer id);

    @GetMapping("/payment/hystrix/timeout/{id}")
    public String paymentInfo_TIMEOUT(@PathVariable("id") Integer id);
}
</pre><h4><a name='header-n516' class='md-header-anchor '></a>3.2.6 controller类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n517" mdtype="fences" style="break-inside: unset;"> package springcloud.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import springcloud.service.PaymentHystrixService;

import javax.annotation.Resource;

@Slf4j
@RestController
public class OrderHystrixController {
    @Resource
    private PaymentHystrixService paymentHystrixService;
    @GetMapping("/consumer/payment/hystrix/ok/{id}")

    public String paymentInfo_OK(@PathVariable("id") Integer id){
        String result = paymentHystrixService.paymentInfo_OK(id);
        return result;
    }

    @GetMapping("/consumer/payment/hystrix/timeout/{id}")
    public String paymentInfo_TIMEOUT(@PathVariable("id") Integer id){
        String result = paymentHystrixService.paymentInfo_TIMEOUT(id);
        return result;
    }
}
</pre><h4><a name='header-n518' class='md-header-anchor '></a>3.2.7 启动测试</h4><blockquote><p>启动order模块,访问payment模块</p><p>再次压测2万并发,发现order访问也变慢了</p><p><img src='https://img-blog.csdnimg.cn/4a7964ea118b47c6ab363a00831f4042.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n523' class='md-header-anchor '></a>3.3 配置服务降级</h3><h4><a name='header-n524' class='md-header-anchor '></a>3.3.1 修改payment模块</h4><blockquote><p>为service的指定方法(会延迟的方法)添加@HystrixCommand注解</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n527" mdtype="fences" style="break-inside: unset;">package springcloud.service;

import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;
import org.springframework.stereotype.Service;

import java.util.concurrent.TimeUnit;

@Service
public class PaymentHystrixService {

    /**
     * 正常访问OK
     * @param id
     * @return
     */
    public String paymentInfo_OK(Integer id){
        return "线程池：" + Thread.currentThread().getName() + "：paymentInfo_OK()，id：" + id + "\t" + "^_^";
    }


    /**
     * 不正常访问TIMEOUT
     * @param id
     * @return
     */


    @HystrixCommand(fallbackMethod = "paymentInfo_TIMEOUTHANDLER",commandProperties = {
            @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds",value = "2000")
    })
    public String paymentInfo_TIMEOUT(Integer id){
        int time = 3;
        try {
            TimeUnit.SECONDS.sleep(time);
        } catch (InterruptedException e){
            e.printStackTrace();
        }
        return "线程池：" + Thread.currentThread().getName() + "：paymentInfo_TIMEOUT()，id：" + id + "\t" + "┮﹏┭" + "耗时：" + time + "秒";
    }

    public String paymentInfo_TIMEOUTHANDLER(Integer id){
        return "线程池：" + Thread.currentThread().getName() + "：paymentInfo_TIMEOUT()，id：" + id + "\t" + "：服务超时或服务异常-┮﹏┭";
    }

}
</pre><blockquote><p>主启动类上,添加激活hystrix的注解</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n530" mdtype="fences" style="break-inside: unset;">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;

@SpringBootApplication
@EnableEurekaClient
@EnableCircuitBreaker
public class PaymentHystrixMain8001 {
    public static void main(String[] args) {
        SpringApplication.run(PaymentHystrixMain8001.class,args);
    }
}
</pre><blockquote><p>触发异常</p><p>触发降级</p></blockquote><h4><a name='header-n534' class='md-header-anchor '></a>3.3.2 修改order模块进行服务降级</h4><p>一般服务降级,都是放在客户端(order模块)</p><h5><a name='header-n536' class='md-header-anchor '></a>3.3.2.1 修改配置文件</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n537" mdtype="fences">feign:
  hystrix:
    enabled: true
</pre><h5><a name='header-n538' class='md-header-anchor '></a>3.3.2.2 主启动类添加</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n539" mdtype="fences">@EnableHystrix
</pre><h5><a name='header-n540' class='md-header-anchor '></a>3.3.2.3 修改controller添加降级方法等</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n541" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import springcloud.service.PaymentHystrixService;

import javax.annotation.Resource;
import java.util.concurrent.TimeUnit;

@Slf4j
@RestController
public class OrderHystrixController {
    @Resource
    private PaymentHystrixService paymentHystrixService;
    @GetMapping("/consumer/payment/hystrix/ok/{id}")

    public String paymentInfo_OK(@PathVariable("id") Integer id){
        String result = paymentHystrixService.paymentInfo_OK(id);
        return result;
    }

    @GetMapping("/consumer/payment/hystrix/timeout/{id}")
    @HystrixCommand(fallbackMethod = "paymentInfo_TIMEOUTHANDLER",commandProperties = {
            @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds",value = "1500")
    })
    public String paymentInfo_TIMEOUT(@PathVariable("id") Integer id){
        String result = paymentHystrixService.paymentInfo_TIMEOUT(id);
        return result;
    }

    public String paymentInfo_TIMEOUTHANDLER(Integer id){
        return "消费者80端口，对方支付系统繁忙或自身运行异常出错┭┮﹏┭┮";
    }
}
</pre><h5><a name='header-n542' class='md-header-anchor '></a>3.3.2.4 启动测试</h5><blockquote><p>启动payment模块、order模块</p><p><strong>注意:,这里pay模块和order模块都开启了服务降级</strong></p><p> 但是order这里,设置了1.5秒就降级,所以访问时,一定会降级</p></blockquote><h4><a name='header-n547' class='md-header-anchor '></a>3.3.3 重构</h4><p><strong>上面出现的问题:</strong></p><blockquote><p>1,降级方法与业务方法写在了一块,耦合度高</p><p>2.每个业务方法都写了一个降级方法,重复代码多</p></blockquote><h5><a name='header-n552' class='md-header-anchor '></a>3.3.3.1 解决重复代码的问题</h5><p><strong>配置一个全局的降级方法,所有方法都可以走这个降级方法,至于某些特殊创建,再单独创建方法</strong></p><h6><a name='header-n554' class='md-header-anchor '></a>3.3.3.1.1 创建一个全局方法</h6><h6><a name='header-n555' class='md-header-anchor '></a>3.3.3.1.2 使用注解指定其为全局降级方法(默认降级方法)</h6><p>&nbsp;</p><h6><a name='header-n557' class='md-header-anchor '></a>3.3.3.1.3 业务方法使用默认降级方法</h6><h6><a name='header-n558' class='md-header-anchor '></a>3.3.3.1.4 测试</h6><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n559" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import com.netflix.hystrix.contrib.javanica.annotation.DefaultProperties;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import springcloud.service.PaymentHystrixService;

import javax.annotation.Resource;
import java.util.concurrent.TimeUnit;

@Slf4j
@RestController
@DefaultProperties(defaultFallback = "payment_Global_FallbackMethod")
public class OrderHystrixController {
    @Resource
    private PaymentHystrixService paymentHystrixService;
    @GetMapping("/consumer/payment/hystrix/ok/{id}")

    public String paymentInfo_OK(@PathVariable("id") Integer id){
        String result = paymentHystrixService.paymentInfo_OK(id);
        return result;
    }

    @GetMapping("/consumer/payment/hystrix/timeout/{id}")
    /**
    @HystrixCommand(fallbackMethod = "paymentInfo_TIMEOUTHANDLER",commandProperties = {
            @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds",value = "1500")
    })
    */
    @HystrixCommand
    public String paymentInfo_TIMEOUT(@PathVariable("id") Integer id){
        String result = paymentHystrixService.paymentInfo_TIMEOUT(id);
        return result;
    }

    public String paymentInfo_TIMEOUTHANDLER(Integer id){
        return "消费者80端口，对方支付系统繁忙或自身运行异常出错┭┮﹏┭┮";
    }

    //全局fallback方法
    public String payment_Global_FallbackMethod(){
        return "全局Fallback：消费者80端口，对方支付系统繁忙或自身运行异常出错┭┮﹏┭┮";
    }

}
</pre><h5><a name='header-n560' class='md-header-anchor '></a>3.3.3.2 解决代码耦合度的问题</h5><p>修改order模块,这里开始,payment模块就不服务降级了,服务降级写在order模块即可</p><h6><a name='header-n562' class='md-header-anchor '></a>3.3.3.2.1 Payservice接口是远程调用pay模块的,我们这里创建一个类实现service接口,在实现类中统一处理异常</h6><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n563" mdtype="fences" style="break-inside: unset;">package springcloud.service;


import org.springframework.stereotype.Component;

@Component
public class PaymentFallbackService implements PaymentHystrixService {
    @Override
    public String paymentInfo_OK(Integer id) {
        return "PaymentFallbackService异常处理：paymentInfo_OK";
    }

    @Override
    public String paymentInfo_TIMEOUT(Integer id) {
        return "PaymentFallbackService异常处理：paymentInfo_TIMEOUT";
    }
}
</pre><h6><a name='header-n564' class='md-header-anchor '></a>3.3.3.2.2 修改配置文件:添加</h6><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n565" mdtype="fences">feign:
  hystrix:
    enabled: true
</pre><h6><a name='header-n566' class='md-header-anchor '></a>3.3.3.2.3 让PayService的实现类生效</h6><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n567" mdtype="fences" style="break-inside: unset;">package springcloud.service;

import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

@Component
@FeignClient(value = "CLOUD-PROVIDER-HYSTRIX-PAYMENT",fallback = PaymentFallbackService.class)
public interface PaymentHystrixService {

    @GetMapping("/payment/hystrix/ok/{id}")
    public String paymentInfo_OK(@PathVariable("id") Integer id);

    @GetMapping("/payment/hystrix/timeout/{id}")
    public String paymentInfo_TIMEOUT(@PathVariable("id") Integer id);
}
</pre><blockquote><p>它的运行逻辑是:
        </p><p>当请求过来,首先还是通过Feign远程调用pay模块对应的方法
        </p><p>但是如果pay模块报错,调用失败,那么就会调用PayMentFalbackService类的
        </p><p>当前同名的方法,作为降级方法</p></blockquote><h6><a name='header-n573' class='md-header-anchor '></a>3.3.3.2.4 启动测试</h6><blockquote><p>启动order和payment正常访问</p><p><mark>将payment服务关闭,order再次访问</mark></p><p>可以看到,并没有报500错误,而是降级访问<mark>实现类</mark>的同名方法</p><p>这样,即使服务器挂了,用户要不要一直等待,或者报错</p><p>问题:</p><p>        <strong>这样虽然解决了代码耦合度问题,但是又出现了过多重复代码的问题,每个方法都有一个降级方法</strong></p></blockquote><h2><a name='header-n581' class='md-header-anchor '></a>4. 使用服务熔断</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/4b3db60e65a34f80b19e7307e4321b24.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n584' class='md-header-anchor '></a>4.1 修改前面的payment模块</h3><h4><a name='header-n585' class='md-header-anchor '></a>4.1.1 修改Payservice接口,添加服务熔断相关的方法</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n586" mdtype="fences" style="break-inside: unset;">    /**服务熔断*/
    @HystrixCommand(fallbackMethod = "paymentCircuitBreaker_fallback",commandProperties = {
            @HystrixProperty(name = "circuitBreaker.enabled",value = "true"),  //是否开启断路器
            @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold",value = "10"),   //请求次数
            @HystrixProperty(name = "circuitBreaker.sleepWindowInMilliseconds",value = "10000"),  //时间范围
            @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage",value = "60"), //失败率达到多少后跳闸
    })
    public String paymentCircuitBreaker(@PathVariable("id") Integer id){
        if (id &lt; 0){
            throw new RuntimeException("*****id 不能负数");
        }
        String serialNumber = IdUtil.simpleUUID();
        return Thread.currentThread().getName()+"\t"+"调用成功,流水号："+serialNumber;
    }
    public String paymentCircuitBreaker_fallback(@PathVariable("id") Integer id) {
        return "id 不能负数，请稍候再试,(┬＿┬)/~~     id: " + id;
    }
</pre><blockquote><p>这里属性整体意思是:
10秒之内(窗口,会移动),如果并发<mark>超过</mark>10个,或者10个并发中,失败了6个,就开启熔断器</p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/a832bc652b66483a9f40ea376a2ac03a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p>IdUtil是Hutool包下的类,这个Hutool就是整合了所有的常用方法,比如UUID,反射,IO流等工具方法什么的都整合了</p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/d40f0ac788ea46b19cccfaa820f20001.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p>断路器的打开和关闭,是按照一下5步决定的
        </p><p>1,并发此时是否达到我们指定的阈值
        </p><p>2,错误百分比,比如我们配置了60%,那么如果并发请求中,10次有6次是失败的,就开启断路器
        </p><p>3,上面的条件符合,断路器改变状态为open(开启)
        </p><p>4,这个服务的断路器开启,所有请求无法访问
        </p><p>5,在我们的时间窗口期,期间,尝试让一些请求通过(半开状态),如果请求还是失败,证明断路器还是开启状态,服务没有恢复
，如果请求成功了,证明服务已经恢复,断路器状态变为close关闭状态</p></blockquote><h4><a name='header-n602' class='md-header-anchor '></a>4.1.2 修改controller类</h4><p>添加一个测试方法</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n604" mdtype="fences">/**服务熔断*/
@GetMapping("/payment/circuit/{id}")
public String paymentCircuitBreaker(@PathVariable("id")Integer id){
    String result = paymentHystrixService.paymentCircuitBreaker(id);
    log.info("result：" + result);
    return result;
}
</pre><h4><a name='header-n605' class='md-header-anchor '></a>4.1.3 测试</h4><blockquote><p>启动payment,order模块</p><p><mark>多次访问,并且错误率超过60%</mark></p><p>此时服务熔断,此时即使访问正确的也会报错</p><p><strong>但是,当过了几秒后,又恢复了</strong></p><p> 因为在10秒窗口期内,它自己会尝试接收部分请求,发现服务可以正常调用,慢慢的当错误率低于60%,取消熔断</p></blockquote><h2><a name='header-n612' class='md-header-anchor '></a>5. Hystrix所有可配置的属性</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/8ac174324eb54669af2b1aa783aa2596.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h2><a name='header-n615' class='md-header-anchor '></a>6. 总结</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/ac11a8b4ebe148dca6f2f4ddc3f84f3a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p><strong><mark>当断路器开启后:</mark></strong></p><p><img src='https://img-blog.csdnimg.cn/a6435c393ac14cec90a710595660e579.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p><strong><mark>其他参数:</mark></strong></p><p><img src='https://img-blog.csdnimg.cn/fd86c34ce6f746698727e544ba51da46.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/e7f28876322e42dd95009fddb37db8de.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/58031c70826644e2b571f304a6cf2d54.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p><strong>熔断整体流程</strong>：</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="txt" contenteditable="false" cid="n629" mdtype="fences" style="break-inside: unset;">1请求进来,首先查询缓存,如果缓存有,直接返回
        如果缓存没有,---&gt;2
        2,查看断路器是否开启,如果开启的,Hystrix直接将请求转发到降级返回,然后返回
        如果断路器是关闭的,
        判断线程池等资源是否已经满了,如果已经满了
        也会走降级方法
        如果资源没有满,判断我们使用的什么类型的Hystrix,决定调用构造方法还是run方法
        然后处理请求
        然后Hystrix将本次请求的结果信息汇报给断路器,因为断路器此时可能是开启的
        (因为断路器开启也是可以接收请求的)
        断路器收到信息,判断是否符合开启或关闭断路器的条件,
        如果本次请求处理失败,又会进入降级方法
        如果处理成功,判断处理是否超时,如果超时了,也进入降级方法
        最后,没有超时,则本次请求处理成功,将结果返回给controller
</pre><h3><a name='header-n630' class='md-header-anchor '></a>6.1 Hystrix服务监控</h3><h4><a name='header-n631' class='md-header-anchor '></a>6.1.1 HystrixDashboard</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/c2d593b4b0904c978b9ec688c80578b7.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n634' class='md-header-anchor '></a>6.1.2,使用HystrixDashboard</h4><h5><a name='header-n635' class='md-header-anchor '></a>6.1.2.1 创建项目</h5><blockquote><p>cloud-consumer-hystrix-dashboard9001</p></blockquote><h5><a name='header-n638' class='md-header-anchor '></a>6.1.2.2 pom.xml</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n639" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-consumer-hystrix-dashboard9001&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!--新增hystrix dashboard--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><h5><a name='header-n640' class='md-header-anchor '></a>6.1.2.3 配置文件</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n641" mdtype="fences">server:
  port: 9001
</pre><h5><a name='header-n642' class='md-header-anchor '></a>6.1.2.4 主启动类</h5><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n643" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;

@SpringBootApplication
@EnableHystrixDashboard
public class HystrixDashboardMain9001 {
    public static void main(String[] args) {
        SpringApplication.run(HystrixDashboardMain9001.class,args);
    }
}
</pre><h5><a name='header-n644' class='md-header-anchor '></a>6.1.2.5 修改所有payment模块(8001,8002,8003...)</h5><p><strong>添加一个pom依赖</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n646" mdtype="fences">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre><p>之前的pom文件中都添加过了,<mark>这个是springboot的监控组件</mark></p><h5><a name='header-n648' class='md-header-anchor '></a>6.1.2.6 启动9001</h5><blockquote><p>访问: <strong>localhost:9001/hystrix</strong></p></blockquote><h5><a name='header-n651' class='md-header-anchor '></a>6.1.2.7 注意</h5><blockquote><p>此时仅仅是可以访问HystrixDashboard,并不代表已经监控了8001,8002</p><p>如果要监控,还需要配置:(8001为例)</p></blockquote><p><mark>8001的主启动类添加:</mark></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n656" mdtype="fences" style="break-inside: unset;">package springcloud;

import com.netflix.hystrix.contrib.metrics.eventstream.HystrixMetricsStreamServlet;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.web.servlet.ServletRegistrationBean;
import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
import org.springframework.context.annotation.Bean;

@SpringBootApplication
@EnableEurekaClient
@EnableCircuitBreaker //打开熔断器
public class PaymentHystrixMain8001 {
    public static void main(String[] args) {
        SpringApplication.run(PaymentHystrixMain8001.class,args);
    }
    @Bean
    public ServletRegistrationBean getServlet(){
        HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet();
        ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet);
        registrationBean.setLoadOnStartup(1);
        registrationBean.addUrlMappings("/hystrix.stream");
        registrationBean.setName("HystrixMetricsStreamServlet");
        return registrationBean;
    }
}
</pre><p><strong>其他8002,8003都是一样的</strong></p><h5><a name='header-n658' class='md-header-anchor '></a>6.1.2.8 启动服务</h5><blockquote><p>启动7001,8001,9001</p><p><strong>然后在web界面,指定9001要监控8001</strong></p><p><a href='http://localhost:8001/hystrix.stream' target='_blank' class='url'>http://localhost:8001/hystrix.stream</a></p><p>先触发fallback后，dashboard才会显示数据，否则loading...</p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/c33ad3bb1ba84804890d6b017c70177c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/4900f7c56c274ae7903a14ab4e31ebde.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/12997c01c4b145f2bbccf1a230669902.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/24430a313de5491191b758b1ea72fe12.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/49b221b66f4a4ac682dc9df61e7bfe01.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h1><a name='header-n670' class='md-header-anchor '></a>五、服务网关</h1><blockquote><p>zuul已停更</p></blockquote><h2><a name='header-n673' class='md-header-anchor '></a>1. GateWay</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/d18771b315d84418a51c0f6cd2a5357c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>gateway之所以性能好,因为底层使用WebFlux,而webFlux底层使用netty通信(NIO)</strong></p><p><img src='https://img-blog.csdnimg.cn/f5b1563218014541ae100863ad6aff1f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n678' class='md-header-anchor '></a>1.1 GateWay的特性</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/a1211537e1f24126b54d02c7daf71de2.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n681' class='md-header-anchor '></a>1.2 GateWay与zuul的区别</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/be350426fa3142929ce2faef7420e15a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n684' class='md-header-anchor '></a>1.3 zuul1.x的模型</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/c689890415d14b70af810215db8375da.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/96b786b8bdaa4b82ad7e965e70c0e240.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n688' class='md-header-anchor '></a>1.4 什么是webflux</h3><p><strong>是一个非阻塞的web框架,类似springmvc</strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/d71ddb63b4b74a31bec0a263fa597f50.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n692' class='md-header-anchor '></a>1.5 GateWay的一些概念</h3><h4><a name='header-n693' class='md-header-anchor '></a>1.5.1 路由</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/acc3da9579a541eab4f5cdd41e354fd2.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n696' class='md-header-anchor '></a>1.5.2 断言</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/620e74ce2656421cb0ffe99a1789fe88.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n699' class='md-header-anchor '></a>1.5.3 过滤</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/7965fd0b7c26423097f85a7a17da5ff9.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n702' class='md-header-anchor '></a>1.6 GateWay的工作原理</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/045767dda6424dde822e70f5df81730b.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/2c491cfd8b4549b98fcee16f41a1ddc1.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n706' class='md-header-anchor '></a>1.7 使用GateWay</h3><blockquote><p>cloud-gateway-gateway9527</p></blockquote><h4><a name='header-n709' class='md-header-anchor '></a>1.7.1 pom.xml</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n710" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloud-gateway-gateway9527&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!--新增gateway--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;


    &lt;/dependencies&gt;


&lt;/project&gt;
</pre><h4><a name='header-n711' class='md-header-anchor '></a>1.7.2 配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n712" mdtype="fences" style="break-inside: unset;">server:
  port: 9527

spring:
  application:
    name: cloud-gateway

eureka:
  instance:
    hostname: cloud-gateway-service
  client: # 服务提供者provider注册进eureka服务列表内
    service-url:
      register-with-eureka: true
      fetch-registry: true
      defaultZone: http://eureka7001.com:7001/eureka
</pre><h4><a name='header-n713' class='md-header-anchor '></a>1.7.3 主启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n714" mdtype="fences" style="break-inside: unset;">package springcloud;


import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;

@SpringBootApplication
@EnableEurekaClient
public class GatewayMain9527 {
    public static void main(String[] args) {
        SpringApplication.run(GatewayMain9527.class,args);
    }
}
</pre><h4><a name='header-n715' class='md-header-anchor '></a>1.7.4 针对payment模块设置路由</h4><blockquote><p>cloud-provider-payment8001</p><p>目前不想暴露8001端口，希望在8001外面套一层9527</p></blockquote><p><strong><mark>修改GateWay模块(9527)的配置文件</mark></strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n720" mdtype="fences" style="break-inside: unset;">spring:
  application:
    name: cloud-gateway
  cloud:
    gateway:
      routes:
        - id: payment_routh #路由的ID，没有固定规则但要求唯一，建议配合服务名
          uri: http://localhost:8001   #匹配后提供服务的路由地址
          predicates:
            - Path=/payment/get/**   #断言,路径相匹配的进行路由

        - id: payment_routh2
          uri: http://localhost:8001
          predicates:
            - Path=/payment/lb/**   #断言,路径相匹配的进行路由
</pre><blockquote><p>这里表示</p><p>当访问localhost:9527/payment/get/1时</p><p>路由到localhost:8001/payment/get/1</p></blockquote><h4><a name='header-n725' class='md-header-anchor '></a>1.7.5 启动测试</h4><p><strong>启动7001,8001,9527</strong></p><blockquote><p>如果启动GateWay报错，可能是GateWay模块引入了web和监控的starter依赖,需要移除</p></blockquote><blockquote><p>访问：localhost:9527/payment/get/1</p><p><img src='https://img-blog.csdnimg.cn/5600f5896a494fe4a69b0f82dd7f611d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n732' class='md-header-anchor '></a>1.7.6 GateWay的网关配置</h4><blockquote><p><strong>GateWay的网关配置,除了支持配置文件,还支持硬编码方式</strong></p></blockquote><h4><a name='header-n735' class='md-header-anchor '></a>1.7.7 使用硬编码配置GateWay</h4><h5><a name='header-n736' class='md-header-anchor '></a>1.7.7.1 创建配置类</h5><blockquote><p><img src='https://img-blog.csdnimg.cn/c97af2bed7b2470db4254f09b65fd8c5.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h5><a name='header-n739' class='md-header-anchor '></a>1.7.7.2 重启服务</h5><h3><a name='header-n740' class='md-header-anchor '></a>1.8 重构</h3><blockquote><p>上面的配置虽然首先了网关,但是是在配置文件中写死了要路由的地址</p><p>现在需要修改,不指定地址,而是根据微服务名字进行路由,我们可以在注册中心获取某组微服务的地址</p><p>需要:</p><p> 1个eureka,2个payment模块</p></blockquote><h4><a name='header-n746' class='md-header-anchor '></a>1.8.1 修改GateWay模块的配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n747" mdtype="fences" style="break-inside: unset;">server:
  port: 9527

spring:
  application:
    name: cloud-gateway
  cloud:
    gateway:
      routes:
        - id: payment_routh #路由的ID，没有固定规则但要求唯一，建议配合服务名
#          uri: http://localhost:8001   #匹配后提供服务的路由地址
           uri: lb://cloud-payment-service # 匹配后提供服务的路由地址
          predicates:
            - Path=/payment/get/**   #断言,路径相匹配的进行路由
      discovery:
        locator:
          enabled: true # 开启从注册中心动态创建路由的功能，利用微服务名进行路由

#        - id: payment_routh2
#          uri: http://localhost:8001
#          predicates:
#            - Path=/payment/lb/**   #断言,路径相匹配的进行路由


eureka:
  instance:
    hostname: cloud-gateway-service
  client:
    service-url:
      register-with-eureka: true
      fetch-registry: true
      defaultZone: http://eureka7001.com:7001/eureka 
</pre><h4><a name='header-n748' class='md-header-anchor '></a>1.8.2 启动测试</h4><h3><a name='header-n749' class='md-header-anchor '></a>1.9 Pridicate断言</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/c1033e61aa7241229a83f04667a31987.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>我们之前在配置文件中配置了断言:</strong></p><p><img src='https://img-blog.csdnimg.cn/f49ad3213501424184ad8829b902bf89.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>这个断言表示,如果外部访问路径是指定路径,就路由到指定微服务上</strong></p><p>可以看到,这里有一个Path,这个是断言的一种,<mark>断言的类型</mark>:</p><p><img src='https://img-blog.csdnimg.cn/1713a710d74f4ebe8c62402aae34dd90.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n757" mdtype="fences">After:可以指定,只有在指定时间后,才可以路由到指定微服务
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n758" mdtype="fences">predicates:
  - Path=/payment/get/**
  - After=2020-02-21T15:51:37.485+08:00[Asia/Shanghai]
</pre><blockquote><p>这里表示,只有在<mark>2020年的2月21的15点51分37秒</mark>之后,访问<mark>才可以路由</mark></p><p> 在此之前的访问,都会报404</p><p>如何获取当前时区?</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n763" mdtype="fences">ZoneDateTime zbj = ZoneDateTime.now(); // 默认时区
Sysytem.out.println(zbj); // 获取时区
</pre></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n764" mdtype="fences">before:
    与after类似,他说在指定时间之前的才可以访问
between:
    需要指定两个时间,在他们之间的时间才可以访问
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n765" mdtype="fences">predicates:
  - Path=/payment/get/**
  - Between=2020-02-21T15:51:37.485+08:00[Asia/Shanghai],2020-02-21T15:51:37.485+08:00[Asia/Shanghai]
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n766" mdtype="fences">cookie:
    只有包含某些指定cookie(key,value),的请求才可以路由
</pre><blockquote><p><img src='https://img-blog.csdnimg.cn/d7194df5e5704b189af40a4dfdfc8cee.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n769" mdtype="fences">Header:
    只有包含指定请求头的请求,才可以路由
</pre><blockquote><p><img src='https://img-blog.csdnimg.cn/86aed257f0004696a0aede81c914532f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n772" mdtype="fences">host:
    只有指定主机的才可以访问,
    比如我们当前的网站的域名是www.aa.com
    那么这里就可以设置,只有用户是www.aa.com的请求,才进行路由
</pre><blockquote><p><img src='https://img-blog.csdnimg.cn/776a61b8a405494592b038fda4be873a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n775" mdtype="fences">method:
    只有指定请求才可以路由,比如get请求...
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n776" mdtype="fences">predicates:
  - Method=GET
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n777" mdtype="fences">path:
    只有访问指定路径,才进行路由
    比如访问,/abc才路由
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n778" mdtype="fences">predicates:
  - Path=/payment/get/**
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n779" mdtype="fences">Query:
    必须带有请求参数才可以访问
</pre><blockquote><p><img src='https://img-blog.csdnimg.cn/4c5f9cd02eb947daa325de4a1a9ce8e2.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n782' class='md-header-anchor '></a>1.10 Filter过滤器</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/f986a4a42a6d4bf692bd25f914e9dadf.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n785' class='md-header-anchor '></a>1.10.1 生命周期</h4><blockquote><p><strong>在请求进入路由之前,和处理请求完成,再次到达路由之前</strong></p></blockquote><h4><a name='header-n788' class='md-header-anchor '></a>1.10.2 种类</h4><blockquote><p>GateWayFilter,单一的过滤器</p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/816d685e4fa04bd4bfbdb423fd1e8127.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p>GlobalFilter,全局过滤器</p></blockquote><h4><a name='header-n795' class='md-header-anchor '></a>1.10.3 自定义过滤器</h4><blockquote><p>实现两个接口</p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/e3a1495da7b948d4be155e2267fd3f86.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p><strong>然后启动服务,即可,因为过滤器通过@COmponet已经加入到容器了</strong></p><p>localhost:9527/payment/lb?uname=z3erqwe</p></blockquote><h1><a name='header-n803' class='md-header-anchor '></a>六、服务配置</h1><h2><a name='header-n804' class='md-header-anchor '></a>1. Spring Config分布式配置中心</h2><p><mark>微服务面临的问题</mark></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n806" mdtype="fences">可以看到,每个微服务都需要一个配置文件,并且,如果有几个微服务都需要连接数据库
那么就需要配4次数据库相关配置,并且当数据库发生改动,那么需要同时修改4个微服务的配置文件才可以
</pre><blockquote><p>所以产生springconfig配置中心</p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/35b46425b40441a1880baa23b924c2ce.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n811' class='md-header-anchor '></a>1.1 使用配置中心</h3><h4><a name='header-n812' class='md-header-anchor '></a>1.1.1 使用github作为配置中心的仓库</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/d5376a20ca664b0a90748868433cd716.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n815' class='md-header-anchor '></a>1.1.2 新建config模块</h4><blockquote><p>cloud-config-3344</p></blockquote><h4><a name='header-n818' class='md-header-anchor '></a>1.1.3 pom.xml</h4><h4><a name='header-n819' class='md-header-anchor '></a>1.1.4 配置文件</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/0b8cb97b6ff24ac6a39585c54f57fe37.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n822' class='md-header-anchor '></a>1.1.5 主启动类</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/571fcd2fdf2a4051827bbdf7b96b8dc4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n825' class='md-header-anchor '></a>1.1.6 修改hosts</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/2122c7c84244458ab4733a7ef1e70102.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n828' class='md-header-anchor '></a>1.1.7 配置完成</h4><blockquote><p>测试,3344是否可以从github上获取配置</p><p>启动3344    (要先启动eureka)</p><p><img src='https://img-blog.csdnimg.cn/1e1d5b025c654ce99ae9ff9f56f85521.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p>它实际上就是,读取到配置文件中的GitHub的地址,然后拼接上/master/config-dev.yml</p></blockquote><h4><a name='header-n835' class='md-header-anchor '></a>1.1.8 读取配置文件的规则</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/4ab53064b3eb40219605e1ef1e528336.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/806514e0f04243c088899a20830f38ac.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n839' class='md-header-anchor '></a>1.2 创建配置中心客户端</h3><h4><a name='header-n840' class='md-header-anchor '></a>1.2.1 创建config客户端项目</h4><blockquote><p>cloud-config-client-3355</p></blockquote><h4><a name='header-n843' class='md-header-anchor '></a>1.2.2 pom.xml</h4><h4><a name='header-n844' class='md-header-anchor '></a>1.2.3 配置文件</h4><blockquote><p>注意这个配置文件就不是application.yml</p><p> 而是bootstrap.yml</p><p>这个配置文件的作用是,先到配置中心加载配置,然后加载到application.yml中</p><p><img src='https://img-blog.csdnimg.cn/8ee4ce44116a4e1493eb642ac925354a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n850' class='md-header-anchor '></a>1.2.4 主启动类</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/7f1cf27a03e542fb941eec1174c3a90f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n853' class='md-header-anchor '></a>1.2.5 controller类</h4><blockquote><p>就是上面提到的,以rest风格将配置对外暴露</p><p><img src='https://img-blog.csdnimg.cn/db1cb05c30ee46e6bbd1ff3f870c69e3.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n857' class='md-header-anchor '></a>1.2.6 测试</h4><blockquote><p>启动3344,3355</p><p>访问3355的 /configInfo</p><p><img src='https://img-blog.csdnimg.cn/634ba7412d094cd7bf079fd0bce0b730.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n862' class='md-header-anchor '></a>1.2.7 问题</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n863" mdtype="fences">上面3355确实获取到了配置文件,但是如果此时配置文件修改了,3355是获取不到的
3344可以实时获取到最新配置文件,但是3355却获取不到
除非重启服务
</pre><h4><a name='header-n864' class='md-header-anchor '></a>1.2.8 实现动态刷新</h4><h5><a name='header-n865' class='md-header-anchor '></a>1.2.8.1 修改3355,添加pom依赖</h5><blockquote><p><img src='https://img-blog.csdnimg.cn/f1ebb734299248ef898ced87ec41077d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h5><a name='header-n868' class='md-header-anchor '></a>1.2.8.2 修改配置文件,添加配置</h5><blockquote><p><img src='https://img-blog.csdnimg.cn/605fb90b5004445a929abb04b188f9ca.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h5><a name='header-n871' class='md-header-anchor '></a>1.2.8.3 修改controller</h5><blockquote><p><img src='https://img-blog.csdnimg.cn/b31d05a716d74ba487164d113d3f3ed9.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h5><a name='header-n874' class='md-header-anchor '></a>1.2.8.4 重启服务</h5><blockquote><p><strong>此时3355还不可以动态获取</strong></p><p>因为此时,还需要<mark>外部</mark>发送post请求通知3355</p><p><img src='https://img-blog.csdnimg.cn/989c2634595d4c67b3485626e37ad45d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>此时在刷新3355,发现可以获取到最新的配置文件了,这就实现了动态获取配置文件,因为3355并没有重启</strong></p><p>具体流程就是:</p><p> 我们启动好服务后</p><p> 运维人员,修改了配置文件,然后发送一个post请求通知3355</p><p> 3355就可以获取最新配置文件</p><p><strong>问题:</strong></p><p> 如果有多个客户端怎么办(3355,3356,3357.....)</p><p> 虽然可以使用shell脚本,循环刷新</p><p> 但是,可不可以使用广播,一次通知??</p><p> 这些springconfig做不到,需要使用springcloud Bus消息总线</p></blockquote><h1><a name='header-n889' class='md-header-anchor '></a>七、消息总线</h1><h2><a name='header-n890' class='md-header-anchor '></a>1. SpringCloud Bus</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/f19bda875a0e479b8011a985b0989443.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/3b9d42ec443e480d96034e18f682bbe0.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>注意,这里年张图片,就代表两种广播方式</p><p> 图1:        <strong>它是Bus直接通知给其中一个客户端,由这个客户端开始蔓延,传播给其他所有客户端</strong></p><p> 图2:        它<strong>是通知给配置中心的服务端,有服务端广播给所有客户端</strong></p><p><strong>为什么被称为总线?</strong></p><p><img src='https://img-blog.csdnimg.cn/ae237a629aa74b87864688b7db2078d8.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n899" mdtype="fences">就是通过消息队列达到广播的效果
我们要广播每个消息时,主要放到某个topic中,所有监听的节点都可以获取到
</pre><h3><a name='header-n900' class='md-header-anchor '></a>1.1 使用Bus</h3><h4><a name='header-n901' class='md-header-anchor '></a>1.1.1 配置rabbitmq环境</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/2637cf1f3b224dfb9337c023d85608bb.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n904' class='md-header-anchor '></a>1.1.2 之前只有一个配置中心客户端,这里在创建一个</h4><blockquote><p><mark><strong>复制3355即可,创建为3366</strong></mark></p><p><img src='https://img-blog.csdnimg.cn/6e7858a6929f4cc5a37f4f48630293a8.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>全部复制3355的即可</p></blockquote><h4><a name='header-n909' class='md-header-anchor '></a>1.1.3 使用Bus实现全局广播</h4><blockquote><p><strong>Bus广播有两种方式</strong></p><p> <mark>就是上面两个图片的两种方式</mark></p><p><img src='https://img-blog.csdnimg.cn/7bd7ba105a04413eb247a72c9ddcdf02.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>这两种方式,第二种跟合适,因为:</strong></p><p> <mark>第一种的缺点:</mark></p><p><img src='https://img-blog.csdnimg.cn/a8c9cadce10b48ec941f368f1c5c9540.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n917' class='md-header-anchor '></a>1.1.4 配置第二种方式</h4><h5><a name='header-n918' class='md-header-anchor '></a>1.1.4.1 配置3344(配置中心服务端)</h5><h6><a name='header-n919' class='md-header-anchor '></a>1.1.4.1.1 修改配置文件</h6><blockquote><p><img src='https://img-blog.csdnimg.cn/7c0681230cd24b358bbf4f9f4a946fff.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h6><a name='header-n922' class='md-header-anchor '></a>1.1.4.1.2 添加pom</h6><blockquote><p><strong>springboot的监控组件,和消息总线</strong></p><p><img src='https://img-blog.csdnimg.cn/7d02e0a217bd4502ab691172f97fc595.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h5><a name='header-n926' class='md-header-anchor '></a>1.1.4.2 修改3355(配置中心的客户端)</h5><h6><a name='header-n927' class='md-header-anchor '></a>1.1.4.2.1 pom</h6><blockquote><p><img src='https://img-blog.csdnimg.cn/7d02e0a217bd4502ab691172f97fc595.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h6><a name='header-n930' class='md-header-anchor '></a>1.1.4.2.2 配置文件</h6><blockquote><p><mark>注意配置文件的名字,要改为bootstrap.yml</mark></p><p><img src='https://img-blog.csdnimg.cn/83dcb54c8f66451ca8c89da259f8d450.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h5><a name='header-n934' class='md-header-anchor '></a>1.1.4.3 修改3366(也是配置中心的客户端)</h5><blockquote><p>修改同3355</p></blockquote><h5><a name='header-n937' class='md-header-anchor '></a>1.1.4.4 测试</h5><blockquote><p>启动7001,3344,3355,3366</p><p>此时修改GitHub上的配置文件</p><p><mark>此时只需要刷新3344,即可让3355,3366动态获取最新的配置文件</mark></p><p><img src='https://img-blog.csdnimg.cn/89f1d54920c343bfa6595268b045d81e.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>所有客户端都监听了一个rabbitMq的topic,我们将信息放入这个topic,所有客户端都可以送到,从而实时更新</strong></p></blockquote><h4><a name='header-n944' class='md-header-anchor '></a>1.1.5 配置定点通知</h4><blockquote><p>就是只通知部分服务,比如只通知3355,不通知3366</p><p><img src='https://img-blog.csdnimg.cn/019198bc139a480c87887a5d8de0d353.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>只通知3355</strong></p><p><img src='https://img-blog.csdnimg.cn/36be54c14b094d12a161b59106beecb4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/4ad2993e053f4ff6b3513c28ea7970ee.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>可以看到,实际上就是通过<mark>微服务的名称+端口号</mark>进行指定</strong></p></blockquote><h1><a name='header-n952' class='md-header-anchor '></a>八、消息驱动</h1><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n953" mdtype="fences">现在一个很项目可能分为三部分:
   前端---&gt;后端----&gt;大数据
   而后端开发使用消息中间件,可能会使用RabbitMq
   而大数据开发,一般都是使用Kafka,
   那么一个项目中有多个消息中间件,对于程序员,因为人员都不友好
</pre><blockquote><p>而Spring Cloud Stream就类似jpa,屏蔽底层消息中间件的差异,程序员主要操作Spring Cloud Stream即可</p><p>不需要管底层是kafka还是rabbitMq</p><p><img src='https://img-blog.csdnimg.cn/41dea084ae314b22be753dc3a2692646.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h2><a name='header-n958' class='md-header-anchor '></a>1. Spring Cloud Stream</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/b28ea2946590456194a46a5a32677f5a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/2b9af7c6c4fd4e0b9c580ab7bd5e814c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h2><a name='header-n962' class='md-header-anchor '></a>2. Spring Cloud Stream是怎么屏蔽底层差异的?</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/9686061c74c8456fa70f4c1beb13f000.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/9970cb0b5a9c44ba8cfa4f44eb727b3c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h2><a name='header-n966' class='md-header-anchor '></a>3. Spring Cloud Stream的通信模式</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/42a89a26c7804a39aeedaf1245ce0498.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h2><a name='header-n969' class='md-header-anchor '></a>4. Spring Cloud Stream的业务流程</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/59964ac9d3e843fc952427c24b3e796c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/8676a218967a464382e3c43d529444e4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n973" mdtype="fences">类似flume中的channel,source,sink 估计是借鉴(抄袭)的
   source用于获取数据(要发送到mq的数据)
   channel类似SpringCloudStream中的中间件,用于存放source接收到的数据,或者是存放binder拉取的数据    
</pre><h2><a name='header-n974' class='md-header-anchor '></a>5. 常用注解和api</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/7779caefbd96460ea915ba579a4263fb.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h2><a name='header-n977' class='md-header-anchor '></a>6. 使用SpringCloudStream</h2><blockquote><p>需要创建三个项目,一个生产者,两个消费者</p><p><img src='https://img-blog.csdnimg.cn/fe86c79df108413299ee6c2c1e4ad365.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n981' class='md-header-anchor '></a>6.1 创建生产者</h3><h4><a name='header-n982' class='md-header-anchor '></a>6.1.1 pom</h4><h4><a name='header-n983' class='md-header-anchor '></a>6.1.2 配置文件</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/a3a1da943a0e46b0baefda851eb9fb81.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/ccc2da41b8cf43c8bd0b8ba733eabde4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n987' class='md-header-anchor '></a>6.1.3 主启动类</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/98e8ccfacd3d44b2b6c0e3fab32e2854.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n990' class='md-header-anchor '></a>6.1.4 service和实现类</h4><blockquote><p>service定义发送消息</p><p><img src='https://img-blog.csdnimg.cn/f5326f42747e48c39472dfd23538686f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>这里,就会调用send方法,将消息发送给channel,</strong></p><p><strong>然后channel将消费发送给binder,然后发送到rabbitmq中</strong></p></blockquote><h4><a name='header-n996' class='md-header-anchor '></a>6.1.5 controller</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/4bca453030724b71aa7d9186b1e6f4c4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n999' class='md-header-anchor '></a>6.1.6 启动测试</h4><blockquote><p><strong>启动rabbitmq</strong></p><p><strong>启动7001,8801</strong></p><p> 确定8801后,会在rabbitmq中创建一个Exchange,就是我们配置文件中配置的exchange</p><p><strong>访问8801的/sendMessage</strong></p></blockquote><h3><a name='header-n1005' class='md-header-anchor '></a>6.2 创建消费者</h3><h4><a name='header-n1006' class='md-header-anchor '></a>6.2.1 pom</h4><h4><a name='header-n1007' class='md-header-anchor '></a>6.2.2 配置文件</h4><blockquote><p><mark><strong>这里排版一点问题</strong></mark></p><p><strong><mark>input</mark>就表示,当前服务是一个消费者,需要消费消息,下面就是指定消费哪个Exchange中的消息</strong></p><p><img src='https://img-blog.csdnimg.cn/39462e6ed7c94c42ae4261e66d6f5308.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/715e6fcbd2de4d4188988ebf0d19653d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1013' class='md-header-anchor '></a>6.2.3 主启动类</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/8fcfeef1f1b0421f9fc3bea1f2b6df1b.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1016' class='md-header-anchor '></a>6.2.4 业务类(消费数据)</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/39b4068eb5a647ad8c4f53b64b277f95.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>生产者发送消息时,使用send方法发送,send方法发送的是一个个Message,里面封装了数据</strong></p></blockquote><h4><a name='header-n1020' class='md-header-anchor '></a>6.2.5 测试</h4><blockquote><p>启动7001.8801.8802</p><p><strong>此时使用生产者生产消息</strong></p><p><img src='https://img-blog.csdnimg.cn/85e045841fbc4a208b779c2e7517ffaf.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>可以看到,消费者已经接收到消息了</mark></p></blockquote><h3><a name='header-n1026' class='md-header-anchor '></a>6.3 创建消费者2</h3><blockquote><p>创建8803,</p><p><mark>同8802</mark></p><p><strong>创建8803主要是为了演示重复消费等问题</strong></p><p>...</p><p>...</p><p>...</p></blockquote><h3><a name='header-n1034' class='md-header-anchor '></a>6.4 重复消费问题</h3><blockquote><p>此时启动7001.8801.8802.8803</p><p>此时生产者生产一条消息</p><p>但是此时查询消费者,发现8802,8803<mark>都消费到了同一条数据</mark></p><p><img src='https://img-blog.csdnimg.cn/4c11297700ba4347a08b88efb5a7935c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1040' class='md-header-anchor '></a>6.4.1 自定义分组</h4><blockquote><p><strong>修改8802,8803的配置文件</strong></p><p><img src='https://img-blog.csdnimg.cn/1ad88a91fac04abea2cee387bb6ca0bd.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/2dbd7513bd414ecc8b6bae8333ecb278.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p><strong>现在将8802,8803都分到了A组</strong></p><p>然后去重启02,03</p><p><strong>然后此时生产者生产两条消息</strong></p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/d0635c9a018d424f91052d3c1ab3512d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n1051' class='md-header-anchor '></a>6.5 持久化问题</h3><blockquote><p>就是当服务挂了,怎么消费没有消费的数据??</p><p>这里,先将8802移除A组,</p><p> 然后将02,03服务关闭</p><p>此时生产者开启,发送3条消息</p><p> 此时重启02,03</p><p> 可以看到,当02退出A组后,它就获取不到在它宕机的时间段内的数据</p><p> 但是03重启后,直接获取到了宕机期间它没有消费的数据,并且消费了</p><p>总结:
也就是,当我们没有配置分组时,会出现消息漏消费的问题</p><p> 而配置分组后,我们可以自动获取未消费的数据</p></blockquote><h1><a name='header-n1062' class='md-header-anchor '></a>九、链路追踪</h1><h2><a name='header-n1063' class='md-header-anchor '></a>1. Spring Cloud Sleuth</h2><blockquote><p><img src='https://img-blog.csdnimg.cn/b11e07038d1a463a8d292e03bbce4526.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h2><a name='header-n1066' class='md-header-anchor '></a>2. 使用sleuth</h2><h3><a name='header-n1067' class='md-header-anchor '></a>2.1 安装zipkin</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/06f34834af9e46b6b1fddc7580a24d14.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>运行jar包</strong></p><p> java -jar xxxx.jar</p><p><strong>然后就可以访问web界面, 默认zipkin监听的端口是9411</strong></p><p> localhost:9411/zipkin/</p><p><img src='https://img-blog.csdnimg.cn/ccc10844298c468086079b7543d1fad8.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>&nbsp;</p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/73bc877401c64ac4bc2f6f244f0253fa.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/716255e5ac524074a349381edd44d6a3.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n1079' class='md-header-anchor '></a>2.2 使用sleuth</h3><blockquote><p>不需要额外创建项目,使用之前的8001和order的80即可</p></blockquote><h4><a name='header-n1082' class='md-header-anchor '></a>2.2.1 修改8001</h4><p><strong>引入pom</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1084" mdtype="fences">&lt;!--包含了sleuth+zipkin--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre><blockquote><p>这个包虽然叫zipkin但是,里面包含了zpikin与sleuth</p></blockquote><p><strong>修改配置文件:</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n1088" mdtype="fences">spring:
  zipkin:
    base-url: http://localhost:9411
  sleuth:
    sampler:
    probability: 1
</pre><h4><a name='header-n1089' class='md-header-anchor '></a>2.2.2 修改80</h4><p><strong>添加pom</strong></p><blockquote><p>同上</p></blockquote><p><strong>添加配置</strong></p><blockquote><p>同上</p></blockquote><h4><a name='header-n1096' class='md-header-anchor '></a>2.2.3 测试</h4><blockquote><p>启动7001,8001,8002,80,9411</p><p><img src='https://img-blog.csdnimg.cn/32e5b006282d4ce1a22f414f6635402b.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h1><a name='header-n1100' class='md-header-anchor '></a>十、Spring CloudAlibaba</h1><blockquote><p><strong>之所以有Spring CloudAlibaba,是因为Spring Cloud Netflix项目进入维护模式</strong></p><p><strong>也就是,就不是不更新了,不会开发新组件了</strong></p><p><strong>所以,某些组件都有代替版了,比如Ribbon由Loadbalancer代替,等等</strong></p><p><mark>支持的功能</mark></p><p><img src='https://img-blog.csdnimg.cn/9c901a3824fe4244840ade816e49883f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>几乎可以将之前的Spring Cloud代替</p><p><mark>具体组件</mark></p><p><img src='https://img-blog.csdnimg.cn/81d9e09d660543c4be242bf5b1c3f32d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h2><a name='header-n1110' class='md-header-anchor '></a>1. Nacos</h2><blockquote><p><strong>服务注册和配置中心的组合</strong></p></blockquote><blockquote><p>Nacos=erueka+config+bus</p></blockquote><h3><a name='header-n1115' class='md-header-anchor '></a>1.1 安装Nacos</h3><blockquote><p>条件：java8 和 Maven</p><p><strong>1. 到github上下载安装包</strong></p><p> 解压安装包</p><p><strong>2. 启动Nacos</strong></p><p> 在bin下,进入cod</p><p> ./startup.cmd</p><p>startup.cmd -m standalone</p><p><strong>3. 访问Nacos</strong></p><p> Nacos默认监听8848</p><p> localhost:8848/nacos</p><p> 账号密码:默认都是nacos</p></blockquote><h3><a name='header-n1128' class='md-header-anchor '></a>1.2 使用Nacos</h3><blockquote><p>新建payment模块</p><p>现在不需要额外的服务注册模块了,Nacos单独启动了</p><p>cloudalibaba-provider-payment9001</p></blockquote><h4><a name='header-n1133' class='md-header-anchor '></a>1.2.1 pom</h4><p>父项目管理alibaba的依赖</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1135" mdtype="fences">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
    &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;
    &lt;type&gt;pom&lt;/type&gt;
    &lt;scope&gt;import&lt;/scope&gt;
&lt;/dependency&gt;
</pre><p><mark>9001的pom</mark></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1137" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloudalibaba-provider-payment9001&lt;/artifactId&gt;

    &lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
        &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
        &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><h4><a name='header-n1138' class='md-header-anchor '></a>1.2.2 配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n1139" mdtype="fences" style="break-inside: unset;">server:
  port: 9001

spring:
  application:
    name: nacos-payment-provider
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848 #配置Nacos地址

management:
  endpoints:
    web:
      exposure:
        include: '*'
</pre><h4><a name='header-n1140' class='md-header-anchor '></a>1.2.3 启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1141" mdtype="fences" style="break-inside: unset;">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class NacosProviderMain9001 {
    public static void main(String[] args) {
        SpringApplication.run(NacosProviderMain9001.class,args);
    }
}

</pre><blockquote><p>同上新创建：cloudalibaba-provider-payment9002</p></blockquote><h4><a name='header-n1144' class='md-header-anchor '></a>1.2.4 controller</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1145" mdtype="fences" style="break-inside: unset;">package controller;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class PaymentController {
    @Value("${server.port}")
    private String serverPort;
    @GetMapping(value = "/payment/nacos/{id}")
    public String getServerPort(@PathVariable("id")Integer id){
        return "nacos registry serverPort: " + serverPort + "\tid" + id;
    }
}
</pre><h4><a name='header-n1146' class='md-header-anchor '></a>1.2.5 测试</h4><blockquote><p>启动9001</p><p>然后查看Nacos的web界面,可以看到9001已经注册成功</p></blockquote><h3><a name='header-n1150' class='md-header-anchor '></a>1.3 创建其他payment模块</h3><blockquote><p>额外创建9002,9003</p></blockquote><h3><a name='header-n1153' class='md-header-anchor '></a>1.4 创建order模块</h3><blockquote><p>cloudalibaba-consumer-nacos-order83</p></blockquote><h4><a name='header-n1156' class='md-header-anchor '></a>1.4.1 pom</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1157" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloudalibaba-consumer-nacos-order83&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><p><strong>为什么Nacos支持负载均衡?</strong></p><p> Nacos直接集成了Ribon,所以有负载均衡</p><h4><a name='header-n1160' class='md-header-anchor '></a>1.4.2 配置文件</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n1161" mdtype="fences" style="break-inside: unset;">server:
  port: 83

spring:
  application:
    name: nacos-order-consumer
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848

# 消费者将要去访问的消费者名称（注册成功进nacos的微服务提供者）
service-url:
  nacos-user-service: http://nacos-payment-provider
</pre><blockquote><p><strong>这个server-url的作用是,我们在controller,需要使用RestTempalte远程调用9001,这里是指定9001的地址</strong></p></blockquote><h4><a name='header-n1164' class='md-header-anchor '></a>1.4.3 主启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1165" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class NacosOrderMain83 {
    public static void main(String[] args) {
        SpringApplication.run(NacosOrderMain83.class,args);
    }
}
</pre><h4><a name='header-n1166' class='md-header-anchor '></a>1.4.4 编写配置类</h4><p> <mark>因为Naocs要使用Ribbon进行负载均衡,那么就需要使用RestTemplate</mark></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1168" mdtype="fences" style="break-inside: unset;">package springcloud.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.client.RestTemplate;

@Configuration
public class ApplicationContextConfig {
    @Bean
    @LoadBalanced
    public RestTemplate getRestTemplate(){
        return new RestTemplate();
    }
}
</pre><h4><a name='header-n1169' class='md-header-anchor '></a>1.4.5 controller</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1170" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

import javax.annotation.Resource;

@RestController
@Slf4j
public class OrderNacosController {

    @Resource
    private RestTemplate restTemplate;

    @Value("${service-url.nacos-user-service}")
    /**public static final String SERVER_URL = "http://nacos-payment-provider";*/
    private String serverURL;

    @GetMapping(value = "/consumer/payment/nacos/{id}")
    public String paymentInfo(@PathVariable("id")Integer id){
        return restTemplate.getForObject(serverURL + "/payment/nacos/" + id,String.class);
    }

}
</pre><h4><a name='header-n1171' class='md-header-anchor '></a>1.4.6 启动测试</h4><blockquote><p>启动83,访问9001,9002,可以看到,实现了负载均衡</p></blockquote><h3><a name='header-n1174' class='md-header-anchor '></a>1.5 Nacos与其他服务注册的对比</h3><blockquote><p>Nacos它既可以支持CP,也可以支持AP,可以切换</p><p><img src='https://img-blog.csdnimg.cn/cf4040d1598d403faf5237101b1a2569.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>下面这个curl命令,就是切换模式</mark></p></blockquote><h3><a name='header-n1179' class='md-header-anchor '></a>1.6 使用Nacos作为配置中心</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/7cb281e0ea014693b1e760aff35d3507.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p><strong><mark>需要创建配置中心的客户端模块</mark></strong></p></blockquote><blockquote><p>cloudalibaba-config-nacos-client3377</p></blockquote><h4><a name='header-n1186' class='md-header-anchor '></a>1.6.1 pom</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1187" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloudalibaba-config-nacos-client3377&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!--nacos-config--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--nacos-discovery--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--web + actuator--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--一般基础配置--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><h4><a name='header-n1188' class='md-header-anchor '></a>1.6.2 配置文件</h4><blockquote><p>这里需要配置两个配置文件,application.ymk和bootstarp.yml</p><p>主要是为了可以与spring clodu config无缝迁移</p><p><img src='https://img-blog.csdnimg.cn/2b14ba1a50ed4bff841f56d65417d0ae.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n1193" mdtype="fences"># ${spring.application.name}-{spring.profile.active}.${spring.cloud.nacos.config.file-extension}
</pre><p><img src='https://img-blog.csdnimg.cn/8c321cc26eed440d806b96bc543a54a7.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1195' class='md-header-anchor '></a>1.6.3 主启动类</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1196" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class NacosConfigClientMain3377 {
    public static void main(String[] args) {
        SpringApplication.run(NacosConfigClientMain3377.class,args);
    }
}	 
</pre><h4><a name='header-n1197' class='md-header-anchor '></a>1.6.4 controller</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1198" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.cloud.context.config.annotation.RefreshScope;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RefreshScope //支持Nacos的动态刷新功能
public class ConfigClientController {
    @Value("${config.info}")
    private String configInfo;
    @GetMapping("/config/info")
    public String getConfigInfo(){
        return configInfo;
    }

</pre><blockquote><p>可以看到,这里也添加了@RefreshScope，之前在Config配置中心,也是添加这个注解实现动态刷新的</p></blockquote><h4><a name='header-n1201' class='md-header-anchor '></a>1.6.5 在Nacos添加配置信息</h4><blockquote><p><mark><strong>Nacos的配置规则:</strong></mark></p><p><strong>配置规则,就是我们在客户端如何指定读取配置文件,配置文件的命名的规则</strong></p><p><img src='https://img-blog.csdnimg.cn/cd89f4f1ce2b430096f5a03c2a2c7b9a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>默认的命名方式:</p><p><img src='https://img-blog.csdnimg.cn/77a5c32209fd42b1a2738b26f74422ef.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/b434e29905ef4d6bad32d30a4bbfe45c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/b1630ab990ad429290b7269318340c5a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/25e0074ffbc54073899ea24447a4e72e.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>注意,DataId就是配置文件名字:</p><p>名字一定要按照上面的<mark>规则</mark>命名,否则客户端会读取不到配置文件</p><p><mark>注意：yml 或 ymal必须一致（yml != yaml）[2.x版本已修复]</mark></p></blockquote><h4><a name='header-n1214' class='md-header-anchor '></a>1.6.6 测试</h4><blockquote><p>重启3377客户端</p><p>访问3377</p><p><img src='https://img-blog.csdnimg.cn/597e3c307feb49bd8e0b3723448edbf5.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/8b6f09b9fc9344e592212918649c06de.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>拿到了配置文件中的值</strong></p></blockquote><h4><a name='header-n1221' class='md-header-anchor '></a>1.6.7 默认开启自动刷新</h4><blockquote><p>此时我们修改了配置文件</p><p>客户端是可以立即更新的</p><p>因为Nacos支持Bus总线,会自动发送命令更新所有客户端</p></blockquote><h3><a name='header-n1226' class='md-header-anchor '></a>1.7 Nacos配置中心之分类配置</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/c57db37576634191a1bad1267cff2af4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/8c39f3a085654813b47a5d76e37c4a75.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/5049d13520974d79be8ecf6c274f39cb.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/546c7d9dafa6427788602f3afff89370.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1232' class='md-header-anchor '></a>1.7.1 配置不同DataId</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/c6a5243a79aa40b5bf66aa443257e462.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/b57167d01f94442587744469183c1644.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/f68d31577d6b4962b10275722a6bf9d1.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1237' class='md-header-anchor '></a>1.7.2 配置不同的GroupID</h4><blockquote><p>直接在新建配置文件时指定组</p><p><img src='https://img-blog.csdnimg.cn/1ff372ec48f943e68bce7d1a762e046d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/43811bdc43944101974921c2c58c0c4e.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>在客户端配置,使用指定组的配置文件：bootstrap + application</mark></p><p><img src='https://img-blog.csdnimg.cn/fbb81568f6294d1691aae8a5f297fce2.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>重启服务</strong></p></blockquote><h4><a name='header-n1245' class='md-header-anchor '></a>1.7.3 配置不同的namespace</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/0b01e135c744466aaf2be9456934e4fd.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/13712a82118049a6a35f91a328e0b555.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>客户端配置使用不同名称空间:</mark></p><p><img src='https://img-blog.csdnimg.cn/2771a54532c44d0391f455acb51fc2c4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>启动测试</strong></p></blockquote><h3><a name='header-n1252' class='md-header-anchor '></a>1.8 Nacos集群和持久化配置</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/e8860e6cc8c74700bd85cf2c180a2655.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/0d8d5a16014c4887bd9d860fff959e2d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/2f64aee1c05f44a7ab3449b54a6312b0.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1257' class='md-header-anchor '></a>1.8.1 单机版,切换mysql数据库</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/aed352010da648fa8cc4f1bedfd012b8.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>&nbsp;</p><p><strong>将nacos切换到使用我们自己的mysql数据库:</strong></p><p><strong>1,nacos默认自带了一个sql文件,在nacos安装目录下</strong></p><p><strong>将它放到我们的mysql执行</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="sql" contenteditable="false" cid="n1264" mdtype="fences" style="break-inside: unset;">/*
 * Copyright 1999-2018 Alibaba Group Holding Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info   */
/******************************************/
CREATE TABLE `config_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(255) DEFAULT NULL,
  `content` longtext NOT NULL COMMENT 'content',
  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',
  `src_user` text COMMENT 'source user',
  `src_ip` varchar(50) DEFAULT NULL COMMENT 'source ip',
  `app_name` varchar(128) DEFAULT NULL,
  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',
  `c_desc` varchar(256) DEFAULT NULL,
  `c_use` varchar(64) DEFAULT NULL,
  `effect` varchar(64) DEFAULT NULL,
  `type` varchar(64) DEFAULT NULL,
  `c_schema` text,
  `encrypted_data_key` text NOT NULL COMMENT '秘钥',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info_aggr   */
/******************************************/
CREATE TABLE `config_info_aggr` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(255) NOT NULL COMMENT 'group_id',
  `datum_id` varchar(255) NOT NULL COMMENT 'datum_id',
  `content` longtext NOT NULL COMMENT '内容',
  `gmt_modified` datetime NOT NULL COMMENT '修改时间',
  `app_name` varchar(128) DEFAULT NULL,
  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='增加租户字段';


/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info_beta   */
/******************************************/
CREATE TABLE `config_info_beta` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) NOT NULL COMMENT 'group_id',
  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',
  `content` longtext NOT NULL COMMENT 'content',
  `beta_ips` varchar(1024) DEFAULT NULL COMMENT 'betaIps',
  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',
  `src_user` text COMMENT 'source user',
  `src_ip` varchar(50) DEFAULT NULL COMMENT 'source ip',
  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',
  `encrypted_data_key` text NOT NULL COMMENT '秘钥',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_beta';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info_tag   */
/******************************************/
CREATE TABLE `config_info_tag` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) NOT NULL COMMENT 'group_id',
  `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',
  `tag_id` varchar(128) NOT NULL COMMENT 'tag_id',
  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',
  `content` longtext NOT NULL COMMENT 'content',
  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',
  `src_user` text COMMENT 'source user',
  `src_ip` varchar(50) DEFAULT NULL COMMENT 'source ip',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_tag';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_tags_relation   */
/******************************************/
CREATE TABLE `config_tags_relation` (
  `id` bigint(20) NOT NULL COMMENT 'id',
  `tag_name` varchar(128) NOT NULL COMMENT 'tag_name',
  `tag_type` varchar(64) DEFAULT NULL COMMENT 'tag_type',
  `data_id` varchar(255) NOT NULL COMMENT 'data_id',
  `group_id` varchar(128) NOT NULL COMMENT 'group_id',
  `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',
  `nid` bigint(20) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`nid`),
  UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_tag_relation';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = group_capacity   */
/******************************************/
CREATE TABLE `group_capacity` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `group_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Group ID，空字符表示整个集群',
  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',
  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',
  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',
  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数，，0表示使用默认值',
  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',
  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_group_id` (`group_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='集群、各Group容量信息表';

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = his_config_info   */
/******************************************/
CREATE TABLE `his_config_info` (
  `id` bigint(20) unsigned NOT NULL,
  `nid` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `data_id` varchar(255) NOT NULL,
  `group_id` varchar(128) NOT NULL,
  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',
  `content` longtext NOT NULL,
  `md5` varchar(32) DEFAULT NULL,
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `src_user` text,
  `src_ip` varchar(50) DEFAULT NULL,
  `op_type` char(10) DEFAULT NULL,
  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',
  `encrypted_data_key` text NOT NULL COMMENT '秘钥',
  PRIMARY KEY (`nid`),
  KEY `idx_gmt_create` (`gmt_create`),
  KEY `idx_gmt_modified` (`gmt_modified`),
  KEY `idx_did` (`data_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='多租户改造';


/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = tenant_capacity   */
/******************************************/
CREATE TABLE `tenant_capacity` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `tenant_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Tenant ID',
  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',
  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',
  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',
  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数',
  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',
  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='租户容量信息表';


CREATE TABLE `tenant_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `kp` varchar(128) NOT NULL COMMENT 'kp',
  `tenant_id` varchar(128) default '' COMMENT 'tenant_id',
  `tenant_name` varchar(128) default '' COMMENT 'tenant_name',
  `tenant_desc` varchar(256) DEFAULT NULL COMMENT 'tenant_desc',
  `create_source` varchar(32) DEFAULT NULL COMMENT 'create_source',
  `gmt_create` bigint(20) NOT NULL COMMENT '创建时间',
  `gmt_modified` bigint(20) NOT NULL COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='tenant_info';

CREATE TABLE `users` (
	`username` varchar(50) NOT NULL PRIMARY KEY,
	`password` varchar(500) NOT NULL,
	`enabled` boolean NOT NULL
);

CREATE TABLE `roles` (
	`username` varchar(50) NOT NULL,
	`role` varchar(50) NOT NULL,
	UNIQUE INDEX `idx_user_role` (`username` ASC, `role` ASC) USING BTREE
);

CREATE TABLE `permissions` (
    `role` varchar(50) NOT NULL,
    `resource` varchar(255) NOT NULL,
    `action` varchar(8) NOT NULL,
    UNIQUE INDEX `uk_role_permission` (`role`,`resource`,`action`) USING BTREE
);

INSERT INTO users (username, password, enabled) VALUES ('nacos', '$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu', TRUE);

INSERT INTO roles (username, role) VALUES ('nacos', 'ROLE_ADMIN');

</pre><p><strong>2,修改Nacos安装目录下的application.properties,添加:</strong></p><p><img src='https://img-blog.csdnimg.cn/19704432203741d386d236d1ba85de73.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>3,此时可以重启nacos,那么就会改为使用我们自己的mysql</strong></p></blockquote><h4><a name='header-n1268' class='md-header-anchor '></a>1.8.2 Linux上配置Nacos集群+Mysql数据库</h4><blockquote><p><mark>官方架构图:</mark></p><p><img src='https://img-blog.csdnimg.cn/e8860e6cc8c74700bd85cf2c180a2655.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>1个Nginx（双机配置） + 3个Nacos + 1个Mysql（主从复制）</mark></p><p><strong>需要一个Nginx作为VIP</strong></p><p>1,下载安装Nacos的Linux版安装包</p><p>2,进入安装目录,现在执行自带的sql文件</p><p>进入mysql,执行sql文件</p><p>3.修改配置文件,切换为我们的mysql</p><p>就是上面windos版要修改的几个属性</p><p>4,修改cluster.conf,指定哪几个节点是Nacos集群</p><p><img src='https://img-blog.csdnimg.cn/fffd6282f86a422aaedd9dd6729d06ee.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>这里使用3333,4444,5555作为三个Nacos节点监听的端口</p><p><img src='https://img-blog.csdnimg.cn/5bfe74d5ff2b43b09437161663c26a9b.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>5,我们这里就不配置在不同节点上了,就放在一个节点上</p><p>既然要在一个节点上启动不同Nacos实例,就要修改startup.sh,使其根据不同端口启动不同Nacos实例</p><p><img src='https://img-blog.csdnimg.cn/ee91abc08704471cbc534b08d02b6caf.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>可以看到,这个脚本就是通过jvm启动nacos</p><p>所以我们最后修改的就是,nohup java -Dserver.port=3344</p><p><strong>启动</strong></p><p><img src='https://img-blog.csdnimg.cn/61a9a653870f4eb89f7b006cef81c19d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>6,配置Nginx:</p><p><img src='https://img-blog.csdnimg.cn/40f0f5353d2749ffb2f8490f99ceadf3.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>7,启动Nacos:
./startup.sh -p 3333</p><p>./startup.sh -p 4444</p><p>./startup.sh -p 5555</p><p>8,启动nginx</p><p>9,测试:</p><p>访问192.168.159.121:1111</p><p>如果可以进入nacos的web界面,就证明安装成功了</p><p>9,将微服务注册到Nacos集群:</p><p><img src='https://img-blog.csdnimg.cn/6c948738590a4fd2a7d24dd55e19ec86.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>10,进入Nacos的web界面</p><p>可以看到,已经注册成功</p><p><img src='https://img-blog.csdnimg.cn/f4cda756b4d14fd8b85ffc0849180867.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/0cfa7b294cdc4dbb9a4e584b494b0859.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h2><a name='header-n1305' class='md-header-anchor '></a>2. Sentinel</h2><blockquote><p>实现熔断与限流,就是Hystrix</p><p><img src='https://img-blog.csdnimg.cn/cdf518550227442389b7d16fe498112b.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/ca3eeb54b5a741159c225599a728a937.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n1310' class='md-header-anchor '></a>2.1 使用sentinel</h3><blockquote><p>1,下载sentinel的jar包</p><p>2,运行sentinel</p><p> 由于是一个jar包,所以可以直接java -jar运行</p><p> 注意,默认sentinel占用8080端口</p><p>3,访问sentinel</p><p>sentinel sentinel</p><p> localhost:8080</p></blockquote><h3><a name='header-n1319' class='md-header-anchor '></a>2.2 微服务整合sentinel</h3><h4><a name='header-n1320' class='md-header-anchor '></a>2.2.3 启动Nacos</h4><h5><a name='header-n1321' class='md-header-anchor '></a>2.2.3.1 新建一个项目,8401,主要用于配置sentinel</h5><blockquote><p>cloudalibaba-sentinel-service8401</p></blockquote><p><strong>pom</strong></p><blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1326" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloudalibaba-sentinel-service8401&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;
            &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--sentinel--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--nacos-discovery--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--web + actuator--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--一般基础配置--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</pre></blockquote><p><strong>配置文件</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n1328" mdtype="fences" style="break-inside: unset;">server:
  port: 8401

spring:
  application:
    name: cloudalibaba-sentinel-service
  cloud:
    nacos:
      discovery:
        # nacos注册服务中心地址
        server-addr: localhost:8080
    sentinel:
      transport:
        # 配置sentinel dashboard地址
        dashboard: localhost:8080
        # 默认8719端口 假如被占用会自动从8719开始依次+1扫描，直到找到未被占用的端口
        port: 8719

management:
  endpoints:
    web:
      exposure:
        include: '*'
</pre><p><strong>主启动类</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1330" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class SentinelServiceMain8401 {
    public static void main(String[] args) {
        SpringApplication.run(SentinelServiceMain8401.class,args);
    }
}
</pre><p><strong>controller</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1332" mdtype="fences">package springcloud.controller;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class FlowLimitController{
    @GetMapping("/test")
    public String test(){
        return "=============== t e s t ===============";
    }
}
</pre><p><strong>启动8401</strong></p><blockquote><p>此时我们到sentinel中查看,发现并8401的任何信息</p><p>是因为,sentinel是懒加载,需要我们执行一次访问,才会有信息</p><p>访问localhost/8401/test</p></blockquote><blockquote><p>可以看到sentinel已经开始监听了</p><p><img src='https://img-blog.csdnimg.cn/b9baf2b08e18471b91509d5069e268c2.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n1341' class='md-header-anchor '></a>2.3 sentinel的流控规则</h3><h4><a name='header-n1342' class='md-header-anchor '></a>2.3.1 流量限制控制规则</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/85c76250931047ce8dce7f2c08af722d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/d288e5d9c6a14c7891219ef65f721bb8.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>流控模式</mark>:</p><ol start='' ><li>直接快速失败</li></ol><p><img src='https://img-blog.csdnimg.cn/e621bbfb196f439f971b0895264f0b57.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>  <mark>直接失败的效果:</mark></p><p><strong>Blocked by Sentinel (flow limiting)</strong></p><ol start='2' ><li>线程数直接失败</li></ol><p><img src='https://img-blog.csdnimg.cn/ed4a0a2626b747d6bcfd4bb3eeba826a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>比如a请求过来,处理很慢,在一直处理,此时b请求又过来了</p><p>此时因为a占用一个线程,此时要处理b请求就只有额外开启一个线程</p><p>那么就会报错</p><p><img src='https://img-blog.csdnimg.cn/11bf46cea45f4119ae238349ec6ddc4e.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><ol start='3' ><li>关联</li></ol><p><img src='https://img-blog.csdnimg.cn/17f2be7758654b69bf7d1ed0a685e690.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>应用场景:  比如<strong>支付接口</strong>达到阈值,就要限流下<strong>订单的接口</strong>,防止一直有订单</mark></p><p><img src='https://img-blog.csdnimg.cn/c3e9d15e8a714d90a81421073cee8560.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>当testB达到阈值,qps大于1,就让testA之后的请求直接失败</strong></p><p>可以使用postman模拟并发/testB压测</p><ol start='4' ><li><p>链路</p><p>多个请求调用同一个微服务</p></li><li><p>预热Warm up</p></li></ol><p><img src='https://img-blog.csdnimg.cn/fe35ecbbaa994d8ba3fa0eccba2e39fb.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/c7bdb6d8ecf548808e537e599e0a0538.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/abdd5c0e78ae4646bc304793e3502555.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><ol start='6' ><li>排队等待</li></ol><p><img src='https://img-blog.csdnimg.cn/6828d906ff824491833eb274588b98a7.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/04bedf08e3f649beb48a4c63ddd8c3c2.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1383' class='md-header-anchor '></a>2.3.2 降级规则</h4><p><strong>熔断降级</strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/427e06d8e00045c4bc9d99e76aa91a19.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/69e6656f1f6c441283adaa79ff4b7da3.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/b25b3a437be7433086d67e76fea955ba.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h5><a name='header-n1389' class='md-header-anchor '></a>2.3.2.1 RT配置</h5><blockquote><p>新增一个请求方法用于测试</p><p><img src='https://img-blog.csdnimg.cn/7bbc1646d187487abdae8343bc955bd8.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>配置RT:</mark></p><p> 这里配置的PT,默认是秒级的平均响应时间</p><p><img src='https://img-blog.csdnimg.cn/e3998ab5a25547ad8870092d43e77892.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>默认计算平均时间是: 1秒类进入5个请求,并且响应的平均值超过阈值(这里的200ms),就报错</p><p>1秒5请求是Sentinel默认设置的</p><p><img src='https://img-blog.csdnimg.cn/f2c9a421a9884d52b77584387763b1c1.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h5><a name='header-n1399' class='md-header-anchor '></a>2.3.2.2 异常比例</h5><blockquote><p><img src='https://img-blog.csdnimg.cn/c0b0b0b81ff64520b5dc0a6af1278bab.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>修改请求方法</p><p><img src='https://img-blog.csdnimg.cn/cd89b8db4ca24554ab0418b4b1b42b2c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>配置</p><p><img src='https://img-blog.csdnimg.cn/707f650409d3419dbf1a74ed41ab010c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>如果没触发熔断,正常抛出异常</mark></p><p><img src='https://img-blog.csdnimg.cn/d4ad85f8a6f9436f8b20a65c61b4309c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>触发熔断</mark></p><p><img src='https://img-blog.csdnimg.cn/34e75a6421fe4e6ca226c659c3ec0466.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h5><a name='header-n1410' class='md-header-anchor '></a>2.3.2.3 异常数</h5><blockquote><p><img src='https://img-blog.csdnimg.cn/f16af15caab44541b60c618df131b1ef.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/93d72493e1934b0b9ff8bc7f6b80dfb9.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>Blocked by Sentinel (flow limiting)</strong></p></blockquote><h3><a name='header-n1415' class='md-header-anchor '></a>2.4 热点规则</h3><blockquote><p><img src='https://img-blog.csdnimg.cn/1c12897c9cdd44ff831c3c45c6e8d023.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/a4addca59b554151b02d814da269a76d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p>比如:</p><p>localhost:8080/aa?name=aa</p><p>localhost:8080/aa?name=bb</p><p>加入两个请求中,带有参数aa的请求访问频次非常高,我们就现在name=aa的请求,但是bb的不限制</p><p><mark>如何自定义降级方法,而不是默认的抛出异常?</mark></p><p><img src='https://img-blog.csdnimg.cn/2f74fccc26d844068bc8d2a6762e36eb.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong><mark>使用@SentinelResource直接实现降级方法,它等同Hystrix的@HystrixCommand</mark></strong></p><p><img src='https://img-blog.csdnimg.cn/573b7bb9b9b147d4a9045851186b782a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>定义热点规则</mark></p><p><img src='https://img-blog.csdnimg.cn/b8aaa9e3fd9c4e47bf6ae3efe9be0067.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/dae2c954925649b7b9e3e1a0c92549b9.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/6f7e518f34ce49a2ae90cad75c52759f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><blockquote><p><mark>设置热点规则中的其他选项</mark></p></blockquote><blockquote><p><img src='https://img-blog.csdnimg.cn/ac1cf910d3d24ef5b0b426fc70d52a34.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>需求</strong></p><p><img src='https://img-blog.csdnimg.cn/65e4ff70fe9049b8bc695a493de62e8e.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>测试</mark></p><p><img src='https://img-blog.csdnimg.cn/2807b9626fa04c1ab61110ba30933b2a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>注意</strong></p><p>参数类型只支持,8种基本类型+String类</p><p><mark>注意</mark></p><p>如果我们程序出现异常,是不会走blockHander的降级方法的,因为这个方法只配置了热点规则,没有配置限流规则</p><p>我们这里配置的降级方法是sentinel针对热点规则配置的</p><p>只有触发热点规则才会降级</p><p><img src='https://img-blog.csdnimg.cn/aa58152bc825418d8fe9e7d08be7439f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n1446' class='md-header-anchor '></a>2.5 系统规则</h3><blockquote><p>系统自适应限流:
从整体维度对应用入口进行限流</p><p>对整体限流,比如设置qps到达100,这里限流会限制整个系统不可以</p><p><img src='https://img-blog.csdnimg.cn/09ce16d96c2046a989549b54d808fc5a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>测试</mark></p><p><img src='https://img-blog.csdnimg.cn/6d9b86efd44d4119b5d42810bff7102f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/b4646d37273344b2a56f865b181c4ea5.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n1454' class='md-header-anchor '></a>2.6 @SentinelResource注解</h3><h4><a name='header-n1455' class='md-header-anchor '></a>2.6.1 用于配置降级等功能</h4><p>环境搭建</p><blockquote><p>为8401添加依赖</p><p>添加自己的common包的依赖</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1460" mdtype="fences">&lt;dependency&gt;
    &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
    &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;
</pre><p>创建一个新的controller</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1462" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import com.alibaba.csp.sentinel.annotation.SentinelResource;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;

@RestController
public class RateLimitController {
    @GetMapping("/byResource")
    @SentinelResource(value = "byResource",blockHandler = "handleException")
    public CommonResult byResource(){
        return new CommonResult(200,"按资源名称限流测试OK",new Payment(2022L,"serial001"));
    }
    public CommonResult handleException(BlockException blockException){
        return new CommonResult(444,blockException.getClass().getCanonicalName() + "\t 服务不可用");
    }
}
</pre><p>配置限流</p><p><strong>注意,我们这里配置规则,资源名指定的是@SentinelResource注解value的值,</strong>（按照资源名限流）</p><p><strong>这样也是可以的,也就是不一定要指定访问路径</strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/65c858e5974b4508acf1e485954a54e4.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p>测试</p><blockquote><p>可以看到已经进入降级方法了</p></blockquote><blockquote><p><mark>此时我们关闭8401服务</mark></p><p>可以看到,这些定义的规则是临时的,关闭服务,规则就没有了</p><p><strong>可以看到,上面配置的降级方法,又出现Hystrix遇到的问题了</strong></p><p>降级方法与业务方法耦合</p><p>每个业务方法都需要对应一个降级方法</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1477" mdtype="fences">@GetMapping("/rateLimit/byUrl")
@SentinelResource(value = "byUrl")
public CommonResult byUrl(){
    return new CommonResult(200,"按URL限流测试OK",new Payment(2022L,"serial001"));
}
</pre><blockquote><p><img src='https://img-blog.csdnimg.cn/1b13878fedfb4a07a65edabbd2a36f22.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1480' class='md-header-anchor '></a>2.6.2 自定义限流处理逻辑</h4><p><mark>单独创建一个类,用于处理限流</mark></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1482" mdtype="fences">package springcloud.myhandler;

import com.alibaba.csp.sentinel.slots.block.BlockException;
import springcloud.entities.CommonResult;

public class CustomerBlockHandler {
    public CommonResult handleException(BlockException blockException){
        return new CommonResult(444,"用户自定义globalHandlerException1");
    }
    public CommonResult handleException2(BlockException blockException){
        return new CommonResult(444,"用户自定义globalHandlerException2");
    }
}
</pre><p><mark>在controller中,指定使用自定义类中的方法作为降级方法</mark></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1484" mdtype="fences">    @GetMapping("/rateLimit/customerBlockHandler")
    @SentinelResource(value = "customerBlockHandler",
            blockHandlerClass = CustomerBlockHandler.class,
            blockHandler = "handleException2"
    )
    public CommonResult customerBlockHandler(){
        return new CommonResult(200,"按customerBlockHandler测试OK",new Payment(2022L,"serial001"));
    }
</pre><p><mark>Sentinel中定义流控规则</mark>:</p><blockquote><p>这里资源名,是以url指定,也可以使用@SentinelResource注解value的值指定</p><p><img src='https://img-blog.csdnimg.cn/e4e05ebaa48f40aabdd1d0b9cc93ee58.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>测试</mark></p><p><mark>整体</mark></p><p><img src='https://img-blog.csdnimg.cn/7fef615547714343a36d5a2180897b32.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h4><a name='header-n1492' class='md-header-anchor '></a>2.6.3 @SentinelResource注解的其他属性</h4><blockquote><p><img src='https://img-blog.csdnimg.cn/8f704d3a4aa8440c8bbbc32488e92276.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/70ef267ec00848728b928411a58f4fad.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n1496' class='md-header-anchor '></a>2.7 服务熔断</h3><p><strong>启动nacos和sentinel</strong></p><p><strong>新建两个payment模块9003和9004</strong></p><blockquote><p>cloudalibaba-provider-payment9003</p><p>cloudalibaba-provider-payment9004</p></blockquote><p><strong>pom</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1503" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloudalibaba-provider-payment9003&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!--SpringCloud ailibaba nacos --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- SpringBoot整合Web组件 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--日常通用jar包配置--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</pre><p><strong>配置文件</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n1505" mdtype="fences" style="break-inside: unset;">server:
  port: 9003

spring:
  application:
    name: nacos-payment-provider
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848 # 配置nacos地址
management:
  endpoints:
    web:
      exposure:
        include: '*'
</pre><p><strong>主启动类</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1507" mdtype="fences">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class PaymentMain9003 {
    public static void main(String[] args) {
        SpringApplication.run(PaymentMain9003.class,args);
    }
}
</pre><p><strong>controller</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1509" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;

import java.util.HashMap;

@RestController
public class PaymentController {
    @Value("${server.port}")
    private String serverPort;

    public static HashMap&lt;Long, Payment&gt; hashMap = new HashMap&lt;&gt;();
    static {
        hashMap.put(1L,new Payment(1L,"data1"));
        hashMap.put(2L,new Payment(2L,"data2"));
        hashMap.put(3L,new Payment(3L,"data3"));
        hashMap.put(4L,new Payment(4L,"data4"));
    }

    @GetMapping(value = "/paymentSQL/{id}")
    public CommonResult&lt;Payment&gt; paymentSQL(@PathVariable("id")Long id){
        Payment payment = hashMap.get(id);
        CommonResult&lt;Payment&gt; result = new CommonResult&lt;&gt;(200,"from sql , serverPort = " + serverPort,payment);
        return result;
    }

}
</pre><p> <strong>然后启动9003.9004</strong></p><p><strong>新建一个order-84消费者模块</strong></p><blockquote><p>cloudalibaba-consumer-nacos-order84</p></blockquote><p><strong>pom</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1515" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springcloud&lt;/artifactId&gt;
        &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;cloudalibaba-consumer-nacos-order84&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;


&lt;/project&gt;
</pre><p><strong>配置文件</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n1517" mdtype="fences" style="break-inside: unset;">server:
  port: 84

spring:
  application:
    name: nacos-order-consumer
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
    sentinel:
      transport:
        dashboard: localhost:8080
        port: 8719

service-url:
  nacos-user-service: http://nacos-payment-provider
</pre><p><strong>主启动类</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1519" mdtype="fences" style="break-inside: unset;">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.openfeign.EnableFeignClients;

@EnableDiscoveryClient
@SpringBootApplication

public class OrderNacosMain84 {
    public static void main(String[] args) {
        SpringApplication.run(OrderNacosMain84.class, args);
    }
}
</pre><p><strong>配置类</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1521" mdtype="fences" style="break-inside: unset;">package springcloud.config;

import org.springframework.cloud.client.loadbalancer.LoadBalanced;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.client.RestTemplate;


@Configuration
public class ApplicationContextConfig {
    @Bean
    @LoadBalanced
    public RestTemplate getRestTemplate() {
        return new RestTemplate();
    }
}
</pre><p><strong>controller</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1523" mdtype="fences" style="break-inside: unset;">package springcloud.controller;

import com.alibaba.csp.sentinel.annotation.SentinelResource;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;

import javax.annotation.Resource;

@RestController
public class CircleBreakController {
    public static final String SERVICE_URL = "http://nacos-payment-provider";
    @Resource
    private RestTemplate restTemplate;

    @RequestMapping("/consumer/fallback/{id}")
    @SentinelResource(value = "fallback") //没有配置
    public CommonResult&lt;Payment&gt; fallback(@PathVariable("id")Long id){
        CommonResult&lt;Payment&gt; result = restTemplate.getForObject(SERVICE_URL + "/paymentSQL/" + id,CommonResult.class,id);
        if (id == 5){
            throw new IllegalArgumentException("非法参数异常：IllegalArgumentException");
        } else if (result.getData()==null){
            throw new NullPointerException("空指针异常：NullPointerException");
        }
        return result;
    }
}
</pre><blockquote><p><strong>Sentinel服务无配置情况</strong></p><p><img src='https://img-blog.csdnimg.cn/0a43486013904ff0a0478d1a859ee4e3.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p><mark>为业务方法添加fallback来指定降级方法</mark></p><blockquote><p><img src='https://img-blog.csdnimg.cn/d4adfe8932c94a6ea412ed88495f8258.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>重启测试</mark></p><p> <mark>所以,fallback是用于管理异常的,当业务方法发生异常,可以降级到指定方法</mark></p><p>注意,我们这里<mark>并没有使用sentinel配置任何规则</mark>,但是却降级成功,就是因为</p><p><mark>fallback是用于管理异常的,当业务方法发生异常,可以降级到指定方法</mark></p></blockquote><p><mark>为业务方法添加blockHandler</mark></p><blockquote><p><img src='https://img-blog.csdnimg.cn/1ecced0c8b994adc94094375b31a930e.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/4fdb92908b7b416d975d5a6c12da6d7c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>启动测试</mark></p><p>可以看到.,直接报错了,并没有降级</p><p>也就是说,blockHandler<mark>只对sentienl定义的规则降级</mark></p><p><img src='https://img-blog.csdnimg.cn/cec4bbe88c644330b322618d20b9fb6a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p><mark>如果fallback和blockHandler都进行配置</mark></p><blockquote><p><img src='https://img-blog.csdnimg.cn/bfe03a5f1f9b49988dee62fea0b92839.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>设置qps规则,阈值1</strong></p><p><mark>启动测试</mark></p><p><mark>可以看到,当两个都同时生效时,blockhandler优先生效</mark></p></blockquote><p><mark>@SentinelResource的exceptionsToIgnore属性</mark></p><blockquote><p><img src='https://img-blog.csdnimg.cn/bfd2ae8ddf064cb2b0772dc3d64befea.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>exceptionsToIgnore指定一个异常类,</strong></p><p><strong>表示如果当前方法抛出的是指定的异常,不降级,直接对用户抛出异常</strong></p></blockquote><h3><a name='header-n1553' class='md-header-anchor '></a>2.8 sentinel整合ribbon+openFeign+fallback</h3><p><strong>修改84模块,使其支持feign</strong></p><p><strong>pom</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1556" mdtype="fences">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre><p><strong>配置文件</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n1558" mdtype="fences">feign:
  sentinel:
    enabled: true
# 激活Sentinel对Feign的支持
</pre><p><strong>主启动类</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1560" mdtype="fences" style="break-inside: unset;">package springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.openfeign.EnableFeignClients;

@EnableDiscoveryClient
@SpringBootApplication
@EnableFeignClients
public class OrderNacosMain84 {
    public static void main(String[] args) {
        SpringApplication.run(OrderNacosMain84.class, args);
    }
}
</pre><p><strong>创建远程调用payment模块的接口</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1562" mdtype="fences" style="break-inside: unset;">package springcloud.service;

import com.alibaba.csp.sentinel.annotation.SentinelResource;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;

@FeignClient(value = "nacos-payment-provider")
public interface PaymentService {
    @GetMapping("/paymentSQL/{id}")
    public CommonResult&lt;Payment&gt; paymentSQL(@PathVariable("id")Long id);
}
</pre><p><strong>创建这个接口的实现类,用于降级</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1564" mdtype="fences" style="break-inside: unset;">package springcloud.service;

import org.springframework.context.annotation.Bean;
import org.springframework.stereotype.Component;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;

@Component
public class PaymentFallbackService implements PaymentService{
    @Override
    public CommonResult&lt;Payment&gt; paymentSQL(Long id) {
        return new CommonResult&lt;&gt;(444,"服务降级放回：PaymentFallbackService");
    }
}
</pre><p><strong>再次修改接口,指定降级类</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1566" mdtype="fences" style="break-inside: unset;">package springcloud.service;

import com.alibaba.csp.sentinel.annotation.SentinelResource;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import springcloud.entities.CommonResult;
import springcloud.entities.Payment;

@FeignClient(value = "nacos-payment-provider",fallback = PaymentFallbackService.class)
public interface PaymentService {
    @GetMapping("/paymentSQL/{id}")
    public CommonResult&lt;Payment&gt; paymentSQL(@PathVariable("id")Long id);
}
</pre><p><strong>controller添加远程调用</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1568" mdtype="fences">/**OpenFeign*/
@Resource
private PaymentService paymentService;
@GetMapping(value = "/consumer/paymentSQL/{id}")
public CommonResult&lt;Payment&gt; paymentSQL(@PathVariable("id")Long id){
    return paymentService.paymentSQL(id);
}
</pre><blockquote><p><strong>测试</strong></p><p>启动9003,84</p><p><strong>测试,如果关闭9003.看看84会不会降级</strong></p><p><strong>可以看到,正常降级了</strong></p></blockquote><p><mark>熔断框架比较</mark></p><blockquote><p><img src='https://img-blog.csdnimg.cn/130aa26efaa74dfc8229fbb050c30432.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n1577' class='md-header-anchor '></a>2.9 sentinel持久化规则</h3><blockquote><p>默认规则是临时存储的,重启sentinel就会消失</p><p><img src='https://img-blog.csdnimg.cn/c8b2df91ce9c4d48b6deecda68777e20.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p><mark>以8401为案例进行修改</mark></p><p><strong>修改8401的pom</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1583" mdtype="fences">添加:
&lt;!-- SpringCloud ailibaba sentinel-datasource-nacos 持久化需要用到--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;
    &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt;
&lt;/dependency&gt;
</pre><p><strong>修改配置文件</strong></p><p><strong>添加</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yml" contenteditable="false" cid="n1586" mdtype="fences" style="break-inside: unset;">server:
  port: 8401

spring:
  application:
    name: cloudalibaba-sentinel-service
  cloud:
    nacos:
      discovery:
        # nacos注册服务中心地址
        server-addr: localhost:8080
    sentinel:
      transport:
        # 配置sentinel dashboard地址
        dashboard: localhost:8080
        # 默认8719端口 假如被占用会自动从8719开始依次+1扫描，直到找到未被占用的端口
        port: 8719
      datasource:
        ds1:
          nacos:
            server-addr: localhost:8848
            dataid: cloudalibaba-sentinel-service # ${spring.application.name}
            groupid: DEFAULT_GROUP
            data-type: json
            rule-type: flow

management:
  endpoints:
    web:
      exposure:
        include: '*'
</pre><blockquote><p><strong>实际上就是指定,我们的规则要保证在哪个名称空间的哪个分组下</strong></p><p>这里没有指定namespace, 但是是可以指定的</p><p><strong>注意,这里的dataid要与8401的服务名一致</strong></p></blockquote><p><strong>在nacos中创建一个配置文件,dataId就是上面配置文件中指定的</strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/496501dcc0cd4ce69163d997c5d216e3.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><mark>json中,这些属性的含义</mark></p><p><img src='https://img-blog.csdnimg.cn/a21864310dec48b5a3874c73fa579e9c.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="json" contenteditable="false" cid="n1596" mdtype="fences">[
    {
         "resource": "/rateLimit/byUrl",
         "limitApp": "default",
         "grade":   1,
         "count":   1,
         "strategy": 0,
         "controlBehavior": 0,
         "clusterMode": false    
    }
] ​
</pre></blockquote><blockquote><p><strong>启动8401</strong></p><p><strong>sentinel直接读取到了规则</strong></p><p><strong>关闭8401，流控规则消失</strong></p><p><strong>重启8401，流控规则重新加载</strong></p></blockquote><h2><a name='header-n1602' class='md-header-anchor '></a>3. Seata</h2><p><mark>分布式事务解决方案</mark></p><blockquote><p>一次业务操作需要跨多个数据源或需要跨多个系统进行远程调用，就会产生分布式事务问题</p></blockquote><p><strong>分布式事务中的一些概念,也是seata中的概念</strong></p><blockquote><p>        <img src='https://img-blog.csdnimg.cn/af3028e54b494e6796888f0fa003657d.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/e90cd491b6584578a095bc29ad912280.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/6f8386083de84693a778c57181ae5bb7.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><h3><a name='header-n1611' class='md-header-anchor '></a>3.1 seata安装</h3><ol start='' ><li><p><strong>下载安装seata的安装包</strong></p></li><li><p><strong>修改file.conf</strong></p><blockquote><p>自定义事务组名称+事务日志存储模式db+数据库连接信息</p><p><img src='https://img-blog.csdnimg.cn/2b62bb6f91b34a07a3337f0a9ab9aa4b.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/2d875481a4eb4968a04683b8d75ba9d7.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>mysql8.0+：driverClassName = &quot;com.mysql.cj.jdbc.Driver&quot;</strong></p><p><img src='https://img-blog.csdnimg.cn/81bc99d41bf6412ca32aa7044eee798e.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/ec11f2f65e3542c4a989699e4e9f6dce.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/f374f2e8d8234e33b8b9a33a01632a5f.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote></li><li><p><strong>mysql建库建表</strong></p><blockquote><p>1,上面指定了数据库为seata,所以创建一个数据库名为seata</p><p>2,建表,在seata的安装目录下有一个db_store.sql,运行即可</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="sql" contenteditable="false" cid="n1630" mdtype="fences" style="break-inside: unset;">-- the table to store GlobalSession data
drop table if exists `global_table`;
create table `global_table` (
  `xid` varchar(128)  not null,
  `transaction_id` bigint,
  `status` tinyint not null,
  `application_id` varchar(32),
  `transaction_service_group` varchar(32),
  `transaction_name` varchar(128),
  `timeout` int,
  `begin_time` bigint,
  `application_data` varchar(2000),
  `gmt_create` datetime,
  `gmt_modified` datetime,
  primary key (`xid`),
  key `idx_gmt_modified_status` (`gmt_modified`, `status`),
  key `idx_transaction_id` (`transaction_id`)
);
 
-- the table to store BranchSession data
drop table if exists `branch_table`;
create table `branch_table` (
  `branch_id` bigint not null,
  `xid` varchar(128) not null,
  `transaction_id` bigint ,
  `resource_group_id` varchar(32),
  `resource_id` varchar(256) ,
  `lock_key` varchar(128) ,
  `branch_type` varchar(8) ,
  `status` tinyint,
  `client_id` varchar(64),
  `application_data` varchar(2000),
  `gmt_create` datetime,
  `gmt_modified` datetime,
  primary key (`branch_id`),
  key `idx_xid` (`xid`)
);
 
-- the table to store lock data
drop table if exists `lock_table`;
create table `lock_table` (
  `row_key` varchar(128) not null,
  `xid` varchar(96),
  `transaction_id` long ,
  `branch_id` long,
  `resource_id` varchar(256) ,
  `table_name` varchar(32) ,
  `pk` varchar(36) ,
  `gmt_create` datetime ,
  `gmt_modified` datetime,
  primary key(`row_key`)
);
</pre></blockquote></li><li><p><strong>继续修改配置文件,修改registry.conf</strong></p><blockquote><p>配置seata作为微服务,指定注册中心</p><p><img src='https://img-blog.csdnimg.cn/4dd3990cdafe43139886020562bc590a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote></li><li><p><strong>启动</strong></p><blockquote><p>先启动nacos</p><p>在启动seata-server(运行安装目录下的,seata-server.bat)</p><p><img src='https://img-blog.csdnimg.cn/9e0438e459bb44e3a28924b5b98cf65a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote></li><li><p><strong>业务说明</strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/10079860c6b647ad82f86c51f5d03dff.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/fdd2d5b28f4444beb5f1ebf9b463904a.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/0b58ff62efbf466ebfb7d459165dffc1.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/f2a03e0256024445824b72c0b6f9e81b.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><strong>注意<mark>每个库都要执行一次</mark>这个sql,生成回滚日志表</strong></p><p><mark>每个业务都创建一个微服务,也就是要有三个微服务,订单,库存,账号</mark></p></blockquote></li></ol><p> <mark>订单</mark></p><blockquote><p>seta-order-2001</p></blockquote><p><strong>pom</strong></p><p><strong>配置文件</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="yaml" contenteditable="false" cid="n1656" mdtype="fences" style="break-inside: unset;">server:
  port: 2001

spring:
  application:
    name: seata-order-service
  cloud:
    alibaba:
      seata:
        # 自定义事务组名称需要与seata-server中的对应,我们之前在seata的配置文件中配置的名字
        tx-service-group: fsp_tx_group
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
  datasource:
    # 当前数据源操作类型
    type: com.alibaba.druid.pool.DruidDataSource
    # mysql驱动类
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/seata_order?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8
    username: root
    password: root
feign:
  hystrix:
    enabled: false
logging:
  level:
    io:
      seata: info

mybatis:
  mapperLocations: classpath*:mapper/*.xml
</pre><blockquote><p>还要额外创建其他配置文件,创建一个file.conf</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang=".conf" contenteditable="false" cid="n1659" mdtype="fences" style="break-inside: unset;">    transport {
  # tcp udt unix-domain-socket
      type = "TCP"
      #NIO NATIVE
      server = "NIO"
      #enable heartbeat
      heartbeat = true
      #thread factory for netty
      thread-factory {
        boss-thread-prefix = "NettyBoss"
        worker-thread-prefix = "NettyServerNIOWorker"
        server-executor-thread-prefix = "NettyServerBizHandler"
        share-boss-worker = false
        client-selector-thread-prefix = "NettyClientSelector"
        client-selector-thread-size = 1
        client-worker-thread-prefix = "NettyClientWorkerThread"
        # netty boss thread size,will not be used for UDT
        boss-thread-size = 1
        #auto default pin or 8
        worker-thread-size = 8
      }
      shutdown {
        # when destroy server, wait seconds
        wait = 3
      }
      serialization = "seata"
      compressor = "none"
    }
    service {
      #vgroup-&gt;rgroup
      # 事务组名称
      vgroup_mapping.fsp_tx_group = "default"
      #only support single node
      default.grouplist = "127.0.0.1:8091"
      #degrade current not support
      enableDegrade = false
      #disable
      disable = false
      #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, default permanent
      max.commit.retry.timeout = "-1"
      max.rollback.retry.timeout = "-1"
    }
     
    client {
      async.commit.buffer.limit = 10000
      lock {
        retry.internal = 10
        retry.times = 30
      }
      report.retry.count = 5
      tm.commit.retry.count = 1
      tm.rollback.retry.count = 1
    }
     
    ## transaction log store
    store {
      ## store mode: file、db
      #mode = "file"
      mode = "db"
     
      ## file store
      file {
        dir = "sessionStore"
     
        # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions
        max-branch-session-size = 16384
        # globe session size , if exceeded throws exceptions
        max-global-session-size = 512
        # file buffer size , if exceeded allocate new buffer
        file-write-buffer-cache-size = 16384
        # when recover batch read size
        session.reload.read_size = 100
        # async, sync
        flush-disk-mode = async
      }
     
      ## database store
      db {
        ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc.
        datasource = "dbcp"
        ## mysql/oracle/h2/oceanbase etc.
        db-type = "mysql"
        driver-class-name = "com.mysql.jdbc.Driver"
        url = "jdbc:mysql://127.0.0.1:3306/seata"
        user = "root"
        password = "root"
        min-conn = 1
        max-conn = 3
        global.table = "global_table"
        branch.table = "branch_table"
        lock-table = "lock_table"
        query-limit = 100
      }
    }
    lock {
      ## the lock store mode: local、remote
      mode = "remote"
     
      local {
        ## store locks in user's database
      }
     
      remote {
        ## store locks in the seata's server
      }
    }
    recovery {
      #schedule committing retry period in milliseconds
      committing-retry-period = 1000
      #schedule asyn committing retry period in milliseconds
      asyn-committing-retry-period = 1000
      #schedule rollbacking retry period in milliseconds
      rollbacking-retry-period = 1000
      #schedule timeout retry period in milliseconds
      timeout-retry-period = 1000
    }
     
    transaction {
      undo.data.validation = true
      undo.log.serialization = "jackson"
      undo.log.save.days = 7
      #schedule delete expired undo_log in milliseconds
      undo.log.delete.period = 86400000
      undo.log.table = "undo_log"
    }
     
    ## metrics settings
    metrics {
      enabled = false
      registry-type = "compact"
      # multi exporters use comma divided
      exporter-list = "prometheus"
      exporter-prometheus-port = 9898
    }
     
    support {
      ## spring
      spring {
        # auto proxy the DataSource bean
        datasource.autoproxy = false
      }
    }
    
</pre><blockquote><p>创建registry.conf</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n1662" mdtype="fences" style="break-inside: unset;">registry {
      # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa
      type = "nacos"
     
  nacos {
    #serverAddr = "localhost"
    serverAddr = "localhost:8848"
    namespace = ""
    cluster = "default"
  }
  eureka {
    serviceUrl = "http://localhost:8761/eureka"
    application = "default"
    weight = "1"
  }
  redis {
    serverAddr = "localhost:6379"
    db = "0"
  }
  zk {
    cluster = "default"
    serverAddr = "127.0.0.1:2181"
    session.timeout = 6000
    connect.timeout = 2000
  }
  consul {
    cluster = "default"
    serverAddr = "127.0.0.1:8500"
  }
  etcd3 {
    cluster = "default"
    serverAddr = "http://localhost:2379"
  }
  sofa {
    serverAddr = "127.0.0.1:9603"
    application = "default"
    region = "DEFAULT_ZONE"
    datacenter = "DefaultDataCenter"
    cluster = "default"
    group = "SEATA_GROUP"
    addressWaitTime = "3000"
  }
  file {
    name = "file.conf"
  }
}
 
config {
  # file、nacos 、apollo、zk、consul、etcd3
  type = "file"
 
  nacos {
    serverAddr = "localhost"
    namespace = ""
  }
  consul {
    serverAddr = "127.0.0.1:8500"
  }
  apollo {
    app.id = "seata-server"
    apollo.meta = "http://192.168.1.204:8801"
  }
  zk {
    serverAddr = "127.0.0.1:2181"
    session.timeout = 6000
    connect.timeout = 2000
  }
  etcd3 {
    serverAddr = "http://localhost:2379"
  }
  file {
    name = "file.conf"
  }
}

&gt;    ==实际上,就是要将seata中的我们之前修改的两个配置文件复制到这个项目下==
</pre><p><strong>主启动类</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1664" mdtype="fences">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class) //取消数据源的自动创建
@EnableDiscoveryClient
@EnableFeignClients
public class SeataOrderMain2001 {

    public static void main(String[] args) {
        SpringApplication.run(SeataOrderMain2001.class,args);
    }
}
</pre><p><strong>service层</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1666" mdtype="fences">public interface OrderService {
    /**
    * 创建订单
    * @param order
    */
    void create(Order order);
}
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1667" mdtype="fences">@FeignClient(value = "seata-storage-service")
public interface StorageService {
   	   /*
        * 减库存
        * @param productId
        * @param count
        * @return
        */
    @PostMapping(value = "/storage/decrease")
    CommonResult decrease(@RequestParam("productId") Long productId, @RequestParam("count") Integer count);
}
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1668" mdtype="fences">@FeignClient(value = "seata-account-service")
public interface AccountService {
       /**
        * 减余额
        * @param userId
        * @param money
        * @return
        */
    @PostMapping(value = "/account/decrease")
    CommonResult decrease(@RequestParam("userId") Long userId, @RequestParam("money") BigDecimal money);
}
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1669" mdtype="fences" style="break-inside: unset;">   @Service
   @Slf4j
   public class OrderServiceImpl implements OrderService {
   
       @Resource
       private OrderDao orderDao;
       @Resource
       private AccountService accountService;
       @Resource
       private StorageService storageService;
   
       /**
        * 创建订单-&gt;调用库存服务扣减库存-&gt;调用账户服务扣减账户余额-&gt;修改订单状态
        * 简单说:
        * 下订单-&gt;减库存-&gt;减余额-&gt;改状态
        * GlobalTransactional seata开启分布式事务,异常时回滚,name保证唯一即可
        * @param order 订单对象
        */
       @Override
       ///@GlobalTransactional(name = "fsp-create-order", rollbackFor = Exception.class)
       public void create(Order order) {
           // 1 新建订单
           log.info("-----&gt;开始新建订单");
           orderDao.create(order);
   
           // 2 扣减库存
           log.info("-----&gt;订单微服务开始调用库存,做扣减Count");
           storageService.decrease(order.getProductId(), order.getCount());
           log.info("-----&gt;订单微服务开始调用库存,做扣减End");
   
           // 3 扣减账户
           log.info("-----&gt;订单微服务开始调用账户,做扣减Money");
           accountService.decrease(order.getUserId(), order.getMoney());
           log.info("-----&gt;订单微服务开始调用账户,做扣减End");
   
           // 4 修改订单状态,从0到1,1代表已完成
           log.info("-----&gt;修改订单状态开始");
           orderDao.update(order.getUserId(), 0);
   
           log.info("-----&gt;下订单结束了,O(∩_∩)O哈哈~");
       }
   }
</pre><p><strong>dao层,也就是接口</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1671" mdtype="fences" style="break-inside: unset;">@Mapper
public interface OrderDao {
    /**
     * 1 新建订单
     * @param order
     * @return
     */
    int create(Order order);

    /**
     * 2 修改订单状态,从0改为1
     * @param userId
     * @param status
     * @return
     */
    int update(@Param("userId") Long userId, @Param("status") Integer status);
}
</pre><p> <mark>在resource下创建mapper文件夹,编写mapper.xml</mark></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n1673" mdtype="fences" style="break-inside: unset;">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.eiletxie.springcloud.alibaba.dao.OrderDao"&gt;

    &lt;resultMap id="BaseResultMap" type="com.eiletxie.springcloud.alibaba.domain.Order"&gt;
        &lt;id column="id" property="id" jdbcType="BIGINT"&gt;&lt;/id&gt;
        &lt;result column="user_id" property="userId" jdbcType="BIGINT"&gt;&lt;/result&gt;
        &lt;result column="product_id" property="productId" jdbcType="BIGINT"&gt;&lt;/result&gt;
        &lt;result column="count" property="count" jdbcType="INTEGER"&gt;&lt;/result&gt;
        &lt;result column="money" property="money" jdbcType="DECIMAL"&gt;&lt;/result&gt;
        &lt;result column="status" property="status" jdbcType="INTEGER"&gt;&lt;/result&gt;
    &lt;/resultMap&gt;

    &lt;insert id="create" parameterType="com.eiletxie.springcloud.alibaba.domain.Order" useGeneratedKeys="true"
            keyProperty="id"&gt;
        insert into t_order(user_id,product_id,count,money,status) values (#{userId},#{productId},#{count},#{money},0);
    &lt;/insert&gt;

    &lt;update id="update"&gt;
        update t_order set status =1 where user_id =#{userId} and status=#{status};
   &lt;/update&gt;
&lt;/mapper&gt;
 
</pre><p><strong>controller层</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1675" mdtype="fences" style="break-inside: unset;">@RestController
public class OrderController {
    @Resource
    private OrderService orderService;


    /**
     * 创建订单
     *
     * @param order
     * @return
     */
    @GetMapping("/order/create")
    public CommonResult create(Order order) {
        orderService.create(order);
        return new CommonResult(200, "订单创建成功");
    }


}
</pre><p><strong>entity类(也叫domain类)</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1677" mdtype="fences">@Data
@AllArgsConstructor
@NoArgsConstructor
public class CommonResult&lt;T&gt; {
    private Integer code;
    private String message;
    private T data;

    public CommonResult(Integer code, String message) {
        this(code, message, null);
    }
}
 
</pre><blockquote><p><img src='https://img-blog.csdnimg.cn/a1786f3bf4f443fdb5edd34d28226df1.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote><p> <strong>config配置类</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1681" mdtype="fences">@Configuration
@MapperScan({"com.eiletxie.springcloud.alibaba.dao"})		指定我们的接口的位置
public class MyBatisConfig {

}
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n1682" mdtype="fences" style="break-inside: unset;">/**
 * @Author EiletXie
 * @Since 2020/3/18 21:51
 * 使用Seata对数据源进行代理
 */
@Configuration
public class DataSourceProxyConfig {

    @Value("${mybatis.mapperLocations}")
    private String mapperLocations;

    @Bean
    @ConfigurationProperties(prefix = "spring.datasource")
    public DataSource druidDataSource() {
        return new DruidDataSource();
    }

    @Bean
    public DataSourceProxy dataSourceProxy(DataSource druidDataSource) {
        return new DataSourceProxy(druidDataSource);
    }

    @Bean
    public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception {
        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();
        bean.setDataSource(dataSourceProxy);
        ResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
        bean.setMapperLocations(resolver.getResources(mapperLocations));
        return bean.getObject();
    }
}
</pre><p>  <mark>库存</mark></p><blockquote><p>seta-storage-2002</p></blockquote><blockquote><ol start='' ><li>pom   </li><li>配置文件</li><li>主启动类</li><li>service层</li><li>dao层</li><li>controller层</li></ol></blockquote><p> <mark>账号</mark></p><blockquote><p>seta-account-2003</p></blockquote><blockquote><ol start='' ><li>pom     </li><li>配置文件</li><li>主启动类</li><li>service层</li><li>dao层</li><li>controller层</li></ol></blockquote><p><strong>全局创建完成后,首先测试不加seata</strong></p><blockquote><p><img src='https://img-blog.csdnimg.cn/1237a26b7cbf4b4e8403e40db0905023.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p><p><img src='https://img-blog.csdnimg.cn/090faf758ee84b7988452445fc6b74a7.png' alt='在这里插入图片描述' referrerPolicy='no-referrer' /></p></blockquote></div>
</body>
</html>